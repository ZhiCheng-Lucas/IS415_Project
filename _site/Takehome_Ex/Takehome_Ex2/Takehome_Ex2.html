<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chong Zhi Cheng">
<meta name="dcterms.date" content="2024-09-30">

<title>IS415 - Application of Geospatial Analysis Methods to Discover Thailand Drug Abuse at the Province Level</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="../../site_libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="../../site_libs/typedarray-0.1/typedarray.min.js"></script>

<script src="../../site_libs/jquery-3.5.1/jquery.min.js"></script>

<link href="../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="../../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>



<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1: Introduction to Geospatial Analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html">
 <span class="dropdown-text">Hands-on Exercise 2: GeoVisualisation and Analytical Mapping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands-on Exercise 3: Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html">
 <span class="dropdown-text">Hands-on Exercise 4: Advanced Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05.html">
 <span class="dropdown-text">Hands-on Exercise 5: Spatial Weights and Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html">
 <span class="dropdown-text">Hands-on Exercise 6: Measures of Global and Local Spatial Association</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.html">
 <span class="dropdown-text">Hands-on Exercise 7: Shiny for Building Web-enabled Geospatial Analytics Application</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08.html">
 <span class="dropdown-text">Hands-on Exercise 8: Geographic Segmentation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex09/Hands-on_Ex09.html">
 <span class="dropdown-text">Hands-on Exercise 9: Geographically Weighted Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10.html">
 <span class="dropdown-text">Hands-on Exercise 10: Geographically Weighted Predictive Modelling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex11/Hands-on_Ex11.html">
 <span class="dropdown-text">Hands-on Exercise 11: Modelling Geographic of Accessibility</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex12/Hands-on_Ex12.html">
 <span class="dropdown-text">Hands-on Exercise 12: Spatial Interaction Models</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-Class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex01/In-Class_Ex01.html">
 <span class="dropdown-text">In-Class Exercise 1: Introduction to Geospatial Analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex02/In-Class_Ex02.html">
 <span class="dropdown-text">In-Class Exercise 2: GeoVisualisation and Analytical Mapping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex03/In-Class_Ex03.html">
 <span class="dropdown-text">In-Class Exercise 3: Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex04/In-Class_Ex04.html">
 <span class="dropdown-text">In-Class Exercise 4: Advanced Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex05/In-Class_Ex05.html">
 <span class="dropdown-text">In-Class Exercise 5: Spatial Weights and Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex06/In-Class_Ex06.html">
 <span class="dropdown-text">In-Class Exercise 6: Measures of Global and Local Spatial Association</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex07/In-Class_Ex07.html">
 <span class="dropdown-text">In-Class Exercise 7: Shiny for Building Web-enabled Geospatial Analytics Application</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex08/In-Class_Ex08.html">
 <span class="dropdown-text">In-Class Exercise 8: Geographic Segmentation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex09/In-Class_Ex09.html">
 <span class="dropdown-text">In-Class Exercise 9: Geographically Weighted Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex10/In-Class_Ex10.html">
 <span class="dropdown-text">In-Class Exercise 10: Geographically Weighted Predictive Modelling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex11/In-Class_Ex11.html">
 <span class="dropdown-text">In-Class Exercise 11: Modelling Geographic of Accessibility</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-Class_Ex/In-Class_Ex12/In-Class_Ex12.html">
 <span class="dropdown-text">In-Class Exercise 12: Spatial Interaction Models</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-takehome-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Takehome Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-takehome-exercise">    
        <li>
    <a class="dropdown-item" href="../../Takehome_Ex/Takehome_Ex1/Takehome_Ex1.html">
 <span class="dropdown-text">Takehome Exercise 1: Unveiling the Spatial and Temporal Dynamics of Armed Conflict in Myanmar</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Takehome_Ex/Takehome_Ex2/Takehome_Ex2.html">
 <span class="dropdown-text">Takehome Exercise 2: Application of Geospatial Analysis Methods to Discover Thailand Drug Abuse at the Province Level</span></a>
  </li>  
        <li class="dropdown-header">Takehome Exercise 3:</li>
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><strong>Introduction</strong></a></li>
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets"><strong>Datasets</strong></a>
  <ul class="collapse">
  <li><a href="#thailand-drug-offenses-2017-2022" id="toc-thailand-drug-offenses-2017-2022" class="nav-link" data-scroll-target="#thailand-drug-offenses-2017-2022"><strong>Thailand Drug Offenses [2017-2022]</strong></a></li>
  <li><a href="#thailand---subnational-administrative-boundaries" id="toc-thailand---subnational-administrative-boundaries" class="nav-link" data-scroll-target="#thailand---subnational-administrative-boundaries"><strong>Thailand - Subnational Administrative Boundaries</strong></a></li>
  </ul></li>
  <li><a href="#data-wrangling-overall-exploratory-data-analysis" id="toc-data-wrangling-overall-exploratory-data-analysis" class="nav-link" data-scroll-target="#data-wrangling-overall-exploratory-data-analysis"><strong>Data Wrangling &amp; Overall Exploratory Data Analysis</strong></a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#global-measures-of-spatial-autocorrelation" id="toc-global-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation"><strong>Global Measures of Spatial Autocorrelation</strong></a></li>
  <li><a href="#local-measures-of-spatial-autocorrelation" id="toc-local-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#local-measures-of-spatial-autocorrelation"><strong>Local Measures of Spatial Autocorrelation</strong></a></li>
  <li><a href="#temporal-evolution-of-spatial-patterns-thailands-drug-offences" id="toc-temporal-evolution-of-spatial-patterns-thailands-drug-offences" class="nav-link" data-scroll-target="#temporal-evolution-of-spatial-patterns-thailands-drug-offences"><strong>Temporal Evolution of Spatial Patterns Thailand’s Drug Offences</strong></a></li>
  <li><a href="#overall-spatial-patterns-analysis" id="toc-overall-spatial-patterns-analysis" class="nav-link" data-scroll-target="#overall-spatial-patterns-analysis"><strong>Overall Spatial Patterns Analysis</strong></a></li>
  <li><a href="#bonus-section-advanced-spatio-temporal-analysis-using-space-time-cube" id="toc-bonus-section-advanced-spatio-temporal-analysis-using-space-time-cube" class="nav-link" data-scroll-target="#bonus-section-advanced-spatio-temporal-analysis-using-space-time-cube"><strong>Bonus Section: Advanced Spatio-Temporal Analysis Using Space-Time Cube</strong></a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><strong>Conclusion</strong></a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><strong>References</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Application of Geospatial Analysis Methods to Discover Thailand Drug Abuse at the Province Level</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Chong Zhi Cheng </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 30, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 13, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1><strong>Introduction</strong></h1>
<p>Drug abuse is associated with significant negative health, financial and social consequences. Yet, illicit drug consumption remains highly prevalent and continues to be a growing problem worldwide. In 2021, 1 in 17 people aged 15–64 in the world had used a drug in the past 12 months. Notwithstanding population growth, the estimated number of drug users grew from 240 million in 2011 to 296 million in 2021.</p>
<p>The geopolitics of Thailand which is near the <a href="https://en.wikipedia.org/wiki/Golden_Triangle_(Southeast_Asia)">Golden Triangle</a> of Indochina, the largest drug production site in Asia, and the constant transportation infrastructure development made Thailand became market and transit routes for drug trafficking to the third countries.</p>
<p>In Thailand, drug abuse is one of the major social issue. There are about 2.7 million youths using drugs in Thailand. Among youths aged between 15 and 19 years, there are about 300,000 who have needs for drug treatment. Most of Thai youths involved with drugs are vocational-school students, which nearly doubles in number compared to secondary-school students.</p>
<p>This report aims to investigate three key aspects of drug abuse in Thailand:</p>
<ol type="1">
<li>Spatial Dependency: We will examine whether key indicators of drug abuse in Thailand are independent of geographical location or exhibit spatial patterns.</li>
<li>Cluster and Outlier Analysis: If spatial dependency is confirmed, we will identify and analyze clusters of high drug abuse rates and any outliers in the data.</li>
<li>Temporal Evolution: We will investigate how these spatial patterns and clusters have changed over time.</li>
</ol>
<p><strong>Initial Hypothesis</strong></p>
<p>We hypothesize that key indicators of drug abuse in Thailand are spatially dependent, with clusters of high drug use cases likely concentrated near the Golden Triangle and urban centers.</p>
<p><strong>Rationale</strong>:</p>
<ol type="1">
<li>Proximity to the Golden Triangle: Thailand’s location near this major drug production area suggests higher drug abuse rates in border regions due to easier access and established trafficking routes.</li>
<li>Urban Concentration: Drug abuse is expected to cluster in urban areas due to higher population density, diverse social networks, and potentially greater drug availability.</li>
</ol>
<p>To test this hypothesis, we will begin with an exploratory data analysis (EDA) of the overall dataset.</p>
</section>
<section id="datasets" class="level1">
<h1><strong>Datasets</strong></h1>
<section id="thailand-drug-offenses-2017-2022" class="level2">
<h2 class="anchored" data-anchor-id="thailand-drug-offenses-2017-2022"><strong>Thailand Drug Offenses [2017-2022]</strong></h2>
<p>This dataset presents statistics related to different types of drug offenses in Thailand, categorized by fiscal year. The data provides insights into the prevalence of various drug-related cases and their distribution across different provinces.</p>
<p>Sourced from the <a href="https://data.oncb.go.th/casePer">Office of the Narcotics Control Board</a></p>
<p><strong>Column Descriptions:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 77%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Column</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fiscal_year</td>
<td>The fiscal year during which the drug offenses were recorded.</td>
</tr>
<tr class="even">
<td>types_of_drug_offenses</td>
<td>The specific type or category of drug offense being reported. The types include drug use cases, suspects in drug use cases, possession cases, suspects in possession cases, possession with intent to distribute cases, suspects in possession with intent to distribute cases, trafficking cases, suspects in trafficking cases, production cases, suspects in production cases, import cases, suspects in import cases, export cases, suspects in export cases, conspiracy cases, and suspects in conspiracy cases.</td>
</tr>
<tr class="odd">
<td>no_cases</td>
<td>The total number of cases recorded for the specific combination of fiscal year, type of drug offense, and province.</td>
</tr>
<tr class="even">
<td>province_th</td>
<td>The name of the province in Thailand, written in Thai.</td>
</tr>
<tr class="odd">
<td>province_en</td>
<td>The name of the province in Thailand, written in English.</td>
</tr>
</tbody>
</table>
</section>
<section id="thailand---subnational-administrative-boundaries" class="level2">
<h2 class="anchored" data-anchor-id="thailand---subnational-administrative-boundaries"><strong>Thailand - Subnational Administrative Boundaries</strong></h2>
<p>For this analysis, we will utilize the Thailand Subnational Administrative Boundaries dataset, which provides detailed geographical information at various administrative levels, obtained from <a href="https://data.humdata.org/dataset/cod-ab-tha?" class="uri">https://data.humdata.org/dataset/cod-ab-tha?</a></p>
<p>This comprehensive dataset was developed and vetted by Information Technology Outreach Services (ITOS) with funding from USAID, ensuring its reliability and accuracy for research purposes.</p>
<p><strong>Focus on Provincial Level</strong></p>
<p>Our analysis will primarily concentrate on Administrative Level 1, which corresponds to Thailand’s provincial boundaries. This level of granularity provides an optimal balance between detail and manageability for our spatial analysis of drug abuse patterns across the country.</p>
</section>
</section>
<section id="data-wrangling-overall-exploratory-data-analysis" class="level1">
<h1><strong>Data Wrangling &amp; Overall Exploratory Data Analysis</strong></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, spdep, tmap, tidyverse, lubridate, scales, sfdep, dplyr,patchwork,plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>adm1 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/adm"</span>, <span class="at">layer =</span> <span class="st">"tha_admbnda_adm1_rtsd_20220121"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `tha_admbnda_adm1_rtsd_20220121' from data source 
  `C:\zcchong\IS415\Takehome_Ex\Takehome_Ex2\data\adm' using driver `ESRI Shapefile'
Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(adm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>adm1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84
First 10 features:
   Shape_Leng Shape_Area                  ADM1_EN       ADM1_TH ADM1_PCODE
1    2.417227 0.13133873                  Bangkok  กรุงเทพมหานคร       TH10
2    1.695100 0.07926199             Samut Prakan    สมุทรปราการ       TH11
3    1.251111 0.05323766               Nonthaburi         นนทบุรี       TH12
4    1.884945 0.12698345             Pathum Thani        ปทุมธานี       TH13
5    3.041716 0.21393797 Phra Nakhon Si Ayutthaya พระนครศรีอยุธยา       TH14
6    1.739908 0.07920961                Ang Thong        อ่างทอง       TH15
7    5.693342 0.54578838                 Lop Buri          ลพบุรี       TH16
8    1.778326 0.06872655                Sing Buri         สิงห์บุรี       TH17
9    2.896316 0.20907828                 Chai Nat         ชัยนาท       TH18
10   4.766446 0.29208711                 Saraburi         สระบุรี       TH19
   ADM1_REF ADM1ALT1EN ADM1ALT2EN ADM1ALT1TH ADM1ALT2TH  ADM0_EN   ADM0_TH
1      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
2      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
3      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
4      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
5      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
6      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
7      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
8      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
9      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
10     &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Thailand ประเทศไทย
   ADM0_PCODE       date    validOn    validTo                       geometry
1          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((100.6139 13...
2          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((100.7306 13...
3          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((100.3415 14...
4          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((100.8916 14...
5          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((100.5131 14...
6          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((100.3332 14...
7          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((101.3453 15...
8          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((100.3691 15...
9          TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((100.1199 15...
10         TH 2019-02-18 2022-01-22 -001-11-30 MULTIPOLYGON (((101.3994 15...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataset</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/thai_drug_offenses_2017_2022.csv"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Basic information about the dataset</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [7,392 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ fiscal_year           : num [1:7392] 2017 2017 2017 2017 2017 ...
 $ types_of_drug_offenses: chr [1:7392] "drug_use_cases" "drug_use_cases" "drug_use_cases" "drug_use_cases" ...
 $ no_cases              : num [1:7392] 11871 200 553 450 378 ...
 $ province_th           : chr [1:7392] "กรุงเทพมหานคร" "ชัยนาท" "นนทบุรี" "ปทุมธานี" ...
 $ province_en           : chr [1:7392] "Bangkok" "Chai Nat" "Nonthaburi" "Pathum Thani" ...
 - attr(*, "spec")=
  .. cols(
  ..   fiscal_year = col_double(),
  ..   types_of_drug_offenses = col_character(),
  ..   no_cases = col_double(),
  ..   province_th = col_character(),
  ..   province_en = col_character()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  fiscal_year   types_of_drug_offenses    no_cases       province_th       
 Min.   :2017   Length:7392            Min.   :    0.0   Length:7392       
 1st Qu.:2018   Class :character       1st Qu.:    1.0   Class :character  
 Median :2020   Mode  :character       Median :   70.0   Mode  :character  
 Mean   :2020                          Mean   :  535.3                     
 3rd Qu.:2021                          3rd Qu.:  623.0                     
 Max.   :2022                          Max.   :17131.0                     
 province_en       
 Length:7392       
 Class :character  
 Mode  :character  
                   
                   
                   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Distribution of cases across years</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>yearly_cases <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fiscal_year) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total_Cases =</span> <span class="fu">sum</span>(no_cases))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(yearly_cases, <span class="fu">aes</span>(<span class="at">x =</span> fiscal_year, <span class="at">y =</span> Total_Cases, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"skyblue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Trend of Total Drug Offense Cases by Fiscal Year"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Fiscal Year"</span>, <span class="at">y =</span> <span class="st">"Total Cases"</span>) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> yearly_cases<span class="sc">$</span>fiscal_year) <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Types of drug offenses</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>offense_types <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(types_of_drug_offenses) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total_Cases =</span> <span class="fu">sum</span>(no_cases)) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Cases))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(offense_types, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(types_of_drug_offenses, <span class="sc">-</span>Total_Cases), <span class="at">y =</span> Total_Cases)) <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"lightgreen"</span>) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Cases by Type of Drug Offense"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Type of Offense"</span>, <span class="at">y =</span> <span class="st">"Total Cases"</span>) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Geographical distribution of cases</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>province_cases <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total_Cases =</span> <span class="fu">sum</span>(no_cases)) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Cases))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>top_10_provinces <span class="ot">&lt;-</span> <span class="fu">head</span>(province_cases, <span class="dv">10</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_10_provinces, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(province_en, <span class="sc">-</span>Total_Cases), <span class="at">y =</span> Total_Cases)) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"salmon"</span>) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 10 Provinces by Total Drug Offense Cases"</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Province"</span>, <span class="at">y =</span> <span class="st">"Total Cases"</span>) <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Trends over time for top offenses</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>top_5_offenses <span class="ot">&lt;-</span> <span class="fu">head</span>(offense_types<span class="sc">$</span>types_of_drug_offenses, <span class="dv">5</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>trends_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(types_of_drug_offenses <span class="sc">%in%</span> top_5_offenses) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fiscal_year, types_of_drug_offenses) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total_Cases =</span> <span class="fu">sum</span>(no_cases))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trends_data, <span class="fu">aes</span>(<span class="at">x =</span> fiscal_year, <span class="at">y =</span> Total_Cases, <span class="at">color =</span> types_of_drug_offenses)) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Trends of Top 5 Drug Offenses Over Time"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Fiscal Year"</span>, <span class="at">y =</span> <span class="st">"Total Cases"</span>) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol type="1">
<li>Trend of Total Drug Offense Cases by Fiscal Year:</li>
</ol>
<ul>
<li>There’s a general upward trend in total drug offense cases from 2017 to 2021, with a sharp increase in 2021.</li>
<li>The number of cases rose from about 550,000 in 2017 to a peak of nearly 850,000 in 2021.</li>
<li>However, there’s a dramatic drop in 2022, falling to approximately 450,000 cases. This sudden decrease might be due to policy changes, reporting adjustments, or external factors like the COVID-19 pandemic.</li>
</ul>
<ol start="2" type="1">
<li>Total Cases by Type of Drug Offense:</li>
</ol>
<ul>
<li>Drug use and possession are the most common offenses, each accounting for over 750,000 cases.</li>
<li>There’s a significant drop-off after the top two categories, with “suspects in possession” and “possession with intent to distribute” being the next most frequent offenses.</li>
<li>Trafficking, production, conspiracy, import, and export cases are comparatively rare.</li>
</ul>
<ol start="3" type="1">
<li>Top 10 Provinces by Total Drug Offense Cases:</li>
</ol>
<ul>
<li>Bangkok has by far the highest number of cases, with nearly 300,000 - more than double the next highest province.</li>
<li>Nakhon Si Thammarat, Songkhla, and Surat Thani follow, each with over 100,000 cases.</li>
</ul>
<ol start="4" type="1">
<li>Trends of Top 5 Drug Offenses Over Time:</li>
</ol>
<ul>
<li><p>All major offense types show similar trends, with a sharp spike in 2021 followed by a significant drop in 2022.</p></li>
<li><p>Drug use and possession cases are consistently the highest, often overlapping on the graph.</p></li>
<li><p>“Suspects in possession with intent to distribute” cases show a less dramatic increase in 2021 compared to other offense types.</p></li>
<li><p>The 2022 decrease is consistent across all offense types, supporting the idea of a systemic change rather than a category-specific shift.</p></li>
</ul>
<p>Following which, we will verify the consistency between the province names in the shapefile and those in the CSV dataset.</p>
<p>This crucial step ensures accurate spatial analysis by confirming that our geographical data (shapefile) aligns properly with our drug offense statistics (CSV file). Any discrepancies in naming conventions or data structure will need to be addressed before proceeding with more advanced spatial analyses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique province names from both datasets</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>shapefile_provinces <span class="ot">&lt;-</span> <span class="fu">unique</span>(adm1<span class="sc">$</span>ADM1_EN)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>data_provinces <span class="ot">&lt;-</span> <span class="fu">unique</span>(data<span class="sc">$</span>province_en)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a comparison dataframe</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">shapefile_provinces =</span> <span class="fu">sort</span>(shapefile_provinces),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_provinces =</span> <span class="fu">sort</span>(data_provinces)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for exact matches</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>comparison<span class="sc">$</span>exact_match <span class="ot">&lt;-</span> comparison<span class="sc">$</span>shapefile_provinces <span class="sc">==</span> comparison<span class="sc">$</span>data_provinces</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print provinces that don't match exactly</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>mismatches <span class="ot">&lt;-</span> comparison[<span class="sc">!</span>comparison<span class="sc">$</span>exact_match, ]</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Provinces that don't match exactly:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Provinces that don't match exactly:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mismatches)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   shapefile_provinces data_provinces exact_match
4            Bueng Kan        buogkan       FALSE
21                Loei         Loburi       FALSE
22            Lop Buri           Loei       FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate string similarity</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>string_similarity <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">agrepl</span>(a, b, <span class="at">max.distance =</span> <span class="fl">0.1</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for similar names among mismatches</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(mismatches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mismatches)) {</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    similar <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data_provinces, <span class="cf">function</span>(x) <span class="fu">string_similarity</span>(mismatches<span class="sc">$</span>shapefile_provinces[i], x))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(similar)) {</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Possible match for"</span>, mismatches<span class="sc">$</span>shapefile_provinces[i], <span class="st">":"</span>, data_provinces[similar], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Possible match for Loei : Loei </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for provinces in one dataset but not in the other</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>in_shapefile_not_in_data <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(shapefile_provinces, data_provinces)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>in_data_not_in_shapefile <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(data_provinces, shapefile_provinces)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Provinces in shapefile but not in data:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Provinces in shapefile but not in data:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(in_shapefile_not_in_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Lop Buri"  "Bueng Kan"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Provinces in data but not in shapefile:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Provinces in data but not in shapefile:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(in_data_not_in_shapefile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Loburi"  "buogkan"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to update province names</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>update_province_name <span class="ot">&lt;-</span> <span class="cf">function</span>(name) {</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">case_when</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"Loburi"</span> <span class="sc">~</span> <span class="st">"Lop Buri"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"buogkan"</span> <span class="sc">~</span> <span class="st">"Bueng Kan"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> name</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the province_en column</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>province_en <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data<span class="sc">$</span>province_en, update_province_name)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the changes</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data <span class="sc">%&gt;%</span> </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_en <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Lop Buri"</span>, <span class="st">"Bueng Kan"</span>, <span class="st">"Loei"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(province_en) <span class="sc">%&gt;%</span> </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  province_en
  &lt;chr&gt;      
1 Lop Buri   
2 Bueng Kan  
3 Loei       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique province names from both datasets</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>shapefile_provinces <span class="ot">&lt;-</span> <span class="fu">unique</span>(adm1<span class="sc">$</span>ADM1_EN)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>data_provinces <span class="ot">&lt;-</span> <span class="fu">unique</span>(data<span class="sc">$</span>province_en)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for any remaining mismatches</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>mismatches <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(data_provinces, shapefile_provinces)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Any remaining mismatches between data provinces and shapefile:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Any remaining mismatches between data provinces and shapefile:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mismatches)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(mismatches) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">All province names now match between the data file and the shapefile.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
All province names now match between the data file and the shapefile.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional check for case sensitivity</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>case_sensitive_mismatches <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">tolower</span>(data_provinces), <span class="fu">tolower</span>(shapefile_provinces))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(case_sensitive_mismatches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Warning: Some provinces match when ignoring case, but have different capitalization:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(case_sensitive_mismatches)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section" class="level1">
<h1></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate total cases by province</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>province_totals <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the totals with the spatial data</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>adm1_with_data <span class="ot">&lt;-</span> adm1 <span class="sc">%&gt;%</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(province_totals, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map with a red color scheme</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> adm1_with_data) <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> total_cases)) <span class="sc">+</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"pink"</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"darkred"</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> <span class="st">"log"</span>,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Overview of Drug Offense Cases in Thailand"</span>,</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Total cases by province (2017-2022)"</span>,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Data source: Office of the Narcotics Control Board"</span>) <span class="sc">+</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate total cases by province and year</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>province_year_totals <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en, fiscal_year) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of sf objects, one for each year</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>adm1_with_data_by_year <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">unique</span>(province_year_totals<span class="sc">$</span>fiscal_year), <span class="cf">function</span>(year) {</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  year_data <span class="ot">&lt;-</span> province_year_totals <span class="sc">%&gt;%</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> year)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  adm1 <span class="sc">%&gt;%</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(year_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all years into one sf object</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>all_years_sf <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, adm1_with_data_by_year)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the faceted map</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> all_years_sf) <span class="sc">+</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> total_cases)) <span class="sc">+</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"lightpink"</span>,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"darkred"</span>,</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> <span class="st">"log"</span>,</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> fiscal_year, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Drug Offense Cases in Thailand by Year"</span>,</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Total cases by province (2017-2022)"</span>,</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Data source: Office of the Narcotics Control Board"</span>) <span class="sc">+</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>An analysis of the overall drug offense cases reveal:</p>
<ol type="1">
<li>Spatial Distribution:
<ul>
<li>The maps reveal significant spatial variation in drug offense cases across Thailand’s provinces.</li>
<li>Darker shades, indicating higher case numbers, are consistently observed in certain regions, particularly in the central, northern, and southern parts of the country.</li>
<li>Bangkok (the small, dark area in the central region) consistently shows the highest concentration of cases across all years.</li>
</ul></li>
<li>Temporal Trends:
<ul>
<li>The series of maps from 2017 to 2022 shows a general intensification of colors, suggesting an overall increase in drug offense cases over time.</li>
<li>This trend is particularly noticeable from 2017 to 2021, with 2021 showing the darkest shades across most provinces.</li>
<li>However, there’s a visible lightening of colors in 2022, indicating a decrease in cases compared to 2021.</li>
</ul></li>
<li>Regional Patterns:
<ul>
<li>Northern provinces consistently show higher case numbers (darker shades) compared to northeastern provinces.</li>
<li>Southern provinces, especially those in the narrow peninsula, maintain relatively high case numbers throughout the years.</li>
<li>Central provinces surrounding Bangkok also exhibit consistently high case numbers.</li>
</ul></li>
<li>Variation in Impact:
<ul>
<li>While some provinces remain consistently dark or light across the years, others show more variability, suggesting localized factors influencing drug offense rates.</li>
</ul></li>
</ol>
<p>Comparison to Initial Hypothesis:</p>
<p>Our initial hypothesis stated: “The key indicators of drug abuse in Thailand are spatially dependent, with clusters of high drug use cases likely to be found near borders and urban centers.”</p>
<p>The results largely support this hypothesis:</p>
<ol type="1">
<li><p>Spatial Dependency: The maps clearly show that drug offense cases are not randomly distributed but follow distinct spatial patterns, confirming spatial dependency.</p></li>
<li><p>Urban Centers: Bangkok consistently shows the highest concentration of cases, supporting the hypothesis about urban centers.</p></li>
<li><p>Border Regions: Many border provinces show higher case numbers, aligning with the hypothesis about border regions.</p></li>
<li><p>Clustering: The maps reveal clear clustering of high-case provinces, particularly in the central, northern, and southern regions.</p></li>
</ol>
</section>
<section id="global-measures-of-spatial-autocorrelation" class="level1">
<h1><strong>Global Measures of Spatial Autocorrelation</strong></h1>
<p>In this section, we delve deeper into the spatial patterns of drug offenses across Thailand using global measures of spatial autocorrelation.</p>
<p><strong>Focus on 2021 Data</strong>: Our analysis will concentrate on data from the fiscal year 2021. This decision is based on our initial exploratory data analysis, which revealed 2021 as the year with the highest number of reported drug offense cases. By focusing on this peak year, we aim to capture the most pronounced spatial patterns and relationships in our dataset.</p>
<p><strong>Aggregation of Drug Offense Types</strong>: For this analysis, we have aggregated all types of drug offenses into a single metric. This approach allows us to examine the overall drug epidemic landscape without the complexity of distinguishing between different offense categories. Our primary concern is to understand the spatial distribution of the drug problem as a whole, rather than the nuances of specific offense types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>drug_summary_2021 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> <span class="dv">2021</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_cases))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View the top 10 provinces</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(drug_summary_2021, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   province_en         total_cases
   &lt;chr&gt;                     &lt;dbl&gt;
 1 Nakhon Si Thammarat       40983
 2 Bangkok                   37318
 3 Chiang Mai                28778
 4 Surat Thani               28566
 5 Songkhla                  28509
 6 Ubon Ratchathani          28121
 7 Khon Kaen                 25903
 8 Si Sa Ket                 22484
 9 Udon Thani                22449
10 Nakhon Ratchasima         21949</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bar plot to visualize the top 10 provinces with the highest number of drug cases</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>top_10_provinces <span class="ot">&lt;-</span> <span class="fu">head</span>(drug_summary_2021, <span class="dv">10</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_10_provinces, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(province_en, total_cases), <span class="at">y =</span> total_cases)) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 10 Provinces with Highest Drug Cases in 2021"</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Province"</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Number of Cases"</span>) <span class="sc">+</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(drug_summary_2021, <span class="fu">aes</span>(<span class="at">x =</span> total_cases)) <span class="sc">+</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1000</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Drug Cases Across Provinces in 2021"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Total Number of Cases"</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Provinces"</span>) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the drug data with the shapefile</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> adm1 <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(drug_summary_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)  <span class="co"># Set tmap mode to static plot</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(map_data) <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"total_cases"</span>, </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"quantile"</span>, </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"YlOrRd"</span>,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Number of Drug Cases"</span>) <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>() <span class="sc">+</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">"Drug Cases in Thailand (2021)"</span>,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the map</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure map_data is an sf object</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(map_data)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create neighbor list</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(map_data)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weights</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(nb,<span class="at">allow_zero =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure total_cases is numeric</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>map_data<span class="sc">$</span>total_cases <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(map_data<span class="sc">$</span>total_cases)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate global Moran's I</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>moran_i <span class="ot">&lt;-</span> <span class="fu">global_moran_test</span>(map_data<span class="sc">$</span>total_cases, nb, weights, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.8146, p-value = 0.002442
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.198888805      -0.013333333       0.005685208 </code></pre>
</div>
</div>
<p>Based on the results of the global Moran’s I test, we can interpret the spatial autocorrelation of drug abuse cases in Thailand as follows:</p>
<ol type="1">
<li><p>Moran’s I statistic: 0.198888805 This positive value indicates a positive spatial autocorrelation, suggesting that provinces with similar numbers of drug abuse cases tend to be clustered together.</p></li>
<li><p>p-value: 0.002442 This p-value is well below the typical significance level of 0.05, indicating strong evidence against the null hypothesis of spatial randomness.</p></li>
</ol>
<p>Interpretation: The Moran’s I test results provide strong statistical evidence for positive spatial autocorrelation in drug cases across Thailand’s provinces. This means that provinces with high numbers of drug cases tend to be located near other provinces with high numbers, and provinces with low numbers tend to be near other low-number provinces.</p>
<p>The low p-value (0.002442) indicates that this spatial pattern is statistically significant and very unlikely to have occurred by chance. This confirms our visual observations from the map and supports our initial hypothesis about the spatial dependency of drug offense patterns in Thailand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Monte Carlo simulation</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>moran_mc_res <span class="ot">&lt;-</span> <span class="fu">global_moran_perm</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  map_data<span class="sc">$</span>total_cases,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  nb,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  weights,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.action =</span> na.omit</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results of Monte Carlo simulation</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_mc_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.19889, observed rank = 996, p-value = 0.008
alternative hypothesis: two.sided</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create histogram</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(moran_mc_res<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>]) <span class="sc">+</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> moran_mc_res<span class="sc">$</span>statistic), </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Simulated Moran's I for Thailand Drug Abuse Cases"</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Observed Moran's I:"</span>, <span class="fu">round</span>(moran_mc_res<span class="sc">$</span>statistic, <span class="dv">4</span>),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"| p-value:"</span>, <span class="fu">round</span>(moran_mc_res<span class="sc">$</span>p.value, <span class="dv">4</span>)),</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Simulated Moran's I"</span>,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Occurrences"</span>) <span class="sc">+</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Conclusion:</p>
<p>The key indicators of drug abuse in Thailand show clear evidence of spatial dependence. The distribution of drug abuse cases across Thai provinces is not random but exhibits a statistically significant pattern of spatial clustering. Provinces with high numbers of drug abuse cases are more likely to be near other provinces with high numbers, and similarly for provinces with low numbers.</p>
</section>
<section id="local-measures-of-spatial-autocorrelation" class="level1">
<h1><strong>Local Measures of Spatial Autocorrelation</strong></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Moran's I</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>local_moran_results <span class="ot">&lt;-</span> <span class="fu">local_moran</span>(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  map_data<span class="sc">$</span>total_cases,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  nb,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  weights,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero.policy =</span> <span class="cn">TRUE</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add results to the map_data</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> map_data <span class="sc">%&gt;%</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_i =</span> local_moran_results<span class="sc">$</span>Ii,</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_p =</span> local_moran_results<span class="sc">$</span>p_folded_sim,</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_z =</span> local_moran_results<span class="sc">$</span>Z.Ii</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate LISA clusters</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> map_data <span class="sc">%&gt;%</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_lag =</span> <span class="fu">st_lag</span>(total_cases, nb, weights),</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_scale =</span> <span class="fu">scale</span>(total_cases),</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag_scale =</span> <span class="fu">scale</span>(case_lag),</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">lisa_cluster =</span> <span class="fu">case_when</span>(</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>      local_moran_p <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-High"</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map of LISA clusters</span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data) <span class="sc">+</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> lisa_cluster), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"High-High"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>, </span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Low-High"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"High-Low"</span> <span class="ot">=</span> <span class="st">"lightpink"</span>,</span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"grey90"</span>),  <span class="co"># Changed from "white" to "grey90"</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"LISA Cluster Type"</span></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"LISA Cluster Map of Drug Abuse Cases in Thailand"</span>,</span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on Local Moran's I"</span>) <span class="sc">+</span></span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><p>Cluster Types:</p>
<ul>
<li>High-High (Red): Areas where provinces with high drug abuse cases are surrounded by other provinces with high cases.</li>
<li>Low-Low (Dark Blue): Areas where provinces with low drug abuse cases are surrounded by other provinces with low cases.</li>
<li>Low-High (Light Blue): Outliers where a province with low cases is surrounded by provinces with high cases.</li>
<li>Not Significant (Gray): Provinces where there is no significant local spatial autocorrelation.</li>
<li>NA: Phuket island</li>
</ul></li>
<li><p>Spatial Distribution of Clusters:</p>
<ol type="a">
<li><p>High-High Cluster:</p>
<ul>
<li>A significant High-High cluster is observed in the southern region of Thailand.</li>
<li>This cluster could indicate a regional hotspot for drug-related issues.</li>
</ul></li>
<li><p>Low-Low Cluster:</p>
<ul>
<li>A large Low-Low cluster is present in the western part of central Thailand.</li>
<li>It suggests that this region might have factors contributing to lower drug abuse rates or more effective prevention strategies.</li>
</ul></li>
<li><p>Low-High Outlier:</p>
<ul>
<li>A single Low-High outlier is observed adjacent to the southern High-High cluster.</li>
<li>This represents a province with relatively low drug abuse cases surrounded by provinces with high cases.</li>
</ul></li>
</ol></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Gi*</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>gi_stars <span class="ot">&lt;-</span> <span class="fu">local_g_perm</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  map_data<span class="sc">$</span>total_cases,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  nb,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  weights,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Gi* results to the map_data</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>map_data<span class="sc">$</span>gi_star <span class="ot">&lt;-</span> gi_stars<span class="sc">$</span>gi </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>map_data<span class="sc">$</span>gi_p_sim <span class="ot">&lt;-</span> gi_stars<span class="sc">$</span>p_sim</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>map_data<span class="sc">$</span>gi_p_folded_sim <span class="ot">&lt;-</span> gi_stars<span class="sc">$</span>p_folded_sim</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map displaying the actual Gi* values</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data) <span class="sc">+</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gi_star), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>,       <span class="co"># Cold spots (negative Gi*)</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,      <span class="co"># Neutral spots (Gi* = 0)</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"red"</span>,       <span class="co"># Hot spots (positive Gi*)</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,       <span class="co"># Midpoint at 0 for neutral</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gi* Value"</span>  <span class="co"># Legend title for Gi* values</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Gi* Value Map of Drug Abuse Cases in Thailand"</span>,</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Displaying Getis-Ord Gi* Statistic"</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol type="1">
<li><p>Hot Spots (Red Areas):</p>
<ul>
<li>Northeastern Region: There’s a notable hot spot in the northeastern part of Thailand, with Gi* values around 1 to 2. This suggests a significant cluster of provinces with high numbers of drug abuse cases.</li>
<li>Southern Region: The southern peninsula shows another prominent hot spot, with some areas reaching the highest Gi* values (dark red). This indicates a very strong clustering of high drug abuse cases in this region.</li>
</ul></li>
<li><p>Cold Spots (Purple Areas):</p>
<ul>
<li>Western Region: A large cold spot is visible in the western part of Thailand, extending from the central region. This area shows negative Gi* values, indicating a significant cluster of provinces with lower drug abuse cases.</li>
<li>Northwestern Region: There’s another cold spot in the northwestern part of the country, suggesting another area where drug abuse cases are consistently lower than the national average.</li>
</ul></li>
<li><p>Transition Zones:</p>
<ul>
<li>Central Region: The central part of Thailand shows a mix of light colors, indicating areas where the drug abuse cases are not significantly different from the national average or where there’s no strong spatial clustering.</li>
</ul></li>
</ol>
<p>Our comprehensive spatial analysis of drug abuse cases in Thailand has provided strong evidence for spatial dependency and revealed distinct patterns of clustering across the country. Here’s a summary of our findings:</p>
<ol type="1">
<li>Spatial Dependency:
<ul>
<li>The Global Moran’s I test (I = 0.1989, p-value = 0.008) confirmed significant positive spatial autocorrelation, indicating that drug abuse cases in Thailand are indeed spatially dependent.</li>
<li>This spatial dependency suggests that the distribution of drug abuse cases is not random, but influenced by geographical factors and neighborhood effects.</li>
</ul></li>
<li>Clusters and Outliers (LISA Analysis):
<ul>
<li>High-High Cluster: A significant cluster of high drug abuse cases was identified in the southern region of Thailand, indicating a concentration of the problem in this area.</li>
<li>Low-Low Cluster: A large cluster of low drug abuse cases was found in the western part of central Thailand, suggesting a region with relatively lower drug-related issues.</li>
<li>Low-High Outlier: An interesting outlier was detected adjacent to the southern High-High cluster, representing a province with low cases surrounded by high-case areas.</li>
</ul></li>
<li>Hotspots and Cold Spots (Getis-Ord Gi* Analysis):
<ul>
<li>Hotspots: Two major hotspots were identified:
<ol type="a">
<li>In the northeastern region, indicating a concentration of high drug abuse cases.</li>
<li>In the southern peninsula, confirming and extending the High-High cluster from the LISA analysis.</li>
</ol></li>
<li>Cold Spots: Significant cold spots were detected in:
<ol type="a">
<li>The western region, aligning with the Low-Low cluster from LISA analysis.</li>
<li>The northwestern part of the country, revealing another area of consistently lower drug abuse cases.</li>
</ol></li>
</ul></li>
<li>Regional Variations:
<ul>
<li>The analyses consistently showed that drug abuse patterns vary significantly across different regions of Thailand.</li>
<li>The central and eastern regions generally showed less significant clustering, suggesting more heterogeneous patterns in these areas.</li>
</ul></li>
</ol>
</section>
<section id="temporal-evolution-of-spatial-patterns-thailands-drug-offences" class="level1">
<h1><strong>Temporal Evolution of Spatial Patterns Thailand’s Drug Offences</strong></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>drug_summary_2017 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_cases))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>map_data_2017 <span class="ot">&lt;-</span> adm1 <span class="sc">%&gt;%</span> </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(drug_summary_2017, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure map_data_2017 is an sf object</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>map_data_2017 <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(map_data_2017)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create neighbor list for 2017</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>nb_2017 <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(map_data_2017)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weights for 2017</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>weights_2017 <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(nb_2017, <span class="at">allow_zero =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure total_cases is numeric</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>map_data_2017<span class="sc">$</span>total_cases <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(map_data_2017<span class="sc">$</span>total_cases)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate global Moran's I</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>moran_i_2017 <span class="ot">&lt;-</span> <span class="fu">global_moran_test</span>(map_data_2017<span class="sc">$</span>total_cases, nb_2017, weights_2017, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2017)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.4598, p-value = 0.006951
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.133140650      -0.013333333       0.003545946 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Moran's I</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>local_moran_results_2017 <span class="ot">&lt;-</span> <span class="fu">local_moran</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  map_data_2017<span class="sc">$</span>total_cases, </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  nb_2017, </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  weights_2017, </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>, </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero.policy =</span> <span class="cn">TRUE</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add results to the map_data_2017</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>map_data_2017 <span class="ot">&lt;-</span> map_data_2017 <span class="sc">%&gt;%</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_i =</span> local_moran_results_2017<span class="sc">$</span>Ii,</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_p =</span> local_moran_results_2017<span class="sc">$</span>p_folded_sim,</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_z =</span> local_moran_results_2017<span class="sc">$</span>Z.Ii</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate LISA clusters</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>map_data_2017 <span class="ot">&lt;-</span> map_data_2017 <span class="sc">%&gt;%</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_lag =</span> <span class="fu">st_lag</span>(total_cases, nb_2017, weights_2017),</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_scale =</span> <span class="fu">scale</span>(total_cases),</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag_scale =</span> <span class="fu">scale</span>(case_lag),</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">lisa_cluster =</span> <span class="fu">case_when</span>(</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>      local_moran_p <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-High"</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map of LISA clusters</span></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2017) <span class="sc">+</span></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> lisa_cluster), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"High-High"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Low-High"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"High-Low"</span> <span class="ot">=</span> <span class="st">"lightpink"</span>, <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"grey90"</span>),</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"LISA Cluster Type"</span></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"LISA Cluster Map of Drug Abuse Cases in Thailand (2017)"</span>,</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on Local Moran's I"</span>) <span class="sc">+</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Gi*</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>gi_stars_2017 <span class="ot">&lt;-</span> <span class="fu">local_g_perm</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  map_data_2017<span class="sc">$</span>total_cases,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  nb_2017,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  weights_2017,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Gi* results to the map_data_2017</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>map_data_2017<span class="sc">$</span>gi_star <span class="ot">&lt;-</span> gi_stars_2017<span class="sc">$</span>gi</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>map_data_2017<span class="sc">$</span>gi_p_sim <span class="ot">&lt;-</span> gi_stars_2017<span class="sc">$</span>p_sim</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>map_data_2017<span class="sc">$</span>gi_p_folded_sim <span class="ot">&lt;-</span> gi_stars_2017<span class="sc">$</span>p_folded_sim</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map displaying the actual Gi* values</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2017) <span class="sc">+</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gi_star), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>,</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gi* Value"</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Gi* Value Map of Drug Abuse Cases in Thailand (2017)"</span>,</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Displaying Getis-Ord Gi* Statistic"</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>drug_summary_2018 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> <span class="dv">2018</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_cases))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>map_data_2018 <span class="ot">&lt;-</span> adm1 <span class="sc">%&gt;%</span> </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(drug_summary_2018, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure map_data_2018 is an sf object</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>map_data_2018 <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(map_data_2018)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create neighbor list for 2018</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>nb_2018 <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(map_data_2018)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weights for 2018</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>weights_2018 <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(nb_2018, <span class="at">allow_zero =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure total_cases is numeric</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>map_data_2018<span class="sc">$</span>total_cases <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(map_data_2018<span class="sc">$</span>total_cases)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate global Moran's I</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>moran_i_2018 <span class="ot">&lt;-</span> <span class="fu">global_moran_test</span>(map_data_2018<span class="sc">$</span>total_cases, nb_2018, weights_2018, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2018)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.1529, p-value = 0.01566
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.116368909      -0.013333333       0.003629353 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Moran's I</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>local_moran_results_2018 <span class="ot">&lt;-</span> <span class="fu">local_moran</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  map_data_2018<span class="sc">$</span>total_cases, </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  nb_2018, </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  weights_2018, </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>, </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero.policy =</span> <span class="cn">TRUE</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add results to the map_data_2018</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>map_data_2018 <span class="ot">&lt;-</span> map_data_2018 <span class="sc">%&gt;%</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_i =</span> local_moran_results_2018<span class="sc">$</span>Ii,</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_p =</span> local_moran_results_2018<span class="sc">$</span>p_folded_sim,</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_z =</span> local_moran_results_2018<span class="sc">$</span>Z.Ii</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate LISA clusters</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>map_data_2018 <span class="ot">&lt;-</span> map_data_2018 <span class="sc">%&gt;%</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_lag =</span> <span class="fu">st_lag</span>(total_cases, nb_2018, weights_2018),</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_scale =</span> <span class="fu">scale</span>(total_cases),</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag_scale =</span> <span class="fu">scale</span>(case_lag),</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">lisa_cluster =</span> <span class="fu">case_when</span>(</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>      local_moran_p <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-High"</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map of LISA clusters</span></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2018) <span class="sc">+</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> lisa_cluster), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"High-High"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Low-High"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"High-Low"</span> <span class="ot">=</span> <span class="st">"lightpink"</span>, <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"grey90"</span>),</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"LISA Cluster Type"</span></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"LISA Cluster Map of Drug Abuse Cases in Thailand (2018)"</span>,</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on Local Moran's I"</span>) <span class="sc">+</span></span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Gi*</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>gi_stars_2018 <span class="ot">&lt;-</span> <span class="fu">local_g_perm</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  map_data_2018<span class="sc">$</span>total_cases,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  nb_2018,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  weights_2018,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Gi* results to the map_data_2018</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>map_data_2018<span class="sc">$</span>gi_star <span class="ot">&lt;-</span> gi_stars_2018<span class="sc">$</span>gi</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>map_data_2018<span class="sc">$</span>gi_p_sim <span class="ot">&lt;-</span> gi_stars_2018<span class="sc">$</span>p_sim</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>map_data_2018<span class="sc">$</span>gi_p_folded_sim <span class="ot">&lt;-</span> gi_stars_2018<span class="sc">$</span>p_folded_sim</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map displaying the actual Gi* values</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2018) <span class="sc">+</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gi_star), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>,</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gi* Value"</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Gi* Value Map of Drug Abuse Cases in Thailand (2018)"</span>,</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Displaying Getis-Ord Gi* Statistic"</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>drug_summary_2019 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_cases))</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>map_data_2019 <span class="ot">&lt;-</span> adm1 <span class="sc">%&gt;%</span> </span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(drug_summary_2019, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure map_data_2019 is an sf object</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>map_data_2019 <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(map_data_2019)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create neighbor list for 2019</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>nb_2019 <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(map_data_2019)</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weights for 2019</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>weights_2019 <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(nb_2019, <span class="at">allow_zero =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure total_cases is numeric</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>map_data_2019<span class="sc">$</span>total_cases <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(map_data_2019<span class="sc">$</span>total_cases)</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate global Moran's I</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>moran_i_2019 <span class="ot">&lt;-</span> <span class="fu">global_moran_test</span>(map_data_2019<span class="sc">$</span>total_cases, nb_2019, weights_2019, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2019)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.4911, p-value = 0.006367
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.155405262      -0.013333333       0.004588259 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Moran's I</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>local_moran_results_2019 <span class="ot">&lt;-</span> <span class="fu">local_moran</span>(</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  map_data_2019<span class="sc">$</span>total_cases, </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  nb_2019, </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  weights_2019, </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>, </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero.policy =</span> <span class="cn">TRUE</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add results to the map_data_2019</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>map_data_2019 <span class="ot">&lt;-</span> map_data_2019 <span class="sc">%&gt;%</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_i =</span> local_moran_results_2019<span class="sc">$</span>Ii,</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_p =</span> local_moran_results_2019<span class="sc">$</span>p_folded_sim,</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_z =</span> local_moran_results_2019<span class="sc">$</span>Z.Ii</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate LISA clusters</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>map_data_2019 <span class="ot">&lt;-</span> map_data_2019 <span class="sc">%&gt;%</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_lag =</span> <span class="fu">st_lag</span>(total_cases, nb_2019, weights_2019),</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_scale =</span> <span class="fu">scale</span>(total_cases),</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag_scale =</span> <span class="fu">scale</span>(case_lag),</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">lisa_cluster =</span> <span class="fu">case_when</span>(</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>      local_moran_p <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-High"</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map of LISA clusters</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2019) <span class="sc">+</span></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> lisa_cluster), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"High-High"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Low-High"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"High-Low"</span> <span class="ot">=</span> <span class="st">"lightpink"</span>, <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"grey90"</span>),</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"LISA Cluster Type"</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"LISA Cluster Map of Drug Abuse Cases in Thailand (2019)"</span>,</span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on Local Moran's I"</span>) <span class="sc">+</span></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Gi*</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>gi_stars_2019 <span class="ot">&lt;-</span> <span class="fu">local_g_perm</span>(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  map_data_2019<span class="sc">$</span>total_cases,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  nb_2019,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  weights_2019,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Gi* results to the map_data_2019</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>map_data_2019<span class="sc">$</span>gi_star <span class="ot">&lt;-</span> gi_stars_2019<span class="sc">$</span>gi</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>map_data_2019<span class="sc">$</span>gi_p_sim <span class="ot">&lt;-</span> gi_stars_2019<span class="sc">$</span>p_sim</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>map_data_2019<span class="sc">$</span>gi_p_folded_sim <span class="ot">&lt;-</span> gi_stars_2019<span class="sc">$</span>p_folded_sim</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map displaying the actual Gi* values</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2019) <span class="sc">+</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gi_star), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>,</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gi* Value"</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Gi* Value Map of Drug Abuse Cases in Thailand (2019)"</span>,</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Displaying Getis-Ord Gi* Statistic"</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>drug_summary_2020 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_cases))</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>map_data_2020 <span class="ot">&lt;-</span> adm1 <span class="sc">%&gt;%</span> </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(drug_summary_2020, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure map_data_2020 is an sf object</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>map_data_2020 <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(map_data_2020)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create neighbor list for 2020</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>nb_2020 <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(map_data_2020)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weights for 2020</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>weights_2020 <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(nb_2020, <span class="at">allow_zero =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure total_cases is numeric</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>map_data_2020<span class="sc">$</span>total_cases <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(map_data_2020<span class="sc">$</span>total_cases)</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate global Moran's I</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>moran_i_2020 <span class="ot">&lt;-</span> <span class="fu">global_moran_test</span>(map_data_2020<span class="sc">$</span>total_cases, nb_2020, weights_2020, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2020)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 1.9969, p-value = 0.02292
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.129597584      -0.013333333       0.005123377 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Moran's I</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>local_moran_results_2020 <span class="ot">&lt;-</span> <span class="fu">local_moran</span>(</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  map_data_2020<span class="sc">$</span>total_cases, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  nb_2020, </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  weights_2020, </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>, </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero.policy =</span> <span class="cn">TRUE</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add results to the map_data_2020</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>map_data_2020 <span class="ot">&lt;-</span> map_data_2020 <span class="sc">%&gt;%</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_i =</span> local_moran_results_2020<span class="sc">$</span>Ii,</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_p =</span> local_moran_results_2020<span class="sc">$</span>p_folded_sim,</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_z =</span> local_moran_results_2020<span class="sc">$</span>Z.Ii</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate LISA clusters</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>map_data_2020 <span class="ot">&lt;-</span> map_data_2020 <span class="sc">%&gt;%</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_lag =</span> <span class="fu">st_lag</span>(total_cases, nb_2020, weights_2020),</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_scale =</span> <span class="fu">scale</span>(total_cases),</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag_scale =</span> <span class="fu">scale</span>(case_lag),</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">lisa_cluster =</span> <span class="fu">case_when</span>(</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>      local_moran_p <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-High"</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map of LISA clusters</span></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2020) <span class="sc">+</span></span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> lisa_cluster), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"High-High"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Low-High"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"High-Low"</span> <span class="ot">=</span> <span class="st">"lightpink"</span>, <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"grey90"</span>),</span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"LISA Cluster Type"</span></span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"LISA Cluster Map of Drug Abuse Cases in Thailand (2020)"</span>,</span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on Local Moran's I"</span>) <span class="sc">+</span></span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Gi*</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>gi_stars_2020 <span class="ot">&lt;-</span> <span class="fu">local_g_perm</span>(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  map_data_2020<span class="sc">$</span>total_cases,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  nb_2020,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  weights_2020,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Gi* results to the map_data_2020</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>map_data_2020<span class="sc">$</span>gi_star <span class="ot">&lt;-</span> gi_stars_2020<span class="sc">$</span>gi</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>map_data_2020<span class="sc">$</span>gi_p_sim <span class="ot">&lt;-</span> gi_stars_2020<span class="sc">$</span>p_sim</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>map_data_2020<span class="sc">$</span>gi_p_folded_sim <span class="ot">&lt;-</span> gi_stars_2020<span class="sc">$</span>p_folded_sim</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map displaying the actual Gi* values</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2020) <span class="sc">+</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gi_star), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>,</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gi* Value"</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Gi* Value Map of Drug Abuse Cases in Thailand (2020)"</span>,</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Displaying Getis-Ord Gi* Statistic"</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>drug_summary_2021 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> <span class="dv">2021</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span> </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_cases))</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>map_data_2021 <span class="ot">&lt;-</span> adm1 <span class="sc">%&gt;%</span> </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(drug_summary_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure map_data_2021 is an sf object</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>map_data_2021 <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(map_data_2021)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create neighbor list for 2021</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>nb_2021 <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(map_data_2021)</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weights for 2021</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>weights_2021 <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(nb_2021, <span class="at">allow_zero =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure total_cases is numeric</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>map_data_2021<span class="sc">$</span>total_cases <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(map_data_2021<span class="sc">$</span>total_cases)</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate global Moran's I</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>moran_i_2021 <span class="ot">&lt;-</span> <span class="fu">global_moran_test</span>(map_data_2021<span class="sc">$</span>total_cases, nb_2021, weights_2021, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2021)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.8146, p-value = 0.002442
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.198888805      -0.013333333       0.005685208 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Moran's I</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>local_moran_results_2021 <span class="ot">&lt;-</span> <span class="fu">local_moran</span>(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  map_data_2021<span class="sc">$</span>total_cases, </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  nb_2021, </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  weights_2021, </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>, </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero.policy =</span> <span class="cn">TRUE</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add results to the map_data_2021</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>map_data_2021 <span class="ot">&lt;-</span> map_data_2021 <span class="sc">%&gt;%</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_i =</span> local_moran_results_2021<span class="sc">$</span>Ii,</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_p =</span> local_moran_results_2021<span class="sc">$</span>p_folded_sim,</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_z =</span> local_moran_results_2021<span class="sc">$</span>Z.Ii</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate LISA clusters</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>map_data_2021 <span class="ot">&lt;-</span> map_data_2021 <span class="sc">%&gt;%</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_lag =</span> <span class="fu">st_lag</span>(total_cases, nb_2021, weights_2021),</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_scale =</span> <span class="fu">scale</span>(total_cases),</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag_scale =</span> <span class="fu">scale</span>(case_lag),</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">lisa_cluster =</span> <span class="fu">case_when</span>(</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>      local_moran_p <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-High"</span></span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map of LISA clusters</span></span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2021) <span class="sc">+</span></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> lisa_cluster), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"High-High"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Low-High"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"High-Low"</span> <span class="ot">=</span> <span class="st">"lightpink"</span>, <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"grey90"</span>),</span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"LISA Cluster Type"</span></span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"LISA Cluster Map of Drug Abuse Cases in Thailand (2021)"</span>,</span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on Local Moran's I"</span>) <span class="sc">+</span></span>
<span id="cb71-44"><a href="#cb71-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Gi*</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>gi_stars_2021 <span class="ot">&lt;-</span> <span class="fu">local_g_perm</span>(</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  map_data_2021<span class="sc">$</span>total_cases,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  nb_2021,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  weights_2021,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Gi* results to the map_data_2021</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>map_data_2021<span class="sc">$</span>gi_star <span class="ot">&lt;-</span> gi_stars_2021<span class="sc">$</span>gi</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>map_data_2021<span class="sc">$</span>gi_p_sim <span class="ot">&lt;-</span> gi_stars_2021<span class="sc">$</span>p_sim</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>map_data_2021<span class="sc">$</span>gi_p_folded_sim <span class="ot">&lt;-</span> gi_stars_2021<span class="sc">$</span>p_folded_sim</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map displaying the actual Gi* values</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2021) <span class="sc">+</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gi_star), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>,</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gi* Value"</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Gi* Value Map of Drug Abuse Cases in Thailand (2021)"</span>,</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Displaying Getis-Ord Gi* Statistic"</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>drug_summary_2022 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span> </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_cases))</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>map_data_2022 <span class="ot">&lt;-</span> adm1 <span class="sc">%&gt;%</span> </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(drug_summary_2022, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure map_data_2022 is an sf object</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>map_data_2022 <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(map_data_2022)</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create neighbor list for 2022</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>nb_2022 <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(map_data_2022)</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weights for 2022</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>weights_2022 <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(nb_2022, <span class="at">allow_zero =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure total_cases is numeric</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>map_data_2022<span class="sc">$</span>total_cases <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(map_data_2022<span class="sc">$</span>total_cases)</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate global Moran's I</span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>moran_i_2022 <span class="ot">&lt;-</span> <span class="fu">global_moran_test</span>(map_data_2022<span class="sc">$</span>total_cases, nb_2022, weights_2022, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.7999, p-value = 0.002556
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
       0.20112705       -0.01333333        0.00586698 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Moran's I</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>local_moran_results_2022 <span class="ot">&lt;-</span> <span class="fu">local_moran</span>(</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  map_data_2022<span class="sc">$</span>total_cases, </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  nb_2022, </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  weights_2022, </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>, </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero.policy =</span> <span class="cn">TRUE</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add results to the map_data_2022</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>map_data_2022 <span class="ot">&lt;-</span> map_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_i =</span> local_moran_results_2022<span class="sc">$</span>Ii,</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_p =</span> local_moran_results_2022<span class="sc">$</span>p_folded_sim,</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">local_moran_z =</span> local_moran_results_2022<span class="sc">$</span>Z.Ii</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate LISA clusters</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>map_data_2022 <span class="ot">&lt;-</span> map_data_2022 <span class="sc">%&gt;%</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_lag =</span> <span class="fu">st_lag</span>(total_cases, nb_2022, weights_2022),</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">case_scale =</span> <span class="fu">scale</span>(total_cases),</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag_scale =</span> <span class="fu">scale</span>(case_lag),</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">lisa_cluster =</span> <span class="fu">case_when</span>(</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>      local_moran_p <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"Not Significant"</span>,</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-High"</span>,</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-Low"</span>,</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"High-Low"</span>,</span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>      case_scale <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lag_scale <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low-High"</span></span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map of LISA clusters</span></span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2022) <span class="sc">+</span></span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> lisa_cluster), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"High-High"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Low-High"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"High-Low"</span> <span class="ot">=</span> <span class="st">"lightpink"</span>, <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"grey90"</span>),</span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"LISA Cluster Type"</span></span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"LISA Cluster Map of Drug Abuse Cases in Thailand (2022)"</span>,</span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on Local Moran's I"</span>) <span class="sc">+</span></span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Local Gi*</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>gi_stars_2022 <span class="ot">&lt;-</span> <span class="fu">local_g_perm</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  map_data_2022<span class="sc">$</span>total_cases,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  nb_2022,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  weights_2022,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Gi* results to the map_data_2022</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>map_data_2022<span class="sc">$</span>gi_star <span class="ot">&lt;-</span> gi_stars_2022<span class="sc">$</span>gi</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>map_data_2022<span class="sc">$</span>gi_p_sim <span class="ot">&lt;-</span> gi_stars_2022<span class="sc">$</span>p_sim</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>map_data_2022<span class="sc">$</span>gi_p_folded_sim <span class="ot">&lt;-</span> gi_stars_2022<span class="sc">$</span>p_folded_sim</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map displaying the actual Gi* values</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(map_data_2022) <span class="sc">+</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gi_star), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>,</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gi* Value"</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Gi* Value Map of Drug Abuse Cases in Thailand (2022)"</span>,</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Displaying Getis-Ord Gi* Statistic"</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-21-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create LISA cluster map</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>create_lisa_map <span class="ot">&lt;-</span> <span class="cf">function</span>(map_data, year) {</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(map_data) <span class="sc">+</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> lisa_cluster), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"High-High"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Low-Low"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Low-High"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, <span class="st">"High-Low"</span> <span class="ot">=</span> <span class="st">"lightpink"</span>, <span class="st">"Not Significant"</span> <span class="ot">=</span> <span class="st">"grey90"</span>),</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"LISA Cluster Type"</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"LISA"</span>, year)) <span class="sc">+</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create Gi* value map</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>create_gi_star_map <span class="ot">&lt;-</span> <span class="cf">function</span>(map_data, year) {</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(map_data) <span class="sc">+</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> gi_star), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">low =</span> <span class="st">"blue"</span>,</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"Gi* Value"</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Gi*"</span>, year)) <span class="sc">+</span></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"none"</span>, </span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Create LISA maps for all years</span></span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a>lisa_map_2017 <span class="ot">&lt;-</span> <span class="fu">create_lisa_map</span>(map_data_2017, <span class="dv">2017</span>)</span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a>lisa_map_2018 <span class="ot">&lt;-</span> <span class="fu">create_lisa_map</span>(map_data_2018, <span class="dv">2018</span>)</span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a>lisa_map_2019 <span class="ot">&lt;-</span> <span class="fu">create_lisa_map</span>(map_data_2019, <span class="dv">2019</span>)</span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a>lisa_map_2020 <span class="ot">&lt;-</span> <span class="fu">create_lisa_map</span>(map_data_2020, <span class="dv">2020</span>)</span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a>lisa_map_2021 <span class="ot">&lt;-</span> <span class="fu">create_lisa_map</span>(map_data_2021, <span class="dv">2021</span>)</span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a>lisa_map_2022 <span class="ot">&lt;-</span> <span class="fu">create_lisa_map</span>(map_data_2022, <span class="dv">2022</span>)</span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Gi* maps for all years</span></span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a>gi_star_map_2017 <span class="ot">&lt;-</span> <span class="fu">create_gi_star_map</span>(map_data_2017, <span class="dv">2017</span>)</span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a>gi_star_map_2018 <span class="ot">&lt;-</span> <span class="fu">create_gi_star_map</span>(map_data_2018, <span class="dv">2018</span>)</span>
<span id="cb77-54"><a href="#cb77-54" aria-hidden="true" tabindex="-1"></a>gi_star_map_2019 <span class="ot">&lt;-</span> <span class="fu">create_gi_star_map</span>(map_data_2019, <span class="dv">2019</span>)</span>
<span id="cb77-55"><a href="#cb77-55" aria-hidden="true" tabindex="-1"></a>gi_star_map_2020 <span class="ot">&lt;-</span> <span class="fu">create_gi_star_map</span>(map_data_2020, <span class="dv">2020</span>)</span>
<span id="cb77-56"><a href="#cb77-56" aria-hidden="true" tabindex="-1"></a>gi_star_map_2021 <span class="ot">&lt;-</span> <span class="fu">create_gi_star_map</span>(map_data_2021, <span class="dv">2021</span>)</span>
<span id="cb77-57"><a href="#cb77-57" aria-hidden="true" tabindex="-1"></a>gi_star_map_2022 <span class="ot">&lt;-</span> <span class="fu">create_gi_star_map</span>(map_data_2022, <span class="dv">2022</span>)</span>
<span id="cb77-58"><a href="#cb77-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-59"><a href="#cb77-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all LISA maps</span></span>
<span id="cb77-60"><a href="#cb77-60" aria-hidden="true" tabindex="-1"></a>combined_lisa <span class="ot">&lt;-</span> (lisa_map_2017 <span class="sc">|</span> lisa_map_2018 <span class="sc">|</span> lisa_map_2019) <span class="sc">/</span></span>
<span id="cb77-61"><a href="#cb77-61" aria-hidden="true" tabindex="-1"></a>                 (lisa_map_2020 <span class="sc">|</span> lisa_map_2021 <span class="sc">|</span> lisa_map_2022) <span class="sc">+</span></span>
<span id="cb77-62"><a href="#cb77-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb77-63"><a href="#cb77-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"LISA Cluster Maps of Drug Abuse Cases in Thailand (2017-2022)"</span>,</span>
<span id="cb77-64"><a href="#cb77-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb77-65"><a href="#cb77-65" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-66"><a href="#cb77-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-67"><a href="#cb77-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all Gi* maps</span></span>
<span id="cb77-68"><a href="#cb77-68" aria-hidden="true" tabindex="-1"></a>combined_gi_star <span class="ot">&lt;-</span> (gi_star_map_2017 <span class="sc">|</span> gi_star_map_2018 <span class="sc">|</span> gi_star_map_2019) <span class="sc">/</span></span>
<span id="cb77-69"><a href="#cb77-69" aria-hidden="true" tabindex="-1"></a>                    (gi_star_map_2020 <span class="sc">|</span> gi_star_map_2021 <span class="sc">|</span> gi_star_map_2022) <span class="sc">+</span></span>
<span id="cb77-70"><a href="#cb77-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb77-71"><a href="#cb77-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Gi* Value Maps of Drug Abuse Cases in Thailand (2017-2022)"</span>,</span>
<span id="cb77-72"><a href="#cb77-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb77-73"><a href="#cb77-73" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-74"><a href="#cb77-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-75"><a href="#cb77-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the combined maps</span></span>
<span id="cb77-76"><a href="#cb77-76" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(combined_lisa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(combined_gi_star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Takehome_Ex2_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Moran I 2017"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Moran I 2017"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2017)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.4598, p-value = 0.006951
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.133140650      -0.013333333       0.003545946 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Moran I 2018"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Moran I 2018"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2018)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.1529, p-value = 0.01566
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.116368909      -0.013333333       0.003629353 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Moran I 2019"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Moran I 2019"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2019)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.4911, p-value = 0.006367
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.155405262      -0.013333333       0.004588259 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Moran I 2020"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Moran I 2020"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2020)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 1.9969, p-value = 0.02292
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.129597584      -0.013333333       0.005123377 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Moran I 2021"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Moran I 2021"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2021)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.8146, p-value = 0.002442
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.198888805      -0.013333333       0.005685208 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Moran I 2022"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Moran I 2022"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_i_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 2.7999, p-value = 0.002556
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
       0.20112705       -0.01333333        0.00586698 </code></pre>
</div>
</div>
<ol type="1">
<li>Moran’s I Statistics:
<ul>
<li>All years show statistically significant positive spatial autocorrelation (p-values &lt; 0.05).</li>
<li>The Moran’s I statistic increases over time, from 0.133 in 2017 to 0.201 in 2022, indicating strengthening spatial clustering.</li>
<li>The most significant jump occurs between 2020 (I = 0.130) and 2021 (I = 0.199), suggesting a notable increase in spatial dependency.</li>
</ul></li>
<li>LISA Cluster Maps:
<ul>
<li>2017-2020: Consistent Low-Low cluster in the western region and small High-High clusters in the central and southern regions.</li>
<li>2021: Significant expansion of the Low-Low cluster in the west and central regions.</li>
<li>2022: Dramatic shift with a large High-High cluster emerging in the northeastern region, while maintaining the western Low-Low cluster.</li>
</ul></li>
<li>Gi* Value Maps:
<ul>
<li>2017-2019: Relatively stable patterns with cold spots (purple) in the west and hot spots (red) in the south and central regions.</li>
<li>2020: Intensification of the western cold spot and southern hot spot.</li>
<li>2021: Significant expansion of the western cold spot and intensification of the southern hot spot.</li>
<li>2022: Major shift with a new large hot spot in the northeast, while maintaining the western cold spot.</li>
</ul></li>
</ol>
<p>Key Observations on Temporal Evolution:</p>
<ol type="1">
<li><p>Increasing Spatial Dependency: The consistent increase in Moran’s I values indicates that drug abuse patterns became more spatially clustered over time.</p></li>
<li><p>Stability and Change:</p>
<ul>
<li>Western Region: Consistently maintained as a Low-Low cluster/cold spot throughout the period.</li>
<li>Southern Region: Relatively stable hot spot, with some fluctuations in intensity.</li>
<li>Northeastern Region: Dramatic shift in 2022, emerging as a significant High-High cluster/hot spot.</li>
</ul></li>
<li><p>Critical Transition in 2021-2022:</p>
<ul>
<li>2021 marked a significant increase in spatial clustering.</li>
<li>2022 saw a major redistribution of drug abuse patterns, with the northeastern region becoming a new area of concern.</li>
</ul></li>
<li><p>Regional Dynamics:</p>
<ul>
<li>The western region consistently performed well in managing drug abuse.</li>
<li>The southern region remained a persistent area of concern.</li>
<li>The northeastern region’s sudden emergence as a hot spot in 2022 warrants immediate attention.</li>
</ul></li>
</ol>
</section>
<section id="overall-spatial-patterns-analysis" class="level1">
<h1><strong>Overall Spatial Patterns Analysis</strong></h1>
<p>Based on all the analyses conducted, including the LISA Cluster Maps, Gi* Value Maps, and Moran’s I statistics from 2017 to 2022, we can describe the following spatial patterns of drug abuse cases in Thailand:</p>
<ol type="1">
<li><strong>Overall Spatial Dependency</strong>:
<ul>
<li>Throughout the study period, drug abuse cases in Thailand consistently showed significant positive spatial autocorrelation.</li>
<li>This indicates that provinces with similar levels of drug abuse tend to cluster together, rather than being randomly distributed across the country.</li>
<li>The strength of this spatial dependency increased over time, with Moran’s I values rising from 0.133 in 2017 to 0.201 in 2022.</li>
</ul></li>
<li><strong>Persistent Western Cold Spot</strong>:
<ul>
<li>The western region of Thailand consistently appeared as a Low-Low cluster in LISA maps and a cold spot in Gi* maps across all years.</li>
<li>This area maintained lower drug abuse rates compared to the national average, suggesting the presence of protective factors or effective drug control measures in this region.</li>
</ul></li>
<li><strong>Southern Hot Spot Evolution</strong>:
<ul>
<li>The southern peninsula of Thailand frequently appeared as a hot spot or High-High cluster, particularly in the earlier years of the study period (2017-2020).</li>
<li>This region consistently showed higher rates of drug abuse cases during this time, indicating a persistent problem area.</li>
<li>However, by 2022, the southern region’s drug offense rates decreased significantly, becoming comparable to the rest of the country.</li>
</ul></li>
<li><strong>Central Region Variability</strong>:
<ul>
<li>The central region, including and surrounding Bangkok, consistently appeared as a hotspot from 2017 to 2021.</li>
<li>This densely populated area maintained higher rates of drug abuse cases compared to the national average for most of the study period.</li>
<li>However, in 2022, there was a significant decrease in drug offense cases in this region. By 2022, the central region, including Bangkok, ceased to be a hotspot for drug offense cases and returned to levels comparable with the rest of the country.</li>
<li>This shift suggests a potentially successful implementation of drug control measures or changes in socio-economic factors influencing drug abuse patterns in this urban center.</li>
</ul></li>
<li><strong>Northeastern Region Shift</strong>:
<ul>
<li>From 2017 to 2021, the northeastern region showed relatively low or non-significant clustering in terms of drug offense hot spots.</li>
<li>In 2022, it emerged as a significant High-High cluster and hot spot in relative terms.</li>
<li>However, when examining the total drug offense cases by year, the region actually shows relatively stable numbers throughout the study period.</li>
<li>The apparent emergence of the northeastern region as a hot spot in 2022 is primarily due to a significant decrease in drug offense cases in other parts of the country, rather than an increase in the northeast itself.</li>
</ul></li>
<li><strong>Border Region Patterns</strong>:
<ul>
<li>Provinces bordering neighboring countries often showed significant clustering, though the nature of these clusters varied:
<ul>
<li>Western border: Consistently low drug abuse rates</li>
<li>Southern border: Initially high rates, but decreasing by 2022</li>
<li>Northern and eastern borders: Variable patterns, with a notable relative shift in the northeast in 2022</li>
</ul></li>
</ul></li>
<li><strong>Urban-Rural Divide</strong>:
<ul>
<li>Major urban centers, particularly in the central region (Bangkok), often showed distinct patterns compared to surrounding rural areas, though this distinction lessened by 2022.</li>
</ul></li>
<li><strong>Temporal Evolution</strong>:
<ul>
<li>The western cold spot remained stable, while other regions experienced more dynamic shifts.</li>
<li>A general trend of decreasing drug offense cases was observed across much of the country by 2022.</li>
</ul></li>
<li><strong>Regional Contrasts</strong>:
<ul>
<li>Clear contrasts emerged between different regions of Thailand, but these contrasts evolved over time:
<ul>
<li>The western region consistently performed well in managing drug abuse.</li>
<li>The southern region transitioned from a persistent area of concern to showing improvement by 2022.</li>
<li>The northeastern region appeared to become a relative hotspot due to decreases elsewhere, rather than absolute increases.</li>
</ul></li>
</ul></li>
<li><strong>Spatial Outliers</strong>:
<ul>
<li>Occasional Low-High or High-Low outliers appeared in different years, representing provinces that diverged from their neighbors’ patterns.</li>
</ul></li>
</ol>
<p>In summary, the spatial patterns of drug abuse in Thailand reveal a complex, dynamic landscape with significant regional variations. While some areas maintained consistent patterns over time, others underwent dramatic changes, particularly in the latter years of the study period.</p>
<p>The overall trend by 2022 shows a general decrease in drug offense cases across much of the country.</p>
</section>
<section id="bonus-section-advanced-spatio-temporal-analysis-using-space-time-cube" class="level1">
<h1><strong>Bonus Section: Advanced Spatio-Temporal Analysis Using Space-Time Cube</strong></h1>
<p>To gain deeper insights into the temporal and spatial dynamics of drug abuse cases in Thailand, we employed an advanced visualization technique known as Space-Time Cube Analysis. This method goes beyond traditional 2D mapping and time series analysis by integrating both spatial and temporal dimensions into a single 3D visualization.</p>
<p><strong>Methodology:</strong></p>
<p>We created a 3D scatter plot using R and the Plotly library, where: - X and Y axes represent geographical space (longitude and latitude of Thai provinces) - Z-axis represents time (fiscal years from 2017 to 2022) - Point size and color intensity indicate the number of drug abuse cases</p>
<p>The Space-Time Cube Analysis offers several advantages over conventional methods:</p>
<p>1. Simultaneous visualization of spatial and temporal trends</p>
<p>2. Enhanced pattern recognition in three-dimensional space</p>
<p>3. Ability to identify persistent hotspots, emerging problem areas, and improving regions</p>
<p>4. Potential for interactive exploration</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for all years</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>drug_summary_all <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en, fiscal_year) <span class="sc">%&gt;%</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Join with spatial data</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>map_data_all <span class="ot">&lt;-</span> adm1 <span class="sc">%&gt;%</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(drug_summary_all, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>))</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate centroids of each province</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(map_data_all)</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>centroids_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(centroids)</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the 3D plot</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>() <span class="sc">%&gt;%</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> centroids_coords[, <span class="dv">1</span>],</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> centroids_coords[, <span class="dv">2</span>],</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> map_data_all<span class="sc">$</span>fiscal_year,</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> map_data_all<span class="sc">$</span>total_cases,</span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> map_data_all<span class="sc">$</span>total_cases,</span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter3d"</span>,</span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">'circle'</span>, <span class="at">sizemode =</span> <span class="st">'diameter'</span>),</span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">hoverinfo =</span> <span class="st">'text'</span>,</span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste</span>(<span class="st">"Province: "</span>, map_data_all<span class="sc">$</span>ADM1_EN, </span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"&lt;br&gt;Year: "</span>, map_data_all<span class="sc">$</span>fiscal_year,</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"&lt;br&gt;Total Cases: "</span>, map_data_all<span class="sc">$</span>total_cases)</span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb103-33"><a href="#cb103-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Longitude"</span>),</span>
<span id="cb103-34"><a href="#cb103-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Latitude"</span>),</span>
<span id="cb103-35"><a href="#cb103-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Year"</span>)</span>
<span id="cb103-36"><a href="#cb103-36" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb103-37"><a href="#cb103-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Space-Time Cube of Drug Abuse Cases in Thailand (2017-2022)"</span></span>
<span id="cb103-38"><a href="#cb103-38" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-7695744ab5b8c17a9046" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-7695744ab5b8c17a9046">{"x":{"visdat":{"3abc3f967139":["function () ","plotlyVisDat"]},"cur_data":"3abc3f967139","attrs":{"3abc3f967139":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[100.62346136424746,100.62346136424746,100.62346136424746,100.62346136424746,100.62346136424746,100.62346136424746,100.71023157204732,100.71023157204732,100.71023157204732,100.71023157204732,100.71023157204732,100.71023157204732,100.39284437729408,100.39284437729408,100.39284437729408,100.39284437729408,100.39284437729408,100.39284437729408,100.68237573701045,100.68237573701045,100.68237573701045,100.68237573701045,100.68237573701045,100.68237573701045,100.52658206775011,100.52658206775011,100.52658206775011,100.52658206775011,100.52658206775011,100.52658206775011,100.34852189532658,100.34852189532658,100.34852189532658,100.34852189532658,100.34852189532658,100.34852189532658,100.90693523816465,100.90693523816465,100.90693523816465,100.90693523816465,100.90693523816465,100.90693523816465,100.34721554976805,100.34721554976805,100.34721554976805,100.34721554976805,100.34721554976805,100.34721554976805,100.02746225500066,100.02746225500066,100.02746225500066,100.02746225500066,100.02746225500066,100.02746225500066,101.01687337340066,101.01687337340066,101.01687337340066,101.01687337340066,101.01687337340066,101.01687337340066,101.20152594716131,101.20152594716131,101.20152594716131,101.20152594716131,101.20152594716131,101.20152594716131,101.4274815704137,101.4274815704137,101.4274815704137,101.4274815704137,101.4274815704137,101.4274815704137,102.13018937580715,102.13018937580715,102.13018937580715,102.13018937580715,102.13018937580715,102.13018937580715,102.52166692213197,102.52166692213197,102.52166692213197,102.52166692213197,102.52166692213197,102.52166692213197,101.42566537600294,101.42566537600294,101.42566537600294,101.42566537600294,101.42566537600294,101.42566537600294,101.65029268511354,101.65029268511354,101.65029268511354,101.65029268511354,101.65029268511354,101.65029268511354,101.17132031170088,101.17132031170088,101.17132031170088,101.17132031170088,101.17132031170088,101.17132031170088,102.32254595676091,102.32254595676091,102.32254595676091,102.32254595676091,102.32254595676091,102.32254595676091,102.10918946975428,102.10918946975428,102.10918946975428,102.10918946975428,102.10918946975428,102.10918946975428,102.95638684337747,102.95638684337747,102.95638684337747,102.95638684337747,102.95638684337747,102.95638684337747,103.65589320101067,103.65589320101067,103.65589320101067,103.65589320101067,103.65589320101067,103.65589320101067,104.36937796146215,104.36937796146215,104.36937796146215,104.36937796146215,104.36937796146215,104.36937796146215,105.11159291657839,105.11159291657839,105.11159291657839,105.11159291657839,105.11159291657839,105.11159291657839,104.33828904209687,104.33828904209687,104.33828904209687,104.33828904209687,104.33828904209687,104.33828904209687,101.81923565920435,101.81923565920435,101.81923565920435,101.81923565920435,101.81923565920435,101.81923565920435,104.74125515291696,104.74125515291696,104.74125515291696,104.74125515291696,104.74125515291696,104.74125515291696,103.71112124377785,103.71112124377785,103.71112124377785,103.71112124377785,103.71112124377785,103.71112124377785,102.30251002772171,102.30251002772171,102.30251002772171,102.30251002772171,102.30251002772171,102.30251002772171,102.57837215749053,102.57837215749053,102.57837215749053,102.57837215749053,102.57837215749053,102.57837215749053,102.86324901561068,102.86324901561068,102.86324901561068,102.86324901561068,102.86324901561068,102.86324901561068,101.63584153310288,101.63584153310288,101.63584153310288,101.63584153310288,101.63584153310288,101.63584153310288,102.83371850222453,102.83371850222453,102.83371850222453,102.83371850222453,102.83371850222453,102.83371850222453,103.16573568947332,103.16573568947332,103.16573568947332,103.16573568947332,103.16573568947332,103.16573568947332,103.81363127030255,103.81363127030255,103.81363127030255,103.81363127030255,103.81363127030255,103.81363127030255,103.6219325474386,103.6219325474386,103.6219325474386,103.6219325474386,103.6219325474386,103.6219325474386,103.82457063077901,103.82457063077901,103.82457063077901,103.82457063077901,103.82457063077901,103.82457063077901,104.42992041019586,104.42992041019586,104.42992041019586,104.42992041019586,104.42992041019586,104.42992041019586,104.51740134873387,104.51740134873387,104.51740134873387,104.51740134873387,104.51740134873387,104.51740134873387,98.726311920539317,98.726311920539317,98.726311920539317,98.726311920539317,98.726311920539317,98.726311920539317,98.95455696992417,98.95455696992417,98.95455696992417,98.95455696992417,98.95455696992417,98.95455696992417,99.511090102610538,99.511090102610538,99.511090102610538,99.511090102610538,99.511090102610538,99.511090102610538,100.51385903697164,100.51385903697164,100.51385903697164,100.51385903697164,100.51385903697164,100.51385903697164,100.06414359125134,100.06414359125134,100.06414359125134,100.06414359125134,100.06414359125134,100.06414359125134,100.83458608466044,100.83458608466044,100.83458608466044,100.83458608466044,100.83458608466044,100.83458608466044,100.19116097905194,100.19116097905194,100.19116097905194,100.19116097905194,100.19116097905194,100.19116097905194,99.865546708332758,99.865546708332758,99.865546708332758,99.865546708332758,99.865546708332758,99.865546708332758,98.02949974473222,98.02949974473222,98.02949974473222,98.02949974473222,98.02949974473222,98.02949974473222,100.15247854629372,100.15247854629372,100.15247854629372,100.15247854629372,100.15247854629372,100.15247854629372,99.478191527351228,99.478191527351228,99.478191527351228,99.478191527351228,99.478191527351228,99.478191527351228,99.53429737636543,99.53429737636543,99.53429737636543,99.53429737636543,99.53429737636543,99.53429737636543,98.793293074641312,98.793293074641312,98.793293074641312,98.793293074641312,98.793293074641312,98.793293074641312,99.711025160045722,99.711025160045722,99.711025160045722,99.711025160045722,99.711025160045722,99.711025160045722,100.5445275959101,100.5445275959101,100.5445275959101,100.5445275959101,100.5445275959101,100.5445275959101,100.34280180642683,100.34280180642683,100.34280180642683,100.34280180642683,100.34280180642683,100.34280180642683,101.14753472624987,101.14753472624987,101.14753472624987,101.14753472624987,101.14753472624987,101.14753472624987,99.578280336182232,99.578280336182232,99.578280336182232,99.578280336182232,99.578280336182232,99.578280336182232,99.047730045254099,99.047730045254099,99.047730045254099,99.047730045254099,99.047730045254099,99.047730045254099,99.891547512508552,99.891547512508552,99.891547512508552,99.891547512508552,99.891547512508552,99.891547512508552,100.10314950394655,100.10314950394655,100.10314950394655,100.10314950394655,100.10314950394655,100.10314950394655,100.21173868339022,100.21173868339022,100.21173868339022,100.21173868339022,100.21173868339022,100.21173868339022,99.953134610074017,99.953134610074017,99.953134610074017,99.953134610074017,99.953134610074017,99.953134610074017,99.618819445993097,99.618819445993097,99.618819445993097,99.618819445993097,99.618819445993097,99.618819445993097,99.633681582997326,99.633681582997326,99.633681582997326,99.633681582997326,99.633681582997326,99.633681582997326,99.787584295148818,99.787584295148818,99.787584295148818,99.787584295148818,99.787584295148818,99.787584295148818,99.020357410482532,99.020357410482532,99.020357410482532,99.020357410482532,99.020357410482532,99.020357410482532,98.418333815614915,98.418333815614915,98.418333815614915,98.418333815614915,98.418333815614915,98.418333815614915,98.346339414005271,98.346339414005271,98.346339414005271,98.346339414005271,98.346339414005271,98.346339414005271,99.091623329689639,99.091623329689639,99.091623329689639,99.091623329689639,99.091623329689639,99.091623329689639,98.69611038772419,98.69611038772419,98.69611038772419,98.69611038772419,98.69611038772419,98.69611038772419,99.061484507694573,99.061484507694573,99.061484507694573,99.061484507694573,99.061484507694573,99.061484507694573,100.54561631140365,100.54561631140365,100.54561631140365,100.54561631140365,100.54561631140365,100.54561631140365,99.926930333294507,99.926930333294507,99.926930333294507,99.926930333294507,99.926930333294507,99.926930333294507,99.594519472512076,99.594519472512076,99.594519472512076,99.594519472512076,99.594519472512076,99.594519472512076,100.06954070275103,100.06954070275103,100.06954070275103,100.06954070275103,100.06954070275103,100.06954070275103,101.34979080945477,101.34979080945477,101.34979080945477,101.34979080945477,101.34979080945477,101.34979080945477,101.22850408114085,101.22850408114085,101.22850408114085,101.22850408114085,101.22850408114085,101.22850408114085,101.71890058390012,101.71890058390012,101.71890058390012,101.71890058390012,101.71890058390012,101.71890058390012],"y":[13.771842642937594,13.771842642937594,13.771842642937594,13.771842642937594,13.771842642937594,13.771842642937594,13.596531641263732,13.596531641263732,13.596531641263732,13.596531641263732,13.596531641263732,13.596531641263732,13.924141651583613,13.924141651583613,13.924141651583613,13.924141651583613,13.924141651583613,13.924141651583613,14.065156444017401,14.065156444017401,14.065156444017401,14.065156444017401,14.065156444017401,14.065156444017401,14.345321207193846,14.345321207193846,14.345321207193846,14.345321207193846,14.345321207193846,14.345321207193846,14.623523184634754,14.623523184634754,14.623523184634754,14.623523184634754,14.623523184634754,14.623523184634754,15.107539548515751,15.107539548515751,15.107539548515751,15.107539548515751,15.107539548515751,15.107539548515751,14.912490065733344,14.912490065733344,14.912490065733344,14.912490065733344,14.912490065733344,14.912490065733344,15.133889617364774,15.133889617364774,15.133889617364774,15.133889617364774,15.133889617364774,15.133889617364774,14.626539800996554,14.626539800996554,14.626539800996554,14.626539800996554,14.626539800996554,14.626539800996554,13.191384933855957,13.191384933855957,13.191384933855957,13.191384933855957,13.191384933855957,13.191384933855957,12.854335509941485,12.854335509941485,12.854335509941485,12.854335509941485,12.854335509941485,12.854335509941485,12.880990449397574,12.880990449397574,12.880990449397574,12.880990449397574,12.880990449397574,12.880990449397574,12.315809477354154,12.315809477354154,12.315809477354154,12.315809477354154,12.315809477354154,12.315809477354154,13.606554292405297,13.606554292405297,13.606554292405297,13.606554292405297,13.606554292405297,13.606554292405297,14.04805232636498,14.04805232636498,14.04805232636498,14.04805232636498,14.04805232636498,14.04805232636498,14.217073842445865,14.217073842445865,14.217073842445865,14.217073842445865,14.217073842445865,14.217073842445865,13.787181209128988,13.787181209128988,13.787181209128988,13.787181209128988,13.787181209128988,13.787181209128988,14.957015165346613,14.957015165346613,14.957015165346613,14.957015165346613,14.957015165346613,14.957015165346613,14.819436338853901,14.819436338853901,14.819436338853901,14.819436338853901,14.819436338853901,14.819436338853901,14.885448090327689,14.885448090327689,14.885448090327689,14.885448090327689,14.885448090327689,14.885448090327689,14.856271065160547,14.856271065160547,14.856271065160547,14.856271065160547,14.856271065160547,14.856271065160547,15.182769400387267,15.182769400387267,15.182769400387267,15.182769400387267,15.182769400387267,15.182769400387267,15.895705710022401,15.895705710022401,15.895705710022401,15.895705710022401,15.895705710022401,15.895705710022401,16.031734828746259,16.031734828746259,16.031734828746259,16.031734828746259,16.031734828746259,16.031734828746259,15.892525697933207,15.892525697933207,15.892525697933207,15.892525697933207,15.892525697933207,15.892525697933207,18.148809022252419,18.148809022252419,18.148809022252419,18.148809022252419,18.148809022252419,18.148809022252419,17.18149934201405,17.18149934201405,17.18149934201405,17.18149934201405,17.18149934201405,17.18149934201405,16.408266039267097,16.408266039267097,16.408266039267097,16.408266039267097,16.408266039267097,16.408266039267097,17.424398898916309,17.424398898916309,17.424398898916309,17.424398898916309,17.424398898916309,17.424398898916309,17.408751108842939,17.408751108842939,17.408751108842939,17.408751108842939,17.408751108842939,17.408751108842939,17.940798929048551,17.940798929048551,17.940798929048551,17.940798929048551,17.940798929048551,17.940798929048551,15.999373307434064,15.999373307434064,15.999373307434064,15.999373307434064,15.999373307434064,15.999373307434064,15.919542964523277,15.919542964523277,15.919542964523277,15.919542964523277,15.919542964523277,15.919542964523277,16.628017874948977,16.628017874948977,16.628017874948977,16.628017874948977,16.628017874948977,16.628017874948977,17.389511189745487,17.389511189745487,17.389511189745487,17.389511189745487,17.389511189745487,17.389511189745487,17.384408021449254,17.384408021449254,17.384408021449254,17.384408021449254,17.384408021449254,17.384408021449254,16.56267101869096,16.56267101869096,16.56267101869096,16.56267101869096,16.56267101869096,16.56267101869096,18.790680416560441,18.790680416560441,18.790680416560441,18.790680416560441,18.790680416560441,18.790680416560441,18.118525488555264,18.118525488555264,18.118525488555264,18.118525488555264,18.118525488555264,18.118525488555264,18.325439611008616,18.325439611008616,18.325439611008616,18.325439611008616,18.325439611008616,18.325439611008616,17.745060563166142,17.745060563166142,17.745060563166142,17.745060563166142,17.745060563166142,17.745060563166142,18.199291463885181,18.199291463885181,18.199291463885181,18.199291463885181,18.199291463885181,18.199291463885181,18.849092995099021,18.849092995099021,18.849092995099021,18.849092995099021,18.849092995099021,18.849092995099021,19.2344602879459,19.2344602879459,19.2344602879459,19.2344602879459,19.2344602879459,19.2344602879459,19.847325205810534,19.847325205810534,19.847325205810534,19.847325205810534,19.847325205810534,19.847325205810534,18.809394945200079,18.809394945200079,18.809394945200079,18.809394945200079,18.809394945200079,18.809394945200079,15.682828824885807,15.682828824885807,15.682828824885807,15.682828824885807,15.682828824885807,15.682828824885807,15.350157942527098,15.350157942527098,15.350157942527098,15.350157942527098,15.350157942527098,15.350157942527098,16.330197698292761,16.330197698292761,16.330197698292761,16.330197698292761,16.330197698292761,16.330197698292761,16.714634920377183,16.714634920377183,16.714634920377183,16.714634920377183,16.714634920377183,16.714634920377183,17.262393722843864,17.262393722843864,17.262393722843864,17.262393722843864,17.262393722843864,17.262393722843864,16.980816658086351,16.980816658086351,16.980816658086351,16.980816658086351,16.980816658086351,16.980816658086351,16.259692040912682,16.259692040912682,16.259692040912682,16.259692040912682,16.259692040912682,16.259692040912682,16.27647204771667,16.27647204771667,16.27647204771667,16.27647204771667,16.27647204771667,16.27647204771667,13.535158595761066,13.535158595761066,13.535158595761066,13.535158595761066,13.535158595761066,13.535158595761066,14.584683473561048,14.584683473561048,14.584683473561048,14.584683473561048,14.584683473561048,14.584683473561048,14.612955871594377,14.612955871594377,14.612955871594377,14.612955871594377,14.612955871594377,14.612955871594377,13.924967905649092,13.924967905649092,13.924967905649092,13.924967905649092,13.924967905649092,13.924967905649092,13.570335912276358,13.570335912276358,13.570335912276358,13.570335912276358,13.570335912276358,13.570335912276358,13.396092165252947,13.396092165252947,13.396092165252947,13.396092165252947,13.396092165252947,13.396092165252947,12.947047394068173,12.947047394068173,12.947047394068173,12.947047394068173,12.947047394068173,12.947047394068173,11.943489380788098,11.943489380788098,11.943489380788098,11.943489380788098,11.943489380788098,11.943489380788098,8.379241221657125,8.379241221657125,8.379241221657125,8.379241221657125,8.379241221657125,8.379241221657125,8.1490133898866386,8.1490133898866386,8.1490133898866386,8.1490133898866386,8.1490133898866386,8.1490133898866386,8.67281627587146,8.67281627587146,8.67281627587146,8.67281627587146,8.67281627587146,8.67281627587146,7.9652043194017539,7.9652043194017539,7.9652043194017539,7.9652043194017539,7.9652043194017539,7.9652043194017539,9.053020221653334,9.053020221653334,9.053020221653334,9.053020221653334,9.053020221653334,9.053020221653334,9.9672001865435913,9.9672001865435913,9.9672001865435913,9.9672001865435913,9.9672001865435913,9.9672001865435913,10.343792312341224,10.343792312341224,10.343792312341224,10.343792312341224,10.343792312341224,10.343792312341224,6.9341853094096253,6.9341853094096253,6.9341853094096253,6.9341853094096253,6.9341853094096253,6.9341853094096253,6.8453889269477823,6.8453889269477823,6.8453889269477823,6.8453889269477823,6.8453889269477823,6.8453889269477823,7.5445392609998292,7.5445392609998292,7.5445392609998292,7.5445392609998292,7.5445392609998292,7.5445392609998292,7.5157929411677022,7.5157929411677022,7.5157929411677022,7.5157929411677022,7.5157929411677022,7.5157929411677022,6.7305448500274503,6.7305448500274503,6.7305448500274503,6.7305448500274503,6.7305448500274503,6.7305448500274503,6.1907451639298765,6.1907451639298765,6.1907451639298765,6.1907451639298765,6.1907451639298765,6.1907451639298765,6.1774973714727786,6.1774973714727786,6.1774973714727786,6.1774973714727786,6.1774973714727786,6.1774973714727786],"z":[2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022],"size":[60067,70215,62291,44169,37318,12420,12452,17656,23295,14615,14002,7366,7348,9583,11347,7064,10290,3912,7616,11005,14643,8744,8927,5571,6221,8555,10631,8549,8013,4890,1614,2717,2781,2636,3513,2907,5872,9547,10043,8132,9254,4647,1574,2117,2586,2209,2872,1744,1536,2195,3215,3119,3128,2117,4288,5766,6391,5632,6744,3585,17286,24021,25727,23940,21736,8643,13563,14821,14648,15390,15427,7487,4021,5430,5862,5877,6635,3648,1482,2108,2570,2900,2991,1445,9318,8685,9086,9203,12344,4878,6395,7059,6191,6241,6875,3255,4384,4870,4740,4130,6909,3183,5304,5492,5723,5101,6848,3240,10147,17586,24283,11802,21949,11943,5061,8774,12393,6897,15960,8267,4658,9100,11345,4830,9592,5265,8150,10809,14779,9465,22484,11723,14761,19419,24878,15635,28121,11271,4755,5897,7874,6054,12144,5867,6435,11334,14796,8333,15131,8468,5076,5651,7339,3949,8961,4459,4312,4326,4746,6030,9095,6778,1181,1769,1691,2298,5112,3128,10698,14138,14274,15488,25903,13404,5957,6497,7422,10517,22449,15185,4211,5097,5024,5342,9555,8845,5434,6317,6581,6386,11698,6371,3987,5500,5681,6497,9985,6907,4850,6198,7270,9212,14778,10869,5461,6535,6339,8923,15388,12954,3901,4262,4991,6834,11171,10008,4539,3637,3662,5068,8478,7955,4029,5558,5529,7431,9744,4462,15620,18944,21722,22574,28778,14174,3735,5339,6179,6103,9087,6184,5441,7330,8296,8700,11604,8863,2210,3990,4555,4266,7337,4627,4737,5265,5642,6485,9874,5702,2960,3962,5577,5970,9520,5695,3339,4342,5082,5881,8888,5262,8820,10623,12419,14453,19353,9684,864,950,1029,1188,2275,1739,4246,5176,5045,5682,6396,4165,1251,1964,3245,2164,2057,1673,3052,5243,7420,5228,5090,3211,3117,5368,5681,4206,3406,1752,1876,3059,4330,4432,4164,1942,2858,5390,6996,6827,5656,2908,2033,4560,3994,3811,4090,2011,4450,7375,6471,6035,9832,5315,9082,12885,12937,8597,5270,7385,7420,9665,8802,6482,5385,5767,5967,7495,7249,6179,5726,5274,7870,9936,9071,7472,5366,6211,3857,4406,4387,3889,1471,1264,1598,1796,1942,1363,846,1350,3714,4962,5196,5046,4451,3560,4284,5317,4935,4983,4850,3575,21330,24032,27228,29929,40983,13459,7756,8474,8913,9880,10442,3004,4261,5043,5443,6355,7419,2576,13731,14459,14862,14062,15375,2832,22044,22651,23185,24199,28566,9709,3571,4633,4845,5226,6077,2141,8245,9156,9643,10320,11811,5852,21034,23446,24647,23056,28509,17209,6561,7370,8109,7240,8021,3625,7610,7515,8464,7625,9176,3865,5390,5599,5085,5087,7408,4291,7566,8727,9040,9332,11163,6266,7406,7822,6897,7003,7337,3346,7560,13242,10381,8762,9119,4548],"color":[60067,70215,62291,44169,37318,12420,12452,17656,23295,14615,14002,7366,7348,9583,11347,7064,10290,3912,7616,11005,14643,8744,8927,5571,6221,8555,10631,8549,8013,4890,1614,2717,2781,2636,3513,2907,5872,9547,10043,8132,9254,4647,1574,2117,2586,2209,2872,1744,1536,2195,3215,3119,3128,2117,4288,5766,6391,5632,6744,3585,17286,24021,25727,23940,21736,8643,13563,14821,14648,15390,15427,7487,4021,5430,5862,5877,6635,3648,1482,2108,2570,2900,2991,1445,9318,8685,9086,9203,12344,4878,6395,7059,6191,6241,6875,3255,4384,4870,4740,4130,6909,3183,5304,5492,5723,5101,6848,3240,10147,17586,24283,11802,21949,11943,5061,8774,12393,6897,15960,8267,4658,9100,11345,4830,9592,5265,8150,10809,14779,9465,22484,11723,14761,19419,24878,15635,28121,11271,4755,5897,7874,6054,12144,5867,6435,11334,14796,8333,15131,8468,5076,5651,7339,3949,8961,4459,4312,4326,4746,6030,9095,6778,1181,1769,1691,2298,5112,3128,10698,14138,14274,15488,25903,13404,5957,6497,7422,10517,22449,15185,4211,5097,5024,5342,9555,8845,5434,6317,6581,6386,11698,6371,3987,5500,5681,6497,9985,6907,4850,6198,7270,9212,14778,10869,5461,6535,6339,8923,15388,12954,3901,4262,4991,6834,11171,10008,4539,3637,3662,5068,8478,7955,4029,5558,5529,7431,9744,4462,15620,18944,21722,22574,28778,14174,3735,5339,6179,6103,9087,6184,5441,7330,8296,8700,11604,8863,2210,3990,4555,4266,7337,4627,4737,5265,5642,6485,9874,5702,2960,3962,5577,5970,9520,5695,3339,4342,5082,5881,8888,5262,8820,10623,12419,14453,19353,9684,864,950,1029,1188,2275,1739,4246,5176,5045,5682,6396,4165,1251,1964,3245,2164,2057,1673,3052,5243,7420,5228,5090,3211,3117,5368,5681,4206,3406,1752,1876,3059,4330,4432,4164,1942,2858,5390,6996,6827,5656,2908,2033,4560,3994,3811,4090,2011,4450,7375,6471,6035,9832,5315,9082,12885,12937,8597,5270,7385,7420,9665,8802,6482,5385,5767,5967,7495,7249,6179,5726,5274,7870,9936,9071,7472,5366,6211,3857,4406,4387,3889,1471,1264,1598,1796,1942,1363,846,1350,3714,4962,5196,5046,4451,3560,4284,5317,4935,4983,4850,3575,21330,24032,27228,29929,40983,13459,7756,8474,8913,9880,10442,3004,4261,5043,5443,6355,7419,2576,13731,14459,14862,14062,15375,2832,22044,22651,23185,24199,28566,9709,3571,4633,4845,5226,6077,2141,8245,9156,9643,10320,11811,5852,21034,23446,24647,23056,28509,17209,6561,7370,8109,7240,8021,3625,7610,7515,8464,7625,9176,3865,5390,5599,5085,5087,7408,4291,7566,8727,9040,9332,11163,6266,7406,7822,6897,7003,7337,3346,7560,13242,10381,8762,9119,4548],"type":"scatter3d","mode":"markers","marker":{"symbol":"circle","sizemode":"diameter"},"hoverinfo":"text","text":{},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Longitude"},"yaxis":{"title":"Latitude"},"zaxis":{"title":"Year"}},"title":"Space-Time Cube of Drug Abuse Cases in Thailand (2017-2022)","hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[100.62346136424746,100.62346136424746,100.62346136424746,100.62346136424746,100.62346136424746,100.62346136424746,100.71023157204732,100.71023157204732,100.71023157204732,100.71023157204732,100.71023157204732,100.71023157204732,100.39284437729408,100.39284437729408,100.39284437729408,100.39284437729408,100.39284437729408,100.39284437729408,100.68237573701045,100.68237573701045,100.68237573701045,100.68237573701045,100.68237573701045,100.68237573701045,100.52658206775011,100.52658206775011,100.52658206775011,100.52658206775011,100.52658206775011,100.52658206775011,100.34852189532658,100.34852189532658,100.34852189532658,100.34852189532658,100.34852189532658,100.34852189532658,100.90693523816465,100.90693523816465,100.90693523816465,100.90693523816465,100.90693523816465,100.90693523816465,100.34721554976805,100.34721554976805,100.34721554976805,100.34721554976805,100.34721554976805,100.34721554976805,100.02746225500066,100.02746225500066,100.02746225500066,100.02746225500066,100.02746225500066,100.02746225500066,101.01687337340066,101.01687337340066,101.01687337340066,101.01687337340066,101.01687337340066,101.01687337340066,101.20152594716131,101.20152594716131,101.20152594716131,101.20152594716131,101.20152594716131,101.20152594716131,101.4274815704137,101.4274815704137,101.4274815704137,101.4274815704137,101.4274815704137,101.4274815704137,102.13018937580715,102.13018937580715,102.13018937580715,102.13018937580715,102.13018937580715,102.13018937580715,102.52166692213197,102.52166692213197,102.52166692213197,102.52166692213197,102.52166692213197,102.52166692213197,101.42566537600294,101.42566537600294,101.42566537600294,101.42566537600294,101.42566537600294,101.42566537600294,101.65029268511354,101.65029268511354,101.65029268511354,101.65029268511354,101.65029268511354,101.65029268511354,101.17132031170088,101.17132031170088,101.17132031170088,101.17132031170088,101.17132031170088,101.17132031170088,102.32254595676091,102.32254595676091,102.32254595676091,102.32254595676091,102.32254595676091,102.32254595676091,102.10918946975428,102.10918946975428,102.10918946975428,102.10918946975428,102.10918946975428,102.10918946975428,102.95638684337747,102.95638684337747,102.95638684337747,102.95638684337747,102.95638684337747,102.95638684337747,103.65589320101067,103.65589320101067,103.65589320101067,103.65589320101067,103.65589320101067,103.65589320101067,104.36937796146215,104.36937796146215,104.36937796146215,104.36937796146215,104.36937796146215,104.36937796146215,105.11159291657839,105.11159291657839,105.11159291657839,105.11159291657839,105.11159291657839,105.11159291657839,104.33828904209687,104.33828904209687,104.33828904209687,104.33828904209687,104.33828904209687,104.33828904209687,101.81923565920435,101.81923565920435,101.81923565920435,101.81923565920435,101.81923565920435,101.81923565920435,104.74125515291696,104.74125515291696,104.74125515291696,104.74125515291696,104.74125515291696,104.74125515291696,103.71112124377785,103.71112124377785,103.71112124377785,103.71112124377785,103.71112124377785,103.71112124377785,102.30251002772171,102.30251002772171,102.30251002772171,102.30251002772171,102.30251002772171,102.30251002772171,102.57837215749053,102.57837215749053,102.57837215749053,102.57837215749053,102.57837215749053,102.57837215749053,102.86324901561068,102.86324901561068,102.86324901561068,102.86324901561068,102.86324901561068,102.86324901561068,101.63584153310288,101.63584153310288,101.63584153310288,101.63584153310288,101.63584153310288,101.63584153310288,102.83371850222453,102.83371850222453,102.83371850222453,102.83371850222453,102.83371850222453,102.83371850222453,103.16573568947332,103.16573568947332,103.16573568947332,103.16573568947332,103.16573568947332,103.16573568947332,103.81363127030255,103.81363127030255,103.81363127030255,103.81363127030255,103.81363127030255,103.81363127030255,103.6219325474386,103.6219325474386,103.6219325474386,103.6219325474386,103.6219325474386,103.6219325474386,103.82457063077901,103.82457063077901,103.82457063077901,103.82457063077901,103.82457063077901,103.82457063077901,104.42992041019586,104.42992041019586,104.42992041019586,104.42992041019586,104.42992041019586,104.42992041019586,104.51740134873387,104.51740134873387,104.51740134873387,104.51740134873387,104.51740134873387,104.51740134873387,98.726311920539317,98.726311920539317,98.726311920539317,98.726311920539317,98.726311920539317,98.726311920539317,98.95455696992417,98.95455696992417,98.95455696992417,98.95455696992417,98.95455696992417,98.95455696992417,99.511090102610538,99.511090102610538,99.511090102610538,99.511090102610538,99.511090102610538,99.511090102610538,100.51385903697164,100.51385903697164,100.51385903697164,100.51385903697164,100.51385903697164,100.51385903697164,100.06414359125134,100.06414359125134,100.06414359125134,100.06414359125134,100.06414359125134,100.06414359125134,100.83458608466044,100.83458608466044,100.83458608466044,100.83458608466044,100.83458608466044,100.83458608466044,100.19116097905194,100.19116097905194,100.19116097905194,100.19116097905194,100.19116097905194,100.19116097905194,99.865546708332758,99.865546708332758,99.865546708332758,99.865546708332758,99.865546708332758,99.865546708332758,98.02949974473222,98.02949974473222,98.02949974473222,98.02949974473222,98.02949974473222,98.02949974473222,100.15247854629372,100.15247854629372,100.15247854629372,100.15247854629372,100.15247854629372,100.15247854629372,99.478191527351228,99.478191527351228,99.478191527351228,99.478191527351228,99.478191527351228,99.478191527351228,99.53429737636543,99.53429737636543,99.53429737636543,99.53429737636543,99.53429737636543,99.53429737636543,98.793293074641312,98.793293074641312,98.793293074641312,98.793293074641312,98.793293074641312,98.793293074641312,99.711025160045722,99.711025160045722,99.711025160045722,99.711025160045722,99.711025160045722,99.711025160045722,100.5445275959101,100.5445275959101,100.5445275959101,100.5445275959101,100.5445275959101,100.5445275959101,100.34280180642683,100.34280180642683,100.34280180642683,100.34280180642683,100.34280180642683,100.34280180642683,101.14753472624987,101.14753472624987,101.14753472624987,101.14753472624987,101.14753472624987,101.14753472624987,99.578280336182232,99.578280336182232,99.578280336182232,99.578280336182232,99.578280336182232,99.578280336182232,99.047730045254099,99.047730045254099,99.047730045254099,99.047730045254099,99.047730045254099,99.047730045254099,99.891547512508552,99.891547512508552,99.891547512508552,99.891547512508552,99.891547512508552,99.891547512508552,100.10314950394655,100.10314950394655,100.10314950394655,100.10314950394655,100.10314950394655,100.10314950394655,100.21173868339022,100.21173868339022,100.21173868339022,100.21173868339022,100.21173868339022,100.21173868339022,99.953134610074017,99.953134610074017,99.953134610074017,99.953134610074017,99.953134610074017,99.953134610074017,99.618819445993097,99.618819445993097,99.618819445993097,99.618819445993097,99.618819445993097,99.618819445993097,99.633681582997326,99.633681582997326,99.633681582997326,99.633681582997326,99.633681582997326,99.633681582997326,99.787584295148818,99.787584295148818,99.787584295148818,99.787584295148818,99.787584295148818,99.787584295148818,99.020357410482532,99.020357410482532,99.020357410482532,99.020357410482532,99.020357410482532,99.020357410482532,98.418333815614915,98.418333815614915,98.418333815614915,98.418333815614915,98.418333815614915,98.418333815614915,98.346339414005271,98.346339414005271,98.346339414005271,98.346339414005271,98.346339414005271,98.346339414005271,99.091623329689639,99.091623329689639,99.091623329689639,99.091623329689639,99.091623329689639,99.091623329689639,98.69611038772419,98.69611038772419,98.69611038772419,98.69611038772419,98.69611038772419,98.69611038772419,99.061484507694573,99.061484507694573,99.061484507694573,99.061484507694573,99.061484507694573,99.061484507694573,100.54561631140365,100.54561631140365,100.54561631140365,100.54561631140365,100.54561631140365,100.54561631140365,99.926930333294507,99.926930333294507,99.926930333294507,99.926930333294507,99.926930333294507,99.926930333294507,99.594519472512076,99.594519472512076,99.594519472512076,99.594519472512076,99.594519472512076,99.594519472512076,100.06954070275103,100.06954070275103,100.06954070275103,100.06954070275103,100.06954070275103,100.06954070275103,101.34979080945477,101.34979080945477,101.34979080945477,101.34979080945477,101.34979080945477,101.34979080945477,101.22850408114085,101.22850408114085,101.22850408114085,101.22850408114085,101.22850408114085,101.22850408114085,101.71890058390012,101.71890058390012,101.71890058390012,101.71890058390012,101.71890058390012,101.71890058390012],"y":[13.771842642937594,13.771842642937594,13.771842642937594,13.771842642937594,13.771842642937594,13.771842642937594,13.596531641263732,13.596531641263732,13.596531641263732,13.596531641263732,13.596531641263732,13.596531641263732,13.924141651583613,13.924141651583613,13.924141651583613,13.924141651583613,13.924141651583613,13.924141651583613,14.065156444017401,14.065156444017401,14.065156444017401,14.065156444017401,14.065156444017401,14.065156444017401,14.345321207193846,14.345321207193846,14.345321207193846,14.345321207193846,14.345321207193846,14.345321207193846,14.623523184634754,14.623523184634754,14.623523184634754,14.623523184634754,14.623523184634754,14.623523184634754,15.107539548515751,15.107539548515751,15.107539548515751,15.107539548515751,15.107539548515751,15.107539548515751,14.912490065733344,14.912490065733344,14.912490065733344,14.912490065733344,14.912490065733344,14.912490065733344,15.133889617364774,15.133889617364774,15.133889617364774,15.133889617364774,15.133889617364774,15.133889617364774,14.626539800996554,14.626539800996554,14.626539800996554,14.626539800996554,14.626539800996554,14.626539800996554,13.191384933855957,13.191384933855957,13.191384933855957,13.191384933855957,13.191384933855957,13.191384933855957,12.854335509941485,12.854335509941485,12.854335509941485,12.854335509941485,12.854335509941485,12.854335509941485,12.880990449397574,12.880990449397574,12.880990449397574,12.880990449397574,12.880990449397574,12.880990449397574,12.315809477354154,12.315809477354154,12.315809477354154,12.315809477354154,12.315809477354154,12.315809477354154,13.606554292405297,13.606554292405297,13.606554292405297,13.606554292405297,13.606554292405297,13.606554292405297,14.04805232636498,14.04805232636498,14.04805232636498,14.04805232636498,14.04805232636498,14.04805232636498,14.217073842445865,14.217073842445865,14.217073842445865,14.217073842445865,14.217073842445865,14.217073842445865,13.787181209128988,13.787181209128988,13.787181209128988,13.787181209128988,13.787181209128988,13.787181209128988,14.957015165346613,14.957015165346613,14.957015165346613,14.957015165346613,14.957015165346613,14.957015165346613,14.819436338853901,14.819436338853901,14.819436338853901,14.819436338853901,14.819436338853901,14.819436338853901,14.885448090327689,14.885448090327689,14.885448090327689,14.885448090327689,14.885448090327689,14.885448090327689,14.856271065160547,14.856271065160547,14.856271065160547,14.856271065160547,14.856271065160547,14.856271065160547,15.182769400387267,15.182769400387267,15.182769400387267,15.182769400387267,15.182769400387267,15.182769400387267,15.895705710022401,15.895705710022401,15.895705710022401,15.895705710022401,15.895705710022401,15.895705710022401,16.031734828746259,16.031734828746259,16.031734828746259,16.031734828746259,16.031734828746259,16.031734828746259,15.892525697933207,15.892525697933207,15.892525697933207,15.892525697933207,15.892525697933207,15.892525697933207,18.148809022252419,18.148809022252419,18.148809022252419,18.148809022252419,18.148809022252419,18.148809022252419,17.18149934201405,17.18149934201405,17.18149934201405,17.18149934201405,17.18149934201405,17.18149934201405,16.408266039267097,16.408266039267097,16.408266039267097,16.408266039267097,16.408266039267097,16.408266039267097,17.424398898916309,17.424398898916309,17.424398898916309,17.424398898916309,17.424398898916309,17.424398898916309,17.408751108842939,17.408751108842939,17.408751108842939,17.408751108842939,17.408751108842939,17.408751108842939,17.940798929048551,17.940798929048551,17.940798929048551,17.940798929048551,17.940798929048551,17.940798929048551,15.999373307434064,15.999373307434064,15.999373307434064,15.999373307434064,15.999373307434064,15.999373307434064,15.919542964523277,15.919542964523277,15.919542964523277,15.919542964523277,15.919542964523277,15.919542964523277,16.628017874948977,16.628017874948977,16.628017874948977,16.628017874948977,16.628017874948977,16.628017874948977,17.389511189745487,17.389511189745487,17.389511189745487,17.389511189745487,17.389511189745487,17.389511189745487,17.384408021449254,17.384408021449254,17.384408021449254,17.384408021449254,17.384408021449254,17.384408021449254,16.56267101869096,16.56267101869096,16.56267101869096,16.56267101869096,16.56267101869096,16.56267101869096,18.790680416560441,18.790680416560441,18.790680416560441,18.790680416560441,18.790680416560441,18.790680416560441,18.118525488555264,18.118525488555264,18.118525488555264,18.118525488555264,18.118525488555264,18.118525488555264,18.325439611008616,18.325439611008616,18.325439611008616,18.325439611008616,18.325439611008616,18.325439611008616,17.745060563166142,17.745060563166142,17.745060563166142,17.745060563166142,17.745060563166142,17.745060563166142,18.199291463885181,18.199291463885181,18.199291463885181,18.199291463885181,18.199291463885181,18.199291463885181,18.849092995099021,18.849092995099021,18.849092995099021,18.849092995099021,18.849092995099021,18.849092995099021,19.2344602879459,19.2344602879459,19.2344602879459,19.2344602879459,19.2344602879459,19.2344602879459,19.847325205810534,19.847325205810534,19.847325205810534,19.847325205810534,19.847325205810534,19.847325205810534,18.809394945200079,18.809394945200079,18.809394945200079,18.809394945200079,18.809394945200079,18.809394945200079,15.682828824885807,15.682828824885807,15.682828824885807,15.682828824885807,15.682828824885807,15.682828824885807,15.350157942527098,15.350157942527098,15.350157942527098,15.350157942527098,15.350157942527098,15.350157942527098,16.330197698292761,16.330197698292761,16.330197698292761,16.330197698292761,16.330197698292761,16.330197698292761,16.714634920377183,16.714634920377183,16.714634920377183,16.714634920377183,16.714634920377183,16.714634920377183,17.262393722843864,17.262393722843864,17.262393722843864,17.262393722843864,17.262393722843864,17.262393722843864,16.980816658086351,16.980816658086351,16.980816658086351,16.980816658086351,16.980816658086351,16.980816658086351,16.259692040912682,16.259692040912682,16.259692040912682,16.259692040912682,16.259692040912682,16.259692040912682,16.27647204771667,16.27647204771667,16.27647204771667,16.27647204771667,16.27647204771667,16.27647204771667,13.535158595761066,13.535158595761066,13.535158595761066,13.535158595761066,13.535158595761066,13.535158595761066,14.584683473561048,14.584683473561048,14.584683473561048,14.584683473561048,14.584683473561048,14.584683473561048,14.612955871594377,14.612955871594377,14.612955871594377,14.612955871594377,14.612955871594377,14.612955871594377,13.924967905649092,13.924967905649092,13.924967905649092,13.924967905649092,13.924967905649092,13.924967905649092,13.570335912276358,13.570335912276358,13.570335912276358,13.570335912276358,13.570335912276358,13.570335912276358,13.396092165252947,13.396092165252947,13.396092165252947,13.396092165252947,13.396092165252947,13.396092165252947,12.947047394068173,12.947047394068173,12.947047394068173,12.947047394068173,12.947047394068173,12.947047394068173,11.943489380788098,11.943489380788098,11.943489380788098,11.943489380788098,11.943489380788098,11.943489380788098,8.379241221657125,8.379241221657125,8.379241221657125,8.379241221657125,8.379241221657125,8.379241221657125,8.1490133898866386,8.1490133898866386,8.1490133898866386,8.1490133898866386,8.1490133898866386,8.1490133898866386,8.67281627587146,8.67281627587146,8.67281627587146,8.67281627587146,8.67281627587146,8.67281627587146,7.9652043194017539,7.9652043194017539,7.9652043194017539,7.9652043194017539,7.9652043194017539,7.9652043194017539,9.053020221653334,9.053020221653334,9.053020221653334,9.053020221653334,9.053020221653334,9.053020221653334,9.9672001865435913,9.9672001865435913,9.9672001865435913,9.9672001865435913,9.9672001865435913,9.9672001865435913,10.343792312341224,10.343792312341224,10.343792312341224,10.343792312341224,10.343792312341224,10.343792312341224,6.9341853094096253,6.9341853094096253,6.9341853094096253,6.9341853094096253,6.9341853094096253,6.9341853094096253,6.8453889269477823,6.8453889269477823,6.8453889269477823,6.8453889269477823,6.8453889269477823,6.8453889269477823,7.5445392609998292,7.5445392609998292,7.5445392609998292,7.5445392609998292,7.5445392609998292,7.5445392609998292,7.5157929411677022,7.5157929411677022,7.5157929411677022,7.5157929411677022,7.5157929411677022,7.5157929411677022,6.7305448500274503,6.7305448500274503,6.7305448500274503,6.7305448500274503,6.7305448500274503,6.7305448500274503,6.1907451639298765,6.1907451639298765,6.1907451639298765,6.1907451639298765,6.1907451639298765,6.1907451639298765,6.1774973714727786,6.1774973714727786,6.1774973714727786,6.1774973714727786,6.1774973714727786,6.1774973714727786],"z":[2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022,2017,2018,2019,2020,2021,2022],"type":"scatter3d","mode":"markers","marker":{"colorbar":{"title":"","ticklen":2},"cmin":846,"cmax":70215,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[60067,70215,62291,44169,37318,12420,12452,17656,23295,14615,14002,7366,7348,9583,11347,7064,10290,3912,7616,11005,14643,8744,8927,5571,6221,8555,10631,8549,8013,4890,1614,2717,2781,2636,3513,2907,5872,9547,10043,8132,9254,4647,1574,2117,2586,2209,2872,1744,1536,2195,3215,3119,3128,2117,4288,5766,6391,5632,6744,3585,17286,24021,25727,23940,21736,8643,13563,14821,14648,15390,15427,7487,4021,5430,5862,5877,6635,3648,1482,2108,2570,2900,2991,1445,9318,8685,9086,9203,12344,4878,6395,7059,6191,6241,6875,3255,4384,4870,4740,4130,6909,3183,5304,5492,5723,5101,6848,3240,10147,17586,24283,11802,21949,11943,5061,8774,12393,6897,15960,8267,4658,9100,11345,4830,9592,5265,8150,10809,14779,9465,22484,11723,14761,19419,24878,15635,28121,11271,4755,5897,7874,6054,12144,5867,6435,11334,14796,8333,15131,8468,5076,5651,7339,3949,8961,4459,4312,4326,4746,6030,9095,6778,1181,1769,1691,2298,5112,3128,10698,14138,14274,15488,25903,13404,5957,6497,7422,10517,22449,15185,4211,5097,5024,5342,9555,8845,5434,6317,6581,6386,11698,6371,3987,5500,5681,6497,9985,6907,4850,6198,7270,9212,14778,10869,5461,6535,6339,8923,15388,12954,3901,4262,4991,6834,11171,10008,4539,3637,3662,5068,8478,7955,4029,5558,5529,7431,9744,4462,15620,18944,21722,22574,28778,14174,3735,5339,6179,6103,9087,6184,5441,7330,8296,8700,11604,8863,2210,3990,4555,4266,7337,4627,4737,5265,5642,6485,9874,5702,2960,3962,5577,5970,9520,5695,3339,4342,5082,5881,8888,5262,8820,10623,12419,14453,19353,9684,864,950,1029,1188,2275,1739,4246,5176,5045,5682,6396,4165,1251,1964,3245,2164,2057,1673,3052,5243,7420,5228,5090,3211,3117,5368,5681,4206,3406,1752,1876,3059,4330,4432,4164,1942,2858,5390,6996,6827,5656,2908,2033,4560,3994,3811,4090,2011,4450,7375,6471,6035,9832,5315,9082,12885,12937,8597,5270,7385,7420,9665,8802,6482,5385,5767,5967,7495,7249,6179,5726,5274,7870,9936,9071,7472,5366,6211,3857,4406,4387,3889,1471,1264,1598,1796,1942,1363,846,1350,3714,4962,5196,5046,4451,3560,4284,5317,4935,4983,4850,3575,21330,24032,27228,29929,40983,13459,7756,8474,8913,9880,10442,3004,4261,5043,5443,6355,7419,2576,13731,14459,14862,14062,15375,2832,22044,22651,23185,24199,28566,9709,3571,4633,4845,5226,6077,2141,8245,9156,9643,10320,11811,5852,21034,23446,24647,23056,28509,17209,6561,7370,8109,7240,8021,3625,7610,7515,8464,7625,9176,3865,5390,5599,5085,5087,7408,4291,7566,8727,9040,9332,11163,6266,7406,7822,6897,7003,7337,3346,7560,13242,10381,8762,9119,4548],"size":[86.833888336288538,100,89.719327076936395,66.207672014876962,57.319119491415478,25.016217618821088,25.057734723003072,31.809453790598106,39.125545993166973,27.864031483804006,27.068719456817888,18.459109977079098,18.435756605976735,21.335466851187132,23.62409721921896,18.06729230636163,22.252735371707825,13.977857544436276,18.783462353500845,23.180383168274012,27.900358949963241,20.246940275915755,20.484366215456472,16.130259914370974,16.973576093067507,20.001729879340914,22.695152013147084,19.993945422306794,19.298533927258575,15.24672404099814,10.996410500367599,12.427453185140337,12.510487393504302,12.322363015179691,13.460191151667171,12.673960991220863,16.520780175582754,21.288760108982398,21.932275223803138,19.452925658435326,20.908619123816113,14.931453531116205,10.94451412014012,11.64900748172815,12.257492539895342,11.768369156251351,12.628551658521818,11.165073736106907,10.895212558924015,11.750205423171733,13.073563118972451,12.949011806426501,12.960688491977685,11.64900748172815,14.465683518574579,16.383254767979935,17.194135709034295,16.209401894217876,17.652121264541798,13.553604636076633,31.329412273493922,40.067465294295715,42.280845910997705,39.962375124335082,37.102884573800978,20.11590191584137,26.499156683821305,28.131297841975524,27.906845997491676,28.869523850711413,28.917528002421829,18.616096527267224,14.119275180556155,15.947325174069109,16.507806080525881,16.527267223111188,17.510703628421918,13.635341434934913,10.825152445616919,11.637330796176967,12.236733987804351,12.664879124681054,12.782943389698568,10.7771482939065,20.991653332180078,20.170393115080223,20.690654326860702,20.842451239026076,24.917614496388875,15.231155126929895,17.199325347057041,18.060805258833199,16.9346538078969,16.999524283181248,17.822081909786792,13.12545949919993,14.590234831120529,15.220775850884401,15.052112615145093,14.260692816676038,17.866193832980152,13.032046014790469,15.78385157635255,16.027764563421702,16.327466159235392,15.520477446698091,17.787051853133242,13.105998356614625,22.067205812394587,31.718635125200016,40.407386584785712,24.214418544306533,37.379232798512305,24.3973532846084,15.468581066470612,20.285862561086365,24.981187562167541,17.850624918911905,29.609047268952988,19.628075941703067,14.945725035678763,20.70881805994032,23.621502400207586,15.168879470656922,21.347143536738315,15.733252605630756,19.47627902953769,22.926090905159366,28.07680664273667,21.182372529516066,38.073346884054843,24.111923193357264,28.053453271634304,34.096786749124249,41.179345240669463,29.187389179604722,45.386844267612332,23.525494096786748,15.071573757730398,16.553215413224926,19.118194005968085,16.756908705617782,24.65813259525148,16.514293128054319,17.251221727284523,23.607230895645031,28.098862604333348,19.713704969078407,28.533494788738487,19.888855252346147,15.488042209055919,16.234052674825932,18.424079920425548,14.025861696146695,20.528478138649831,14.687540544047053,14.496821346711066,14.514985079790684,15.059897072179215,16.725770877481295,20.702331012411882,17.696233187735157,10.434632184405137,11.19750897374908,11.096311032305497,11.883838602257493,15.534748951260649,12.960688491977685,22.782078450028109,27.245167149591317,27.421614842364747,28.996669982268738,42.509189983998617,26.292868572417074,16.631059983566146,17.331661116637115,18.53176490939757,22.547247329498767,38.027937551355791,28.603554902045584,14.365782986636681,15.515287808675344,15.420576914760197,15.833153137568655,21.299139385027893,20.377978635990139,15.952514812091856,17.098127405613457,17.440643515114822,17.187648661505861,24.079487955715088,17.168187518920554,14.075163257362799,16.038143839467196,16.272974959996539,17.331661116637115,21.857025472473296,17.863599013968773,15.194827660770661,16.943735674436709,18.334558664533148,20.854127924577263,28.075509233230985,23.003935475500583,15.987544868745404,17.380962677853219,17.126670414738573,20.479176577433723,28.866929031700039,25.709034294857936,13.963586039873718,14.431950871426718,15.377762401072525,17.768888120053624,23.395753146218052,21.886865891104094,14.791333304502011,13.621069930372357,13.653505168014531,15.477662933010423,19.901829347403016,19.223284175928729,14.129654456601653,16.113393590797042,16.075768715132121,18.543441594948753,21.544349781602733,14.691432772564113,29.167928037019418,33.480517233922932,37.08472084072136,38.190113739566669,46.239242312848681,27.291873891796048,13.74821606192968,15.829260909051595,16.919084893828657,16.820481771396445,20.691951736366388,16.925571941357092,15.961596678631665,18.412403234874368,19.665700817367988,20.18985425766553,23.957531462180512,20.401332007092506,11.769666565757039,14.079055485879859,14.812091856593003,14.437140509449467,18.421485101414177,14.905505341002465,15.048220386628032,15.733252605630756,16.222375989274749,17.316092202568871,21.713013017342039,16.300220559615965,12.742723695022272,14.042728019720624,16.138044371405094,16.647926307140075,21.253730052328848,16.291138693076157,13.234441897677637,14.535743631881676,15.495826666090039,16.532456861133937,20.433767244734682,15.729360377113697,20.345543398347964,22.684772737101589,25.014920209315399,27.653851143882715,34.011157721748909,21.466505211261513,10.023353371102365,10.134930588591446,10.237425939540717,10.443714050944946,11.853998183626691,11.158586688578472,14.411192319335726,15.617783159624615,15.447822514379622,16.274272369502228,17.20062275656273,14.306102149375082,10.525450849803226,11.450503827358041,13.112485404143062,11.709985728495438,11.571162911386931,11.07295766120313,12.862085369545474,15.704709596505644,18.529170090386195,15.685248453920339,15.506205942135537,13.068373480949704,12.946416987415128,15.866885784716516,16.272974959996539,14.359295939108247,13.321368334558665,11.175453012152403,11.336331790857587,12.871167236085283,14.520174717813433,14.652510487393505,14.304804739869393,11.421960818232929,12.6103879254422,15.895428793841631,17.979068459974918,17.759806253513815,16.240539722354367,12.675258400726548,11.540025083250443,14.818578904121438,14.084245123902608,13.846819184361891,14.208796436448559,11.511482074125329,14.67586385849587,18.470786662630282,17.297928469489253,16.73225792500973,21.658521818103189,15.798123080915108,20.685464688837953,25.619513038965533,25.686978333261255,20.056221078579767,15.739739653159191,18.483760757687151,18.529170090386195,21.441854430653464,20.3221900272456,17.312199974051808,15.888941746313193,16.38455217748562,16.644034078623015,18.626475803312719,18.307313064913721,16.919084893828657,16.331358387752452,15.74492929118194,19.113004367945337,21.793452406694634,20.671193184275396,18.596635384681917,15.864290965705141,16.960601998010638,13.906500021623492,14.618777840245642,14.594127059637589,13.948017125805475,10.810880941054361,10.542317173377157,10.975651948276608,11.232539030402629,11.421960818232929,10.670760714440167,10,10.653894390866236,13.720970462310254,15.340137525407602,15.643731349738356,15.449119923885309,14.677161268001557,13.521169398434459,14.46049388055183,15.800717899926481,15.305107468754056,15.367383125027029,15.194827660770661,13.540630541019764,36.576136314492061,40.08173679885828,44.228257579033858,47.732560653894396,62.074125329758253,26.364226095229856,18.965099684297023,19.89663970938027,20.466202482376854,21.720797474376162,22.449941616572243,12.799809713272499,14.430653461921031,15.445227695368249,15.964191497643039,17.147428966829565,18.527872680880506,12.244518444838473,26.717121480776715,27.661635600916838,28.184491631708688,27.146564027159105,28.850062708126107,12.576655278294339,37.50248670155257,38.29001427150456,38.982830947541409,40.298404186308005,45.964191497643036,21.498940448903689,13.535440902997015,14.913289798036587,15.188340613242225,15.682653634908966,16.786749124248583,11.680145309864637,19.599532932577951,20.781472992258792,21.413311421528348,22.291657656878435,24.226095229857716,16.494831985469013,36.192103100808716,39.32145482852571,40.879643644855769,38.815465121307788,45.890239155818882,31.229511741556028,17.41469532500108,18.464299615101844,19.423085239804522,18.295636379362541,19.308913203304069,13.605501016304112,18.775677896466721,18.65242399342646,19.883665614323402,18.795139039052025,20.807421182372529,13.916879297668988,15.895428793841631,16.16658738053021,15.499718894607101,15.502313713618475,18.513601176317952,14.469575747091641,18.718591878216493,20.224884314319077,20.6309734895991,21.009817065259696,23.385373870172558,17.031959520823424,18.511006357306577,19.050728711672363,17.850624918911905,17.988150326514727,18.421485101414177,13.243523764217446,18.710807421182373,26.082688232495784,22.370799636725337,20.270293647018121,20.733468840548372,14.803009990053194],"sizemode":"diameter","symbol":"circle","line":{"colorbar":{"title":"","ticklen":2},"cmin":846,"cmax":70215,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[60067,70215,62291,44169,37318,12420,12452,17656,23295,14615,14002,7366,7348,9583,11347,7064,10290,3912,7616,11005,14643,8744,8927,5571,6221,8555,10631,8549,8013,4890,1614,2717,2781,2636,3513,2907,5872,9547,10043,8132,9254,4647,1574,2117,2586,2209,2872,1744,1536,2195,3215,3119,3128,2117,4288,5766,6391,5632,6744,3585,17286,24021,25727,23940,21736,8643,13563,14821,14648,15390,15427,7487,4021,5430,5862,5877,6635,3648,1482,2108,2570,2900,2991,1445,9318,8685,9086,9203,12344,4878,6395,7059,6191,6241,6875,3255,4384,4870,4740,4130,6909,3183,5304,5492,5723,5101,6848,3240,10147,17586,24283,11802,21949,11943,5061,8774,12393,6897,15960,8267,4658,9100,11345,4830,9592,5265,8150,10809,14779,9465,22484,11723,14761,19419,24878,15635,28121,11271,4755,5897,7874,6054,12144,5867,6435,11334,14796,8333,15131,8468,5076,5651,7339,3949,8961,4459,4312,4326,4746,6030,9095,6778,1181,1769,1691,2298,5112,3128,10698,14138,14274,15488,25903,13404,5957,6497,7422,10517,22449,15185,4211,5097,5024,5342,9555,8845,5434,6317,6581,6386,11698,6371,3987,5500,5681,6497,9985,6907,4850,6198,7270,9212,14778,10869,5461,6535,6339,8923,15388,12954,3901,4262,4991,6834,11171,10008,4539,3637,3662,5068,8478,7955,4029,5558,5529,7431,9744,4462,15620,18944,21722,22574,28778,14174,3735,5339,6179,6103,9087,6184,5441,7330,8296,8700,11604,8863,2210,3990,4555,4266,7337,4627,4737,5265,5642,6485,9874,5702,2960,3962,5577,5970,9520,5695,3339,4342,5082,5881,8888,5262,8820,10623,12419,14453,19353,9684,864,950,1029,1188,2275,1739,4246,5176,5045,5682,6396,4165,1251,1964,3245,2164,2057,1673,3052,5243,7420,5228,5090,3211,3117,5368,5681,4206,3406,1752,1876,3059,4330,4432,4164,1942,2858,5390,6996,6827,5656,2908,2033,4560,3994,3811,4090,2011,4450,7375,6471,6035,9832,5315,9082,12885,12937,8597,5270,7385,7420,9665,8802,6482,5385,5767,5967,7495,7249,6179,5726,5274,7870,9936,9071,7472,5366,6211,3857,4406,4387,3889,1471,1264,1598,1796,1942,1363,846,1350,3714,4962,5196,5046,4451,3560,4284,5317,4935,4983,4850,3575,21330,24032,27228,29929,40983,13459,7756,8474,8913,9880,10442,3004,4261,5043,5443,6355,7419,2576,13731,14459,14862,14062,15375,2832,22044,22651,23185,24199,28566,9709,3571,4633,4845,5226,6077,2141,8245,9156,9643,10320,11811,5852,21034,23446,24647,23056,28509,17209,6561,7370,8109,7240,8021,3625,7610,7515,8464,7625,9176,3865,5390,5599,5085,5087,7408,4291,7566,8727,9040,9332,11163,6266,7406,7822,6897,7003,7337,3346,7560,13242,10381,8762,9119,4548]}},"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["Province:  Bangkok <br>Year:  2017 <br>Total Cases:  60067","Province:  Bangkok <br>Year:  2018 <br>Total Cases:  70215","Province:  Bangkok <br>Year:  2019 <br>Total Cases:  62291","Province:  Bangkok <br>Year:  2020 <br>Total Cases:  44169","Province:  Bangkok <br>Year:  2021 <br>Total Cases:  37318","Province:  Bangkok <br>Year:  2022 <br>Total Cases:  12420","Province:  Samut Prakan <br>Year:  2017 <br>Total Cases:  12452","Province:  Samut Prakan <br>Year:  2018 <br>Total Cases:  17656","Province:  Samut Prakan <br>Year:  2019 <br>Total Cases:  23295","Province:  Samut Prakan <br>Year:  2020 <br>Total Cases:  14615","Province:  Samut Prakan <br>Year:  2021 <br>Total Cases:  14002","Province:  Samut Prakan <br>Year:  2022 <br>Total Cases:  7366","Province:  Nonthaburi <br>Year:  2017 <br>Total Cases:  7348","Province:  Nonthaburi <br>Year:  2018 <br>Total Cases:  9583","Province:  Nonthaburi <br>Year:  2019 <br>Total Cases:  11347","Province:  Nonthaburi <br>Year:  2020 <br>Total Cases:  7064","Province:  Nonthaburi <br>Year:  2021 <br>Total Cases:  10290","Province:  Nonthaburi <br>Year:  2022 <br>Total Cases:  3912","Province:  Pathum Thani <br>Year:  2017 <br>Total Cases:  7616","Province:  Pathum Thani <br>Year:  2018 <br>Total Cases:  11005","Province:  Pathum Thani <br>Year:  2019 <br>Total Cases:  14643","Province:  Pathum Thani <br>Year:  2020 <br>Total Cases:  8744","Province:  Pathum Thani <br>Year:  2021 <br>Total Cases:  8927","Province:  Pathum Thani <br>Year:  2022 <br>Total Cases:  5571","Province:  Phra Nakhon Si Ayutthaya <br>Year:  2017 <br>Total Cases:  6221","Province:  Phra Nakhon Si Ayutthaya <br>Year:  2018 <br>Total Cases:  8555","Province:  Phra Nakhon Si Ayutthaya <br>Year:  2019 <br>Total Cases:  10631","Province:  Phra Nakhon Si Ayutthaya <br>Year:  2020 <br>Total Cases:  8549","Province:  Phra Nakhon Si Ayutthaya <br>Year:  2021 <br>Total Cases:  8013","Province:  Phra Nakhon Si Ayutthaya <br>Year:  2022 <br>Total Cases:  4890","Province:  Ang Thong <br>Year:  2017 <br>Total Cases:  1614","Province:  Ang Thong <br>Year:  2018 <br>Total Cases:  2717","Province:  Ang Thong <br>Year:  2019 <br>Total Cases:  2781","Province:  Ang Thong <br>Year:  2020 <br>Total Cases:  2636","Province:  Ang Thong <br>Year:  2021 <br>Total Cases:  3513","Province:  Ang Thong <br>Year:  2022 <br>Total Cases:  2907","Province:  Lop Buri <br>Year:  2017 <br>Total Cases:  5872","Province:  Lop Buri <br>Year:  2018 <br>Total Cases:  9547","Province:  Lop Buri <br>Year:  2019 <br>Total Cases:  10043","Province:  Lop Buri <br>Year:  2020 <br>Total Cases:  8132","Province:  Lop Buri <br>Year:  2021 <br>Total Cases:  9254","Province:  Lop Buri <br>Year:  2022 <br>Total Cases:  4647","Province:  Sing Buri <br>Year:  2017 <br>Total Cases:  1574","Province:  Sing Buri <br>Year:  2018 <br>Total Cases:  2117","Province:  Sing Buri <br>Year:  2019 <br>Total Cases:  2586","Province:  Sing Buri <br>Year:  2020 <br>Total Cases:  2209","Province:  Sing Buri <br>Year:  2021 <br>Total Cases:  2872","Province:  Sing Buri <br>Year:  2022 <br>Total Cases:  1744","Province:  Chai Nat <br>Year:  2017 <br>Total Cases:  1536","Province:  Chai Nat <br>Year:  2018 <br>Total Cases:  2195","Province:  Chai Nat <br>Year:  2019 <br>Total Cases:  3215","Province:  Chai Nat <br>Year:  2020 <br>Total Cases:  3119","Province:  Chai Nat <br>Year:  2021 <br>Total Cases:  3128","Province:  Chai Nat <br>Year:  2022 <br>Total Cases:  2117","Province:  Saraburi <br>Year:  2017 <br>Total Cases:  4288","Province:  Saraburi <br>Year:  2018 <br>Total Cases:  5766","Province:  Saraburi <br>Year:  2019 <br>Total Cases:  6391","Province:  Saraburi <br>Year:  2020 <br>Total Cases:  5632","Province:  Saraburi <br>Year:  2021 <br>Total Cases:  6744","Province:  Saraburi <br>Year:  2022 <br>Total Cases:  3585","Province:  Chon Buri <br>Year:  2017 <br>Total Cases:  17286","Province:  Chon Buri <br>Year:  2018 <br>Total Cases:  24021","Province:  Chon Buri <br>Year:  2019 <br>Total Cases:  25727","Province:  Chon Buri <br>Year:  2020 <br>Total Cases:  23940","Province:  Chon Buri <br>Year:  2021 <br>Total Cases:  21736","Province:  Chon Buri <br>Year:  2022 <br>Total Cases:  8643","Province:  Rayong <br>Year:  2017 <br>Total Cases:  13563","Province:  Rayong <br>Year:  2018 <br>Total Cases:  14821","Province:  Rayong <br>Year:  2019 <br>Total Cases:  14648","Province:  Rayong <br>Year:  2020 <br>Total Cases:  15390","Province:  Rayong <br>Year:  2021 <br>Total Cases:  15427","Province:  Rayong <br>Year:  2022 <br>Total Cases:  7487","Province:  Chanthaburi <br>Year:  2017 <br>Total Cases:  4021","Province:  Chanthaburi <br>Year:  2018 <br>Total Cases:  5430","Province:  Chanthaburi <br>Year:  2019 <br>Total Cases:  5862","Province:  Chanthaburi <br>Year:  2020 <br>Total Cases:  5877","Province:  Chanthaburi <br>Year:  2021 <br>Total Cases:  6635","Province:  Chanthaburi <br>Year:  2022 <br>Total Cases:  3648","Province:  Trat <br>Year:  2017 <br>Total Cases:  1482","Province:  Trat <br>Year:  2018 <br>Total Cases:  2108","Province:  Trat <br>Year:  2019 <br>Total Cases:  2570","Province:  Trat <br>Year:  2020 <br>Total Cases:  2900","Province:  Trat <br>Year:  2021 <br>Total Cases:  2991","Province:  Trat <br>Year:  2022 <br>Total Cases:  1445","Province:  Chachoengsao <br>Year:  2017 <br>Total Cases:  9318","Province:  Chachoengsao <br>Year:  2018 <br>Total Cases:  8685","Province:  Chachoengsao <br>Year:  2019 <br>Total Cases:  9086","Province:  Chachoengsao <br>Year:  2020 <br>Total Cases:  9203","Province:  Chachoengsao <br>Year:  2021 <br>Total Cases:  12344","Province:  Chachoengsao <br>Year:  2022 <br>Total Cases:  4878","Province:  Prachin Buri <br>Year:  2017 <br>Total Cases:  6395","Province:  Prachin Buri <br>Year:  2018 <br>Total Cases:  7059","Province:  Prachin Buri <br>Year:  2019 <br>Total Cases:  6191","Province:  Prachin Buri <br>Year:  2020 <br>Total Cases:  6241","Province:  Prachin Buri <br>Year:  2021 <br>Total Cases:  6875","Province:  Prachin Buri <br>Year:  2022 <br>Total Cases:  3255","Province:  Nakhon Nayok <br>Year:  2017 <br>Total Cases:  4384","Province:  Nakhon Nayok <br>Year:  2018 <br>Total Cases:  4870","Province:  Nakhon Nayok <br>Year:  2019 <br>Total Cases:  4740","Province:  Nakhon Nayok <br>Year:  2020 <br>Total Cases:  4130","Province:  Nakhon Nayok <br>Year:  2021 <br>Total Cases:  6909","Province:  Nakhon Nayok <br>Year:  2022 <br>Total Cases:  3183","Province:  Sa Kaeo <br>Year:  2017 <br>Total Cases:  5304","Province:  Sa Kaeo <br>Year:  2018 <br>Total Cases:  5492","Province:  Sa Kaeo <br>Year:  2019 <br>Total Cases:  5723","Province:  Sa Kaeo <br>Year:  2020 <br>Total Cases:  5101","Province:  Sa Kaeo <br>Year:  2021 <br>Total Cases:  6848","Province:  Sa Kaeo <br>Year:  2022 <br>Total Cases:  3240","Province:  Nakhon Ratchasima <br>Year:  2017 <br>Total Cases:  10147","Province:  Nakhon Ratchasima <br>Year:  2018 <br>Total Cases:  17586","Province:  Nakhon Ratchasima <br>Year:  2019 <br>Total Cases:  24283","Province:  Nakhon Ratchasima <br>Year:  2020 <br>Total Cases:  11802","Province:  Nakhon Ratchasima <br>Year:  2021 <br>Total Cases:  21949","Province:  Nakhon Ratchasima <br>Year:  2022 <br>Total Cases:  11943","Province:  Buri Ram <br>Year:  2017 <br>Total Cases:  5061","Province:  Buri Ram <br>Year:  2018 <br>Total Cases:  8774","Province:  Buri Ram <br>Year:  2019 <br>Total Cases:  12393","Province:  Buri Ram <br>Year:  2020 <br>Total Cases:  6897","Province:  Buri Ram <br>Year:  2021 <br>Total Cases:  15960","Province:  Buri Ram <br>Year:  2022 <br>Total Cases:  8267","Province:  Surin <br>Year:  2017 <br>Total Cases:  4658","Province:  Surin <br>Year:  2018 <br>Total Cases:  9100","Province:  Surin <br>Year:  2019 <br>Total Cases:  11345","Province:  Surin <br>Year:  2020 <br>Total Cases:  4830","Province:  Surin <br>Year:  2021 <br>Total Cases:  9592","Province:  Surin <br>Year:  2022 <br>Total Cases:  5265","Province:  Si Sa Ket <br>Year:  2017 <br>Total Cases:  8150","Province:  Si Sa Ket <br>Year:  2018 <br>Total Cases:  10809","Province:  Si Sa Ket <br>Year:  2019 <br>Total Cases:  14779","Province:  Si Sa Ket <br>Year:  2020 <br>Total Cases:  9465","Province:  Si Sa Ket <br>Year:  2021 <br>Total Cases:  22484","Province:  Si Sa Ket <br>Year:  2022 <br>Total Cases:  11723","Province:  Ubon Ratchathani <br>Year:  2017 <br>Total Cases:  14761","Province:  Ubon Ratchathani <br>Year:  2018 <br>Total Cases:  19419","Province:  Ubon Ratchathani <br>Year:  2019 <br>Total Cases:  24878","Province:  Ubon Ratchathani <br>Year:  2020 <br>Total Cases:  15635","Province:  Ubon Ratchathani <br>Year:  2021 <br>Total Cases:  28121","Province:  Ubon Ratchathani <br>Year:  2022 <br>Total Cases:  11271","Province:  Yasothon <br>Year:  2017 <br>Total Cases:  4755","Province:  Yasothon <br>Year:  2018 <br>Total Cases:  5897","Province:  Yasothon <br>Year:  2019 <br>Total Cases:  7874","Province:  Yasothon <br>Year:  2020 <br>Total Cases:  6054","Province:  Yasothon <br>Year:  2021 <br>Total Cases:  12144","Province:  Yasothon <br>Year:  2022 <br>Total Cases:  5867","Province:  Chaiyaphum <br>Year:  2017 <br>Total Cases:  6435","Province:  Chaiyaphum <br>Year:  2018 <br>Total Cases:  11334","Province:  Chaiyaphum <br>Year:  2019 <br>Total Cases:  14796","Province:  Chaiyaphum <br>Year:  2020 <br>Total Cases:  8333","Province:  Chaiyaphum <br>Year:  2021 <br>Total Cases:  15131","Province:  Chaiyaphum <br>Year:  2022 <br>Total Cases:  8468","Province:  Amnat Charoen <br>Year:  2017 <br>Total Cases:  5076","Province:  Amnat Charoen <br>Year:  2018 <br>Total Cases:  5651","Province:  Amnat Charoen <br>Year:  2019 <br>Total Cases:  7339","Province:  Amnat Charoen <br>Year:  2020 <br>Total Cases:  3949","Province:  Amnat Charoen <br>Year:  2021 <br>Total Cases:  8961","Province:  Amnat Charoen <br>Year:  2022 <br>Total Cases:  4459","Province:  Bueng Kan <br>Year:  2017 <br>Total Cases:  4312","Province:  Bueng Kan <br>Year:  2018 <br>Total Cases:  4326","Province:  Bueng Kan <br>Year:  2019 <br>Total Cases:  4746","Province:  Bueng Kan <br>Year:  2020 <br>Total Cases:  6030","Province:  Bueng Kan <br>Year:  2021 <br>Total Cases:  9095","Province:  Bueng Kan <br>Year:  2022 <br>Total Cases:  6778","Province:  Nong Bua Lam Phu <br>Year:  2017 <br>Total Cases:  1181","Province:  Nong Bua Lam Phu <br>Year:  2018 <br>Total Cases:  1769","Province:  Nong Bua Lam Phu <br>Year:  2019 <br>Total Cases:  1691","Province:  Nong Bua Lam Phu <br>Year:  2020 <br>Total Cases:  2298","Province:  Nong Bua Lam Phu <br>Year:  2021 <br>Total Cases:  5112","Province:  Nong Bua Lam Phu <br>Year:  2022 <br>Total Cases:  3128","Province:  Khon Kaen <br>Year:  2017 <br>Total Cases:  10698","Province:  Khon Kaen <br>Year:  2018 <br>Total Cases:  14138","Province:  Khon Kaen <br>Year:  2019 <br>Total Cases:  14274","Province:  Khon Kaen <br>Year:  2020 <br>Total Cases:  15488","Province:  Khon Kaen <br>Year:  2021 <br>Total Cases:  25903","Province:  Khon Kaen <br>Year:  2022 <br>Total Cases:  13404","Province:  Udon Thani <br>Year:  2017 <br>Total Cases:  5957","Province:  Udon Thani <br>Year:  2018 <br>Total Cases:  6497","Province:  Udon Thani <br>Year:  2019 <br>Total Cases:  7422","Province:  Udon Thani <br>Year:  2020 <br>Total Cases:  10517","Province:  Udon Thani <br>Year:  2021 <br>Total Cases:  22449","Province:  Udon Thani <br>Year:  2022 <br>Total Cases:  15185","Province:  Loei <br>Year:  2017 <br>Total Cases:  4211","Province:  Loei <br>Year:  2018 <br>Total Cases:  5097","Province:  Loei <br>Year:  2019 <br>Total Cases:  5024","Province:  Loei <br>Year:  2020 <br>Total Cases:  5342","Province:  Loei <br>Year:  2021 <br>Total Cases:  9555","Province:  Loei <br>Year:  2022 <br>Total Cases:  8845","Province:  Nong Khai <br>Year:  2017 <br>Total Cases:  5434","Province:  Nong Khai <br>Year:  2018 <br>Total Cases:  6317","Province:  Nong Khai <br>Year:  2019 <br>Total Cases:  6581","Province:  Nong Khai <br>Year:  2020 <br>Total Cases:  6386","Province:  Nong Khai <br>Year:  2021 <br>Total Cases:  11698","Province:  Nong Khai <br>Year:  2022 <br>Total Cases:  6371","Province:  Maha Sarakham <br>Year:  2017 <br>Total Cases:  3987","Province:  Maha Sarakham <br>Year:  2018 <br>Total Cases:  5500","Province:  Maha Sarakham <br>Year:  2019 <br>Total Cases:  5681","Province:  Maha Sarakham <br>Year:  2020 <br>Total Cases:  6497","Province:  Maha Sarakham <br>Year:  2021 <br>Total Cases:  9985","Province:  Maha Sarakham <br>Year:  2022 <br>Total Cases:  6907","Province:  Roi Et <br>Year:  2017 <br>Total Cases:  4850","Province:  Roi Et <br>Year:  2018 <br>Total Cases:  6198","Province:  Roi Et <br>Year:  2019 <br>Total Cases:  7270","Province:  Roi Et <br>Year:  2020 <br>Total Cases:  9212","Province:  Roi Et <br>Year:  2021 <br>Total Cases:  14778","Province:  Roi Et <br>Year:  2022 <br>Total Cases:  10869","Province:  Kalasin <br>Year:  2017 <br>Total Cases:  5461","Province:  Kalasin <br>Year:  2018 <br>Total Cases:  6535","Province:  Kalasin <br>Year:  2019 <br>Total Cases:  6339","Province:  Kalasin <br>Year:  2020 <br>Total Cases:  8923","Province:  Kalasin <br>Year:  2021 <br>Total Cases:  15388","Province:  Kalasin <br>Year:  2022 <br>Total Cases:  12954","Province:  Sakon Nakhon <br>Year:  2017 <br>Total Cases:  3901","Province:  Sakon Nakhon <br>Year:  2018 <br>Total Cases:  4262","Province:  Sakon Nakhon <br>Year:  2019 <br>Total Cases:  4991","Province:  Sakon Nakhon <br>Year:  2020 <br>Total Cases:  6834","Province:  Sakon Nakhon <br>Year:  2021 <br>Total Cases:  11171","Province:  Sakon Nakhon <br>Year:  2022 <br>Total Cases:  10008","Province:  Nakhon Phanom <br>Year:  2017 <br>Total Cases:  4539","Province:  Nakhon Phanom <br>Year:  2018 <br>Total Cases:  3637","Province:  Nakhon Phanom <br>Year:  2019 <br>Total Cases:  3662","Province:  Nakhon Phanom <br>Year:  2020 <br>Total Cases:  5068","Province:  Nakhon Phanom <br>Year:  2021 <br>Total Cases:  8478","Province:  Nakhon Phanom <br>Year:  2022 <br>Total Cases:  7955","Province:  Mukdahan <br>Year:  2017 <br>Total Cases:  4029","Province:  Mukdahan <br>Year:  2018 <br>Total Cases:  5558","Province:  Mukdahan <br>Year:  2019 <br>Total Cases:  5529","Province:  Mukdahan <br>Year:  2020 <br>Total Cases:  7431","Province:  Mukdahan <br>Year:  2021 <br>Total Cases:  9744","Province:  Mukdahan <br>Year:  2022 <br>Total Cases:  4462","Province:  Chiang Mai <br>Year:  2017 <br>Total Cases:  15620","Province:  Chiang Mai <br>Year:  2018 <br>Total Cases:  18944","Province:  Chiang Mai <br>Year:  2019 <br>Total Cases:  21722","Province:  Chiang Mai <br>Year:  2020 <br>Total Cases:  22574","Province:  Chiang Mai <br>Year:  2021 <br>Total Cases:  28778","Province:  Chiang Mai <br>Year:  2022 <br>Total Cases:  14174","Province:  Lamphun <br>Year:  2017 <br>Total Cases:  3735","Province:  Lamphun <br>Year:  2018 <br>Total Cases:  5339","Province:  Lamphun <br>Year:  2019 <br>Total Cases:  6179","Province:  Lamphun <br>Year:  2020 <br>Total Cases:  6103","Province:  Lamphun <br>Year:  2021 <br>Total Cases:  9087","Province:  Lamphun <br>Year:  2022 <br>Total Cases:  6184","Province:  Lampang <br>Year:  2017 <br>Total Cases:  5441","Province:  Lampang <br>Year:  2018 <br>Total Cases:  7330","Province:  Lampang <br>Year:  2019 <br>Total Cases:  8296","Province:  Lampang <br>Year:  2020 <br>Total Cases:  8700","Province:  Lampang <br>Year:  2021 <br>Total Cases:  11604","Province:  Lampang <br>Year:  2022 <br>Total Cases:  8863","Province:  Uttaradit <br>Year:  2017 <br>Total Cases:  2210","Province:  Uttaradit <br>Year:  2018 <br>Total Cases:  3990","Province:  Uttaradit <br>Year:  2019 <br>Total Cases:  4555","Province:  Uttaradit <br>Year:  2020 <br>Total Cases:  4266","Province:  Uttaradit <br>Year:  2021 <br>Total Cases:  7337","Province:  Uttaradit <br>Year:  2022 <br>Total Cases:  4627","Province:  Phrae <br>Year:  2017 <br>Total Cases:  4737","Province:  Phrae <br>Year:  2018 <br>Total Cases:  5265","Province:  Phrae <br>Year:  2019 <br>Total Cases:  5642","Province:  Phrae <br>Year:  2020 <br>Total Cases:  6485","Province:  Phrae <br>Year:  2021 <br>Total Cases:  9874","Province:  Phrae <br>Year:  2022 <br>Total Cases:  5702","Province:  Nan <br>Year:  2017 <br>Total Cases:  2960","Province:  Nan <br>Year:  2018 <br>Total Cases:  3962","Province:  Nan <br>Year:  2019 <br>Total Cases:  5577","Province:  Nan <br>Year:  2020 <br>Total Cases:  5970","Province:  Nan <br>Year:  2021 <br>Total Cases:  9520","Province:  Nan <br>Year:  2022 <br>Total Cases:  5695","Province:  Phayao <br>Year:  2017 <br>Total Cases:  3339","Province:  Phayao <br>Year:  2018 <br>Total Cases:  4342","Province:  Phayao <br>Year:  2019 <br>Total Cases:  5082","Province:  Phayao <br>Year:  2020 <br>Total Cases:  5881","Province:  Phayao <br>Year:  2021 <br>Total Cases:  8888","Province:  Phayao <br>Year:  2022 <br>Total Cases:  5262","Province:  Chiang Rai <br>Year:  2017 <br>Total Cases:  8820","Province:  Chiang Rai <br>Year:  2018 <br>Total Cases:  10623","Province:  Chiang Rai <br>Year:  2019 <br>Total Cases:  12419","Province:  Chiang Rai <br>Year:  2020 <br>Total Cases:  14453","Province:  Chiang Rai <br>Year:  2021 <br>Total Cases:  19353","Province:  Chiang Rai <br>Year:  2022 <br>Total Cases:  9684","Province:  Mae Hong Son <br>Year:  2017 <br>Total Cases:  864","Province:  Mae Hong Son <br>Year:  2018 <br>Total Cases:  950","Province:  Mae Hong Son <br>Year:  2019 <br>Total Cases:  1029","Province:  Mae Hong Son <br>Year:  2020 <br>Total Cases:  1188","Province:  Mae Hong Son <br>Year:  2021 <br>Total Cases:  2275","Province:  Mae Hong Son <br>Year:  2022 <br>Total Cases:  1739","Province:  Nakhon Sawan <br>Year:  2017 <br>Total Cases:  4246","Province:  Nakhon Sawan <br>Year:  2018 <br>Total Cases:  5176","Province:  Nakhon Sawan <br>Year:  2019 <br>Total Cases:  5045","Province:  Nakhon Sawan <br>Year:  2020 <br>Total Cases:  5682","Province:  Nakhon Sawan <br>Year:  2021 <br>Total Cases:  6396","Province:  Nakhon Sawan <br>Year:  2022 <br>Total Cases:  4165","Province:  Uthai Thani <br>Year:  2017 <br>Total Cases:  1251","Province:  Uthai Thani <br>Year:  2018 <br>Total Cases:  1964","Province:  Uthai Thani <br>Year:  2019 <br>Total Cases:  3245","Province:  Uthai Thani <br>Year:  2020 <br>Total Cases:  2164","Province:  Uthai Thani <br>Year:  2021 <br>Total Cases:  2057","Province:  Uthai Thani <br>Year:  2022 <br>Total Cases:  1673","Province:  Kamphaeng Phet <br>Year:  2017 <br>Total Cases:  3052","Province:  Kamphaeng Phet <br>Year:  2018 <br>Total Cases:  5243","Province:  Kamphaeng Phet <br>Year:  2019 <br>Total Cases:  7420","Province:  Kamphaeng Phet <br>Year:  2020 <br>Total Cases:  5228","Province:  Kamphaeng Phet <br>Year:  2021 <br>Total Cases:  5090","Province:  Kamphaeng Phet <br>Year:  2022 <br>Total Cases:  3211","Province:  Tak <br>Year:  2017 <br>Total Cases:  3117","Province:  Tak <br>Year:  2018 <br>Total Cases:  5368","Province:  Tak <br>Year:  2019 <br>Total Cases:  5681","Province:  Tak <br>Year:  2020 <br>Total Cases:  4206","Province:  Tak <br>Year:  2021 <br>Total Cases:  3406","Province:  Tak <br>Year:  2022 <br>Total Cases:  1752","Province:  Sukhothai <br>Year:  2017 <br>Total Cases:  1876","Province:  Sukhothai <br>Year:  2018 <br>Total Cases:  3059","Province:  Sukhothai <br>Year:  2019 <br>Total Cases:  4330","Province:  Sukhothai <br>Year:  2020 <br>Total Cases:  4432","Province:  Sukhothai <br>Year:  2021 <br>Total Cases:  4164","Province:  Sukhothai <br>Year:  2022 <br>Total Cases:  1942","Province:  Phitsanulok <br>Year:  2017 <br>Total Cases:  2858","Province:  Phitsanulok <br>Year:  2018 <br>Total Cases:  5390","Province:  Phitsanulok <br>Year:  2019 <br>Total Cases:  6996","Province:  Phitsanulok <br>Year:  2020 <br>Total Cases:  6827","Province:  Phitsanulok <br>Year:  2021 <br>Total Cases:  5656","Province:  Phitsanulok <br>Year:  2022 <br>Total Cases:  2908","Province:  Phichit <br>Year:  2017 <br>Total Cases:  2033","Province:  Phichit <br>Year:  2018 <br>Total Cases:  4560","Province:  Phichit <br>Year:  2019 <br>Total Cases:  3994","Province:  Phichit <br>Year:  2020 <br>Total Cases:  3811","Province:  Phichit <br>Year:  2021 <br>Total Cases:  4090","Province:  Phichit <br>Year:  2022 <br>Total Cases:  2011","Province:  Phetchabun <br>Year:  2017 <br>Total Cases:  4450","Province:  Phetchabun <br>Year:  2018 <br>Total Cases:  7375","Province:  Phetchabun <br>Year:  2019 <br>Total Cases:  6471","Province:  Phetchabun <br>Year:  2020 <br>Total Cases:  6035","Province:  Phetchabun <br>Year:  2021 <br>Total Cases:  9832","Province:  Phetchabun <br>Year:  2022 <br>Total Cases:  5315","Province:  Ratchaburi <br>Year:  2017 <br>Total Cases:  9082","Province:  Ratchaburi <br>Year:  2018 <br>Total Cases:  12885","Province:  Ratchaburi <br>Year:  2019 <br>Total Cases:  12937","Province:  Ratchaburi <br>Year:  2020 <br>Total Cases:  8597","Province:  Ratchaburi <br>Year:  2021 <br>Total Cases:  5270","Province:  Ratchaburi <br>Year:  2022 <br>Total Cases:  7385","Province:  Kanchanaburi <br>Year:  2017 <br>Total Cases:  7420","Province:  Kanchanaburi <br>Year:  2018 <br>Total Cases:  9665","Province:  Kanchanaburi <br>Year:  2019 <br>Total Cases:  8802","Province:  Kanchanaburi <br>Year:  2020 <br>Total Cases:  6482","Province:  Kanchanaburi <br>Year:  2021 <br>Total Cases:  5385","Province:  Kanchanaburi <br>Year:  2022 <br>Total Cases:  5767","Province:  Suphan Buri <br>Year:  2017 <br>Total Cases:  5967","Province:  Suphan Buri <br>Year:  2018 <br>Total Cases:  7495","Province:  Suphan Buri <br>Year:  2019 <br>Total Cases:  7249","Province:  Suphan Buri <br>Year:  2020 <br>Total Cases:  6179","Province:  Suphan Buri <br>Year:  2021 <br>Total Cases:  5726","Province:  Suphan Buri <br>Year:  2022 <br>Total Cases:  5274","Province:  Nakhon Pathom <br>Year:  2017 <br>Total Cases:  7870","Province:  Nakhon Pathom <br>Year:  2018 <br>Total Cases:  9936","Province:  Nakhon Pathom <br>Year:  2019 <br>Total Cases:  9071","Province:  Nakhon Pathom <br>Year:  2020 <br>Total Cases:  7472","Province:  Nakhon Pathom <br>Year:  2021 <br>Total Cases:  5366","Province:  Nakhon Pathom <br>Year:  2022 <br>Total Cases:  6211","Province:  Samut Sakhon <br>Year:  2017 <br>Total Cases:  3857","Province:  Samut Sakhon <br>Year:  2018 <br>Total Cases:  4406","Province:  Samut Sakhon <br>Year:  2019 <br>Total Cases:  4387","Province:  Samut Sakhon <br>Year:  2020 <br>Total Cases:  3889","Province:  Samut Sakhon <br>Year:  2021 <br>Total Cases:  1471","Province:  Samut Sakhon <br>Year:  2022 <br>Total Cases:  1264","Province:  Samut Songkhram <br>Year:  2017 <br>Total Cases:  1598","Province:  Samut Songkhram <br>Year:  2018 <br>Total Cases:  1796","Province:  Samut Songkhram <br>Year:  2019 <br>Total Cases:  1942","Province:  Samut Songkhram <br>Year:  2020 <br>Total Cases:  1363","Province:  Samut Songkhram <br>Year:  2021 <br>Total Cases:  846","Province:  Samut Songkhram <br>Year:  2022 <br>Total Cases:  1350","Province:  Phetchaburi <br>Year:  2017 <br>Total Cases:  3714","Province:  Phetchaburi <br>Year:  2018 <br>Total Cases:  4962","Province:  Phetchaburi <br>Year:  2019 <br>Total Cases:  5196","Province:  Phetchaburi <br>Year:  2020 <br>Total Cases:  5046","Province:  Phetchaburi <br>Year:  2021 <br>Total Cases:  4451","Province:  Phetchaburi <br>Year:  2022 <br>Total Cases:  3560","Province:  Prachuap Khiri Khan <br>Year:  2017 <br>Total Cases:  4284","Province:  Prachuap Khiri Khan <br>Year:  2018 <br>Total Cases:  5317","Province:  Prachuap Khiri Khan <br>Year:  2019 <br>Total Cases:  4935","Province:  Prachuap Khiri Khan <br>Year:  2020 <br>Total Cases:  4983","Province:  Prachuap Khiri Khan <br>Year:  2021 <br>Total Cases:  4850","Province:  Prachuap Khiri Khan <br>Year:  2022 <br>Total Cases:  3575","Province:  Nakhon Si Thammarat <br>Year:  2017 <br>Total Cases:  21330","Province:  Nakhon Si Thammarat <br>Year:  2018 <br>Total Cases:  24032","Province:  Nakhon Si Thammarat <br>Year:  2019 <br>Total Cases:  27228","Province:  Nakhon Si Thammarat <br>Year:  2020 <br>Total Cases:  29929","Province:  Nakhon Si Thammarat <br>Year:  2021 <br>Total Cases:  40983","Province:  Nakhon Si Thammarat <br>Year:  2022 <br>Total Cases:  13459","Province:  Krabi <br>Year:  2017 <br>Total Cases:  7756","Province:  Krabi <br>Year:  2018 <br>Total Cases:  8474","Province:  Krabi <br>Year:  2019 <br>Total Cases:  8913","Province:  Krabi <br>Year:  2020 <br>Total Cases:  9880","Province:  Krabi <br>Year:  2021 <br>Total Cases:  10442","Province:  Krabi <br>Year:  2022 <br>Total Cases:  3004","Province:  Phangnga <br>Year:  2017 <br>Total Cases:  4261","Province:  Phangnga <br>Year:  2018 <br>Total Cases:  5043","Province:  Phangnga <br>Year:  2019 <br>Total Cases:  5443","Province:  Phangnga <br>Year:  2020 <br>Total Cases:  6355","Province:  Phangnga <br>Year:  2021 <br>Total Cases:  7419","Province:  Phangnga <br>Year:  2022 <br>Total Cases:  2576","Province:  Phuket <br>Year:  2017 <br>Total Cases:  13731","Province:  Phuket <br>Year:  2018 <br>Total Cases:  14459","Province:  Phuket <br>Year:  2019 <br>Total Cases:  14862","Province:  Phuket <br>Year:  2020 <br>Total Cases:  14062","Province:  Phuket <br>Year:  2021 <br>Total Cases:  15375","Province:  Phuket <br>Year:  2022 <br>Total Cases:  2832","Province:  Surat Thani <br>Year:  2017 <br>Total Cases:  22044","Province:  Surat Thani <br>Year:  2018 <br>Total Cases:  22651","Province:  Surat Thani <br>Year:  2019 <br>Total Cases:  23185","Province:  Surat Thani <br>Year:  2020 <br>Total Cases:  24199","Province:  Surat Thani <br>Year:  2021 <br>Total Cases:  28566","Province:  Surat Thani <br>Year:  2022 <br>Total Cases:  9709","Province:  Ranong <br>Year:  2017 <br>Total Cases:  3571","Province:  Ranong <br>Year:  2018 <br>Total Cases:  4633","Province:  Ranong <br>Year:  2019 <br>Total Cases:  4845","Province:  Ranong <br>Year:  2020 <br>Total Cases:  5226","Province:  Ranong <br>Year:  2021 <br>Total Cases:  6077","Province:  Ranong <br>Year:  2022 <br>Total Cases:  2141","Province:  Chumphon <br>Year:  2017 <br>Total Cases:  8245","Province:  Chumphon <br>Year:  2018 <br>Total Cases:  9156","Province:  Chumphon <br>Year:  2019 <br>Total Cases:  9643","Province:  Chumphon <br>Year:  2020 <br>Total Cases:  10320","Province:  Chumphon <br>Year:  2021 <br>Total Cases:  11811","Province:  Chumphon <br>Year:  2022 <br>Total Cases:  5852","Province:  Songkhla <br>Year:  2017 <br>Total Cases:  21034","Province:  Songkhla <br>Year:  2018 <br>Total Cases:  23446","Province:  Songkhla <br>Year:  2019 <br>Total Cases:  24647","Province:  Songkhla <br>Year:  2020 <br>Total Cases:  23056","Province:  Songkhla <br>Year:  2021 <br>Total Cases:  28509","Province:  Songkhla <br>Year:  2022 <br>Total Cases:  17209","Province:  Satun <br>Year:  2017 <br>Total Cases:  6561","Province:  Satun <br>Year:  2018 <br>Total Cases:  7370","Province:  Satun <br>Year:  2019 <br>Total Cases:  8109","Province:  Satun <br>Year:  2020 <br>Total Cases:  7240","Province:  Satun <br>Year:  2021 <br>Total Cases:  8021","Province:  Satun <br>Year:  2022 <br>Total Cases:  3625","Province:  Trang <br>Year:  2017 <br>Total Cases:  7610","Province:  Trang <br>Year:  2018 <br>Total Cases:  7515","Province:  Trang <br>Year:  2019 <br>Total Cases:  8464","Province:  Trang <br>Year:  2020 <br>Total Cases:  7625","Province:  Trang <br>Year:  2021 <br>Total Cases:  9176","Province:  Trang <br>Year:  2022 <br>Total Cases:  3865","Province:  Phatthalung <br>Year:  2017 <br>Total Cases:  5390","Province:  Phatthalung <br>Year:  2018 <br>Total Cases:  5599","Province:  Phatthalung <br>Year:  2019 <br>Total Cases:  5085","Province:  Phatthalung <br>Year:  2020 <br>Total Cases:  5087","Province:  Phatthalung <br>Year:  2021 <br>Total Cases:  7408","Province:  Phatthalung <br>Year:  2022 <br>Total Cases:  4291","Province:  Pattani <br>Year:  2017 <br>Total Cases:  7566","Province:  Pattani <br>Year:  2018 <br>Total Cases:  8727","Province:  Pattani <br>Year:  2019 <br>Total Cases:  9040","Province:  Pattani <br>Year:  2020 <br>Total Cases:  9332","Province:  Pattani <br>Year:  2021 <br>Total Cases:  11163","Province:  Pattani <br>Year:  2022 <br>Total Cases:  6266","Province:  Yala <br>Year:  2017 <br>Total Cases:  7406","Province:  Yala <br>Year:  2018 <br>Total Cases:  7822","Province:  Yala <br>Year:  2019 <br>Total Cases:  6897","Province:  Yala <br>Year:  2020 <br>Total Cases:  7003","Province:  Yala <br>Year:  2021 <br>Total Cases:  7337","Province:  Yala <br>Year:  2022 <br>Total Cases:  3346","Province:  Narathiwat <br>Year:  2017 <br>Total Cases:  7560","Province:  Narathiwat <br>Year:  2018 <br>Total Cases:  13242","Province:  Narathiwat <br>Year:  2019 <br>Total Cases:  10381","Province:  Narathiwat <br>Year:  2020 <br>Total Cases:  8762","Province:  Narathiwat <br>Year:  2021 <br>Total Cases:  9119","Province:  Narathiwat <br>Year:  2022 <br>Total Cases:  4548"],"textfont":{"size":[86.833888336288538,100,89.719327076936395,66.207672014876962,57.319119491415478,25.016217618821088,25.057734723003072,31.809453790598106,39.125545993166973,27.864031483804006,27.068719456817888,18.459109977079098,18.435756605976735,21.335466851187132,23.62409721921896,18.06729230636163,22.252735371707825,13.977857544436276,18.783462353500845,23.180383168274012,27.900358949963241,20.246940275915755,20.484366215456472,16.130259914370974,16.973576093067507,20.001729879340914,22.695152013147084,19.993945422306794,19.298533927258575,15.24672404099814,10.996410500367599,12.427453185140337,12.510487393504302,12.322363015179691,13.460191151667171,12.673960991220863,16.520780175582754,21.288760108982398,21.932275223803138,19.452925658435326,20.908619123816113,14.931453531116205,10.94451412014012,11.64900748172815,12.257492539895342,11.768369156251351,12.628551658521818,11.165073736106907,10.895212558924015,11.750205423171733,13.073563118972451,12.949011806426501,12.960688491977685,11.64900748172815,14.465683518574579,16.383254767979935,17.194135709034295,16.209401894217876,17.652121264541798,13.553604636076633,31.329412273493922,40.067465294295715,42.280845910997705,39.962375124335082,37.102884573800978,20.11590191584137,26.499156683821305,28.131297841975524,27.906845997491676,28.869523850711413,28.917528002421829,18.616096527267224,14.119275180556155,15.947325174069109,16.507806080525881,16.527267223111188,17.510703628421918,13.635341434934913,10.825152445616919,11.637330796176967,12.236733987804351,12.664879124681054,12.782943389698568,10.7771482939065,20.991653332180078,20.170393115080223,20.690654326860702,20.842451239026076,24.917614496388875,15.231155126929895,17.199325347057041,18.060805258833199,16.9346538078969,16.999524283181248,17.822081909786792,13.12545949919993,14.590234831120529,15.220775850884401,15.052112615145093,14.260692816676038,17.866193832980152,13.032046014790469,15.78385157635255,16.027764563421702,16.327466159235392,15.520477446698091,17.787051853133242,13.105998356614625,22.067205812394587,31.718635125200016,40.407386584785712,24.214418544306533,37.379232798512305,24.3973532846084,15.468581066470612,20.285862561086365,24.981187562167541,17.850624918911905,29.609047268952988,19.628075941703067,14.945725035678763,20.70881805994032,23.621502400207586,15.168879470656922,21.347143536738315,15.733252605630756,19.47627902953769,22.926090905159366,28.07680664273667,21.182372529516066,38.073346884054843,24.111923193357264,28.053453271634304,34.096786749124249,41.179345240669463,29.187389179604722,45.386844267612332,23.525494096786748,15.071573757730398,16.553215413224926,19.118194005968085,16.756908705617782,24.65813259525148,16.514293128054319,17.251221727284523,23.607230895645031,28.098862604333348,19.713704969078407,28.533494788738487,19.888855252346147,15.488042209055919,16.234052674825932,18.424079920425548,14.025861696146695,20.528478138649831,14.687540544047053,14.496821346711066,14.514985079790684,15.059897072179215,16.725770877481295,20.702331012411882,17.696233187735157,10.434632184405137,11.19750897374908,11.096311032305497,11.883838602257493,15.534748951260649,12.960688491977685,22.782078450028109,27.245167149591317,27.421614842364747,28.996669982268738,42.509189983998617,26.292868572417074,16.631059983566146,17.331661116637115,18.53176490939757,22.547247329498767,38.027937551355791,28.603554902045584,14.365782986636681,15.515287808675344,15.420576914760197,15.833153137568655,21.299139385027893,20.377978635990139,15.952514812091856,17.098127405613457,17.440643515114822,17.187648661505861,24.079487955715088,17.168187518920554,14.075163257362799,16.038143839467196,16.272974959996539,17.331661116637115,21.857025472473296,17.863599013968773,15.194827660770661,16.943735674436709,18.334558664533148,20.854127924577263,28.075509233230985,23.003935475500583,15.987544868745404,17.380962677853219,17.126670414738573,20.479176577433723,28.866929031700039,25.709034294857936,13.963586039873718,14.431950871426718,15.377762401072525,17.768888120053624,23.395753146218052,21.886865891104094,14.791333304502011,13.621069930372357,13.653505168014531,15.477662933010423,19.901829347403016,19.223284175928729,14.129654456601653,16.113393590797042,16.075768715132121,18.543441594948753,21.544349781602733,14.691432772564113,29.167928037019418,33.480517233922932,37.08472084072136,38.190113739566669,46.239242312848681,27.291873891796048,13.74821606192968,15.829260909051595,16.919084893828657,16.820481771396445,20.691951736366388,16.925571941357092,15.961596678631665,18.412403234874368,19.665700817367988,20.18985425766553,23.957531462180512,20.401332007092506,11.769666565757039,14.079055485879859,14.812091856593003,14.437140509449467,18.421485101414177,14.905505341002465,15.048220386628032,15.733252605630756,16.222375989274749,17.316092202568871,21.713013017342039,16.300220559615965,12.742723695022272,14.042728019720624,16.138044371405094,16.647926307140075,21.253730052328848,16.291138693076157,13.234441897677637,14.535743631881676,15.495826666090039,16.532456861133937,20.433767244734682,15.729360377113697,20.345543398347964,22.684772737101589,25.014920209315399,27.653851143882715,34.011157721748909,21.466505211261513,10.023353371102365,10.134930588591446,10.237425939540717,10.443714050944946,11.853998183626691,11.158586688578472,14.411192319335726,15.617783159624615,15.447822514379622,16.274272369502228,17.20062275656273,14.306102149375082,10.525450849803226,11.450503827358041,13.112485404143062,11.709985728495438,11.571162911386931,11.07295766120313,12.862085369545474,15.704709596505644,18.529170090386195,15.685248453920339,15.506205942135537,13.068373480949704,12.946416987415128,15.866885784716516,16.272974959996539,14.359295939108247,13.321368334558665,11.175453012152403,11.336331790857587,12.871167236085283,14.520174717813433,14.652510487393505,14.304804739869393,11.421960818232929,12.6103879254422,15.895428793841631,17.979068459974918,17.759806253513815,16.240539722354367,12.675258400726548,11.540025083250443,14.818578904121438,14.084245123902608,13.846819184361891,14.208796436448559,11.511482074125329,14.67586385849587,18.470786662630282,17.297928469489253,16.73225792500973,21.658521818103189,15.798123080915108,20.685464688837953,25.619513038965533,25.686978333261255,20.056221078579767,15.739739653159191,18.483760757687151,18.529170090386195,21.441854430653464,20.3221900272456,17.312199974051808,15.888941746313193,16.38455217748562,16.644034078623015,18.626475803312719,18.307313064913721,16.919084893828657,16.331358387752452,15.74492929118194,19.113004367945337,21.793452406694634,20.671193184275396,18.596635384681917,15.864290965705141,16.960601998010638,13.906500021623492,14.618777840245642,14.594127059637589,13.948017125805475,10.810880941054361,10.542317173377157,10.975651948276608,11.232539030402629,11.421960818232929,10.670760714440167,10,10.653894390866236,13.720970462310254,15.340137525407602,15.643731349738356,15.449119923885309,14.677161268001557,13.521169398434459,14.46049388055183,15.800717899926481,15.305107468754056,15.367383125027029,15.194827660770661,13.540630541019764,36.576136314492061,40.08173679885828,44.228257579033858,47.732560653894396,62.074125329758253,26.364226095229856,18.965099684297023,19.89663970938027,20.466202482376854,21.720797474376162,22.449941616572243,12.799809713272499,14.430653461921031,15.445227695368249,15.964191497643039,17.147428966829565,18.527872680880506,12.244518444838473,26.717121480776715,27.661635600916838,28.184491631708688,27.146564027159105,28.850062708126107,12.576655278294339,37.50248670155257,38.29001427150456,38.982830947541409,40.298404186308005,45.964191497643036,21.498940448903689,13.535440902997015,14.913289798036587,15.188340613242225,15.682653634908966,16.786749124248583,11.680145309864637,19.599532932577951,20.781472992258792,21.413311421528348,22.291657656878435,24.226095229857716,16.494831985469013,36.192103100808716,39.32145482852571,40.879643644855769,38.815465121307788,45.890239155818882,31.229511741556028,17.41469532500108,18.464299615101844,19.423085239804522,18.295636379362541,19.308913203304069,13.605501016304112,18.775677896466721,18.65242399342646,19.883665614323402,18.795139039052025,20.807421182372529,13.916879297668988,15.895428793841631,16.16658738053021,15.499718894607101,15.502313713618475,18.513601176317952,14.469575747091641,18.718591878216493,20.224884314319077,20.6309734895991,21.009817065259696,23.385373870172558,17.031959520823424,18.511006357306577,19.050728711672363,17.850624918911905,17.988150326514727,18.421485101414177,13.243523764217446,18.710807421182373,26.082688232495784,22.370799636725337,20.270293647018121,20.733468840548372,14.803009990053194]},"error_y":{"width":[]},"error_x":{"width":[]},"frame":null},{"x":[98.02949974473222,105.11159291657839],"y":[6.1774973714727786,19.847325205810534],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":846,"cmax":70215,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[846,70215],"line":{"color":"rgba(255,127,14,1)"}},"z":[2017,2022],"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="section-1" class="level1">
<h1></h1>
</section>
<section id="conclusion" class="level1">
<h1><strong>Conclusion</strong></h1>
<p>This comprehensive spatial analysis of drug abuse cases in Thailand from 2017 to 2022 aims to valuable insights into the complex and dynamic nature of this critical social issue. Through a combination of traditional spatial statistical methods and advanced visualization techniques, we have uncovered significant patterns and trends that have important implications for policy-making and intervention strategies.</p>
<p>Key findings from our analysis include:</p>
<ol type="1">
<li><p><strong>Spatial Dependency</strong>: The consistent positive spatial autocorrelation observed across all years indicates that drug abuse cases in Thailand are not randomly distributed but tend to cluster geographically. This spatial dependency strengthened over time, highlighting the increasing importance of location in understanding and addressing drug abuse.</p></li>
<li><p><strong>Regional Variations</strong>: We identified persistent hotspots in the southern region and emerging areas of concern in the northeast, particularly in 2022. Conversely, the western region consistently maintained lower drug abuse rates, offering potential insights into effective control measures.</p></li>
<li><p><strong>Border Influences</strong>: Provinces bordering neighboring countries often showed significant clustering of drug abuse cases, highlighting the potential influence of cross-border activities on drug-related issues.</p></li>
</ol>
</section>
<section id="references" class="level1">
<h1><strong>References</strong></h1>
<ul>
<li><p>Utilized Claude AI to clarify code concepts and refining responses.</p></li>
<li><p>Seniors’s learning from <a href="https://is415-gaa-matthew-ho.netlify.app/takehomeex/takehomeex2/the2" class="uri">https://is415-gaa-matthew-ho.netlify.app/takehomeex/takehomeex2/the2</a></p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>