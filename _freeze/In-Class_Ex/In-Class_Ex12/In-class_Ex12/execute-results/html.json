{
  "hash": "644842059e9ee9488b5cd26af8379d9a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"In-class Exercise 12\"\nauthor: \"Chong Zhi Cheng\"\ndate: \"November 11, 2024\"\ndate-modified: \"last-modified\"\nexecute:\n  eval: true\n  echo: true\n  freeze: true\n---\n\n\n::: callout-note\nThis is a note callout. I will use this for personal comments as well.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, spdep, GWmodel, SpatialML, \n               tmap, rsample, yardstick, tidyverse,\n               knitr, kableExtra, spatialRF)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmdata <- read_rds(\"data/rds/mdata.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nHDB_sample <- mdata %>%\n  sample_n(1500)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\noverlapping_points <- HDB_sample %>%\n  mutate(overlap = lengths(st_equals(., .)) > 1)\nsummary(overlapping_points$overlap)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Mode   FALSE    TRUE \nlogical    1047     453 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nHDB_sample <- HDB_sample %>%\n  st_jitter(amount = 5)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nresale_split <- initial_split(HDB_sample, prop = 0.67/10,)\n\ntrain_data <- training(resale_split)\ntest_data <- testing(resale_split)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(train_data, \"data/rds/train_data.rds\")\nwrite_rds(test_data, \"data/rds/test_data.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmdata_nogeo <- mdata %>%\n  st_drop_geometry()\nggstatsplot::ggcorrmat(mdata_nogeo[, 2:17])\n```\n\n::: {.cell-output-display}\n![](In-class_Ex12_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngwr_bw_train_ad <- bw.gwr(resale_price ~ floor_area_sqm +\n                            storey_order + remaining_lease_mths +\n                            PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER +\n                            PROX_MRT + PROX_PARK + PROX_MALL +\n                            PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN +\n                            WITHIN_350M_CHILDCARE + WITHIN_350M_BUS + WITHIN_1KM_PRISCH,\n                          data=train_data,\n                          approach=\"CV\",\n                          kernel=\"gaussian\",\n                          adaptive=TRUE,\n                          longlat=FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAdaptive bandwidth: 69 CV score: 407907229193 \nAdaptive bandwidth: 51 CV score: 399223079695 \nAdaptive bandwidth: 38 CV score: 388447223999 \nAdaptive bandwidth: 32 CV score: 378970170216 \nAdaptive bandwidth: 26 CV score: 365612583260 \nAdaptive bandwidth: 24 CV score: 365385607488 \nAdaptive bandwidth: 21 CV score: 3.69993e+11 \nAdaptive bandwidth: 24 CV score: 365385607488 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngwr_pred <- gwr.predict(formula = resale_price ~\n                          floor_area_sqm + storey_order +\n                          remaining_lease_mths + PROX_CBD + \n                          PROX_ELDERLYCARE + PROX_HAWKER + \n                          PROX_MRT + PROX_PARK + PROX_MALL + \n                          PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN +\n                          WITHIN_350M_CHILDCARE + WITHIN_350M_BUS + \n                          WITHIN_1KM_PRISCH, \n                        data=train_data, \n                        predictdata = test_data, \n                        bw=20, \n                        kernel = 'gaussian', \n                        adaptive=TRUE, \n                        longlat = FALSE)\ngwr_pred_df <- as.data.frame(\n  gwr_pred$SDF$prediction\n) %>%\n  rename(gwr_pred = \"gwr_pred$SDF$prediction\")\ngwr_pred_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      gwr_pred\n1     361764.3\n2     404810.3\n3     352967.9\n4     399129.1\n5     259860.6\n6     344771.1\n7     454756.3\n8     339169.8\n9     430861.9\n10    446909.2\n11    533967.0\n12    726512.1\n13    432441.3\n14    401419.7\n15    474368.0\n16    443278.3\n17    815035.0\n18    386959.4\n19    374500.6\n20    430369.3\n21    340290.6\n22    408148.5\n23    366942.4\n24    436157.6\n25    494310.6\n26    542262.4\n27    399822.4\n28    610995.3\n29    478708.8\n30    367577.5\n31    741927.7\n32    407717.8\n33    587832.7\n34    473556.1\n35    397873.4\n36    400358.4\n37    350257.4\n38    337720.7\n39    316130.8\n40    489439.5\n41    361044.4\n42    331775.5\n43    365597.2\n44    428455.6\n45    359266.3\n46    482771.1\n47    398567.8\n48    464359.0\n49    430935.4\n50    378492.6\n51    643706.4\n52    394668.0\n53    330354.0\n54    560831.5\n55    243870.0\n56    368251.1\n57    354373.2\n58    516663.1\n59    378773.0\n60    381935.6\n61    441114.4\n62    346294.4\n63    319955.2\n64    360572.6\n65    539681.6\n66    358242.5\n67    479444.8\n68    453188.9\n69    346242.6\n70    317140.7\n71    643278.8\n72    422853.7\n73    390452.1\n74    311153.2\n75    456599.8\n76    361901.1\n77    641826.0\n78    885826.3\n79    378352.5\n80    361529.5\n81    261782.1\n82    479947.5\n83    359887.5\n84    315373.4\n85    638087.9\n86    188312.7\n87    442509.9\n88   1004534.4\n89    486219.2\n90    414490.5\n91    432705.0\n92    424381.3\n93    412428.0\n94    420286.9\n95    385320.3\n96    464638.0\n97    243089.7\n98    668145.6\n99    470218.2\n100   343284.7\n101   367459.4\n102   367944.1\n103   506094.9\n104   331611.7\n105   342080.8\n106   458412.8\n107   360764.1\n108   309338.1\n109   402426.6\n110   469084.4\n111   537476.1\n112   425313.2\n113   443396.0\n114   457652.2\n115   415268.2\n116   448949.1\n117   670374.4\n118   565069.5\n119   475822.1\n120   299345.6\n121   382756.3\n122   770838.1\n123   238698.8\n124   309166.8\n125   479721.8\n126   341972.8\n127   561556.4\n128   711318.5\n129   450843.3\n130   323653.5\n131   311340.6\n132   399282.9\n133   287274.3\n134   392648.1\n135   293736.2\n136   305230.0\n137   504076.6\n138   482911.9\n139   296808.6\n140   282256.8\n141   318012.7\n142   334757.0\n143   490505.9\n144   365448.6\n145   385986.6\n146   632812.9\n147   400510.1\n148   373237.4\n149   385357.3\n150   511925.4\n151   519105.8\n152   345265.2\n153   349336.4\n154   378235.1\n155   584906.4\n156   279081.6\n157   255639.3\n158   388664.9\n159   384760.2\n160   332066.4\n161   404556.1\n162   476245.7\n163   423496.4\n164   387567.7\n165   418647.3\n166   407249.3\n167   339144.2\n168   491780.7\n169   351742.5\n170   336083.2\n171   434749.4\n172   400493.0\n173   507730.8\n174   375992.2\n175   404225.7\n176   321220.5\n177   315025.8\n178   341462.1\n179   374940.0\n180   274920.8\n181   171582.3\n182   461377.1\n183   405190.3\n184   300301.4\n185   451359.9\n186   467497.8\n187   379416.6\n188   432251.8\n189   402891.4\n190   263293.3\n191   432569.2\n192   309843.1\n193   402656.8\n194   467386.0\n195   399103.7\n196   447948.4\n197   434829.8\n198   299076.4\n199   498249.9\n200   474152.0\n201   432061.4\n202   311834.6\n203   495782.8\n204   412605.7\n205   368871.7\n206   404396.9\n207   485224.2\n208   653629.3\n209   327349.3\n210   471622.2\n211   374722.0\n212   545529.5\n213   527741.1\n214   385087.5\n215   595053.8\n216   326270.1\n217   722077.2\n218   390041.6\n219   653716.5\n220   389222.7\n221   460248.7\n222   357648.8\n223   289913.0\n224   436232.7\n225   335883.4\n226   577168.5\n227   269549.6\n228   681242.3\n229   380949.8\n230   294526.3\n231   480965.9\n232   520064.7\n233   476986.9\n234   459403.4\n235   393465.7\n236   382494.0\n237   363397.0\n238   333414.4\n239   545360.9\n240   540557.4\n241   327231.6\n242   387096.2\n243   494360.5\n244   328933.0\n245   377709.5\n246   461118.4\n247   403342.6\n248   513199.6\n249   602735.0\n250   485862.8\n251   476535.5\n252   497582.7\n253   616006.4\n254   341332.5\n255   522065.0\n256   345967.6\n257   344659.6\n258   394397.8\n259   396623.7\n260   295211.9\n261   624842.8\n262   563311.6\n263   354873.0\n264   722213.2\n265   522580.3\n266   386732.3\n267   700605.0\n268   466609.5\n269   517939.8\n270   313346.9\n271   588212.5\n272   397634.2\n273   520911.5\n274   378617.2\n275   450902.7\n276   385234.5\n277   650772.1\n278   414322.9\n279   479540.8\n280   574080.7\n281   418198.1\n282   381982.6\n283   586798.1\n284   454861.7\n285   362548.2\n286   550679.2\n287   516738.7\n288   699549.2\n289   567001.2\n290   342697.9\n291   397856.3\n292   483324.4\n293   397847.2\n294   345785.8\n295   369186.4\n296   356123.6\n297   514290.8\n298   338293.9\n299   480701.2\n300   368595.0\n301   421369.5\n302   298011.8\n303   467953.5\n304   574956.5\n305   550699.3\n306   484910.1\n307   288193.3\n308   394205.2\n309   605627.7\n310   591976.3\n311   628477.6\n312   418476.9\n313   355393.9\n314   433008.3\n315   355427.7\n316   416397.0\n317   470595.9\n318   346919.2\n319   464223.5\n320   656617.6\n321   431866.8\n322   326627.3\n323   302844.7\n324   614439.0\n325   358344.5\n326   410107.4\n327   336395.3\n328   338231.1\n329   637914.2\n330   458672.9\n331   408109.0\n332   751119.0\n333   329252.2\n334   552091.7\n335   424013.9\n336   392581.1\n337   265954.5\n338   490004.0\n339   354203.5\n340   462745.0\n341   350625.1\n342   557904.3\n343   498706.9\n344   430211.1\n345   454646.2\n346   446456.7\n347   547396.3\n348   330700.5\n349   488024.7\n350   423727.3\n351   473819.6\n352   444076.6\n353   477634.3\n354   466514.3\n355   442039.7\n356   473660.5\n357   333183.0\n358   411753.0\n359   313485.3\n360   393186.8\n361   373329.1\n362   725780.9\n363   358709.7\n364   451540.8\n365   451482.3\n366   424964.0\n367   365111.2\n368   306723.3\n369   485947.1\n370   478389.0\n371   325878.7\n372   329572.5\n373   399988.0\n374   327327.1\n375   307728.0\n376   376420.6\n377   285508.1\n378   526097.3\n379   345943.0\n380   288480.1\n381   464931.9\n382   516680.8\n383   361105.0\n384   408164.4\n385   371719.8\n386   368501.3\n387   456301.0\n388   380625.5\n389   361766.3\n390   366389.1\n391   767847.4\n392   379396.7\n393   387135.1\n394   398157.1\n395   396563.8\n396   501972.3\n397   418979.9\n398   347490.0\n399   335867.8\n400   520538.2\n401   416517.2\n402   320859.5\n403   588074.7\n404   413817.5\n405   454886.6\n406   385256.4\n407   266412.4\n408   314833.6\n409   480724.0\n410   348286.1\n411   429043.0\n412   535413.5\n413   432553.4\n414   311476.8\n415   666531.1\n416   322376.5\n417   606249.3\n418   359898.3\n419   397613.9\n420   447704.0\n421   356611.2\n422   528507.1\n423   726546.6\n424   351478.3\n425   473771.6\n426   722531.5\n427   381709.1\n428   529182.9\n429   454354.0\n430   295175.9\n431   323309.8\n432   501503.0\n433   365679.5\n434   367795.9\n435   749016.9\n436   298763.7\n437   448888.0\n438   518018.9\n439   411087.5\n440   330685.1\n441   297708.7\n442   441544.8\n443   481204.0\n444   432402.8\n445   502161.6\n446   608196.9\n447   287838.8\n448   424629.7\n449   452909.1\n450   378236.0\n451   245310.5\n452   285258.1\n453   315788.9\n454   276970.5\n455   398479.5\n456   393293.2\n457   334529.3\n458   594643.9\n459   444400.1\n460   240531.7\n461   409860.4\n462   546232.1\n463   369190.3\n464   358923.2\n465   679680.7\n466   435207.3\n467   353814.0\n468   471599.8\n469   462855.5\n470   351942.2\n471   469289.6\n472   471630.9\n473   431785.1\n474   429742.1\n475   478121.4\n476   363306.6\n477   608807.9\n478   573540.7\n479   312007.0\n480   410642.2\n481   428819.5\n482   393268.8\n483   304114.8\n484   523660.1\n485   317289.4\n486   352494.5\n487   463204.7\n488   402230.9\n489   308967.6\n490   462743.0\n491   443421.5\n492   527190.2\n493   434271.1\n494   353793.2\n495   587110.6\n496   446160.9\n497   331750.6\n498   328417.8\n499   469981.1\n500   408781.0\n501   477950.7\n502   374814.1\n503   386635.4\n504   702888.4\n505   342006.9\n506   466701.1\n507   321638.5\n508   463193.9\n509   324326.8\n510   383863.6\n511   390612.8\n512   352833.8\n513   360725.5\n514   402507.8\n515   534355.2\n516   378342.1\n517   400794.8\n518   588654.5\n519   374325.0\n520   437762.9\n521   347780.3\n522   159415.8\n523   496429.8\n524   506834.3\n525   722756.6\n526   455181.1\n527   371169.7\n528   406182.6\n529   375698.3\n530   363735.4\n531   453411.2\n532   359075.3\n533   358958.7\n534   523230.6\n535   377644.4\n536   351566.2\n537   726069.1\n538   424224.6\n539   348548.2\n540   373640.5\n541   379529.0\n542   397316.0\n543   553296.6\n544   349804.7\n545   352604.3\n546   342811.2\n547   498249.9\n548   477729.7\n549   354595.8\n550   409173.9\n551   693623.6\n552   512175.3\n553   414694.8\n554   491274.2\n555   330229.8\n556   549632.4\n557   453544.4\n558   336051.8\n559   336035.7\n560   619573.3\n561   470203.8\n562   316799.7\n563   439709.9\n564   395184.6\n565   445512.4\n566   545983.1\n567   647862.1\n568   387638.3\n569   502237.7\n570   330108.9\n571   457842.1\n572   465691.4\n573   540411.3\n574   532626.2\n575   296829.6\n576   504832.7\n577   362697.3\n578   391094.1\n579   319679.3\n580   265950.6\n581   530784.9\n582   326770.9\n583   506142.6\n584   398807.4\n585   436204.6\n586   517819.8\n587   388995.4\n588   593069.2\n589   300768.7\n590   487801.4\n591   404538.0\n592   460326.6\n593   451056.9\n594   403160.4\n595   316006.0\n596   313802.5\n597   356687.2\n598   355493.5\n599   625248.3\n600   439950.7\n601   456935.3\n602   314041.5\n603   380949.3\n604   457835.2\n605   642139.1\n606   337606.9\n607   315467.0\n608   340450.2\n609   425072.0\n610   503589.2\n611   507876.2\n612   485611.2\n613   401645.7\n614   464653.4\n615   446826.5\n616   376009.2\n617   278435.1\n618   376782.8\n619   476120.6\n620   368608.5\n621   480921.7\n622   391595.1\n623   440177.4\n624   449914.7\n625   366682.6\n626   476555.1\n627   358451.9\n628   369053.1\n629   403485.6\n630   468551.5\n631   453754.1\n632   599874.5\n633   319979.8\n634   369551.7\n635   343813.6\n636   545440.6\n637   385626.9\n638   381901.9\n639   403130.5\n640   459875.1\n641   958527.9\n642   283733.5\n643   654885.3\n644   419292.3\n645   313030.8\n646   430960.0\n647   418507.4\n648   432234.8\n649   548564.5\n650   291777.5\n651   329279.4\n652   584954.8\n653   467518.0\n654   391676.8\n655   557892.3\n656   577860.0\n657   621101.0\n658   326509.9\n659   425376.9\n660   459805.1\n661   313676.0\n662   512291.3\n663   624086.8\n664   680227.3\n665   406028.5\n666   494335.4\n667   327461.0\n668   409462.4\n669   572764.3\n670   657790.2\n671   378665.9\n672   438614.2\n673   359412.7\n674   336256.9\n675   372264.9\n676   698083.8\n677   374974.7\n678   367671.7\n679   743862.5\n680   335758.0\n681   330745.4\n682   531787.8\n683   663498.3\n684   331528.0\n685   466570.6\n686   447321.3\n687   413950.4\n688   305478.9\n689   377204.4\n690   448459.4\n691   412842.8\n692   452222.0\n693   579239.2\n694   526783.4\n695   390433.6\n696   290196.7\n697   449993.5\n698   322668.5\n699   413174.9\n700   478590.8\n701   397509.3\n702  1018902.0\n703   472971.1\n704   342677.6\n705   377412.5\n706   345338.6\n707   422917.6\n708   344633.7\n709   535921.5\n710   326908.7\n711   671405.2\n712   345254.2\n713   627847.7\n714   472820.0\n715   405739.9\n716   428388.4\n717   515716.3\n718   344364.3\n719   341000.1\n720   540922.4\n721   450402.3\n722   433784.1\n723   425547.8\n724   359767.5\n725   404435.4\n726   482821.4\n727   350165.2\n728   310241.4\n729   335413.6\n730   406790.1\n731   499557.8\n732   464721.4\n733   414010.3\n734   322986.4\n735   407645.3\n736   446456.1\n737   801327.8\n738   557067.8\n739   578883.2\n740   303992.5\n741   396170.8\n742   511698.8\n743   353467.1\n744   372383.5\n745   285627.8\n746   358579.8\n747   491287.9\n748   490201.3\n749   465274.0\n750   363127.2\n751   369526.8\n752   365802.4\n753   413128.1\n754   340196.4\n755   404175.4\n756   370631.1\n757   312528.5\n758   522092.6\n759   563902.5\n760   438723.6\n761   314922.0\n762   312342.7\n763   412196.3\n764   404036.5\n765   424396.0\n766   482842.8\n767   354087.9\n768   505947.6\n769   372454.4\n770   286116.9\n771   398693.8\n772   435756.5\n773   410870.5\n774   403038.6\n775   421317.3\n776   305655.5\n777   441420.3\n778   768244.8\n779   443081.1\n780   383140.6\n781   515518.3\n782   432956.0\n783   305329.1\n784   319016.9\n785   354320.9\n786   338784.5\n787   822615.1\n788   420295.4\n789   467730.8\n790   461454.1\n791   448754.9\n792   376118.2\n793   373808.7\n794   444536.1\n795   322188.6\n796   283825.9\n797   349567.8\n798   518474.9\n799   423625.1\n800   418759.8\n801   382970.6\n802   439033.0\n803   326621.1\n804   414495.3\n805   404346.4\n806   716454.0\n807   355838.5\n808   367134.1\n809   299077.5\n810   307593.3\n811   404069.1\n812   463769.7\n813   341683.4\n814   298317.5\n815   446852.7\n816   336459.1\n817   381285.2\n818   485089.4\n819   435228.7\n820   425509.6\n821   495352.1\n822   277096.7\n823   463567.8\n824   441026.8\n825   376846.3\n826   418424.0\n827   343496.8\n828   445080.4\n829   409416.1\n830   369106.0\n831   352164.7\n832   480439.2\n833   784393.5\n834   360815.1\n835   595795.0\n836   557902.7\n837   376240.3\n838   343024.2\n839   390668.3\n840   399463.9\n841   671872.0\n842   393361.2\n843   391183.9\n844   406559.4\n845   335026.9\n846   406369.8\n847   346769.7\n848   493771.6\n849   372380.0\n850   449717.3\n851   652121.3\n852   445187.3\n853   439442.9\n854   442836.3\n855   259104.6\n856   386249.7\n857   294013.3\n858   305907.6\n859   480983.6\n860   374634.6\n861   406807.2\n862   455702.8\n863   363355.9\n864   413010.4\n865   355190.8\n866   407604.6\n867   572578.4\n868   385961.6\n869   493471.6\n870   460211.0\n871   430526.5\n872   412074.7\n873   444857.0\n874   371412.1\n875   353432.3\n876   348062.3\n877   510808.9\n878   477871.8\n879   431542.2\n880   368760.2\n881   369367.1\n882   554870.0\n883   593839.4\n884   449378.2\n885   331524.5\n886   387530.0\n887   277847.0\n888   412433.0\n889   475926.8\n890   648174.3\n891   428911.9\n892   422527.5\n893   393343.1\n894   562634.1\n895   333267.3\n896   461317.3\n897   387101.4\n898   319703.2\n899   494820.6\n900   377080.2\n901   400072.2\n902   529385.4\n903   428632.9\n904   405728.8\n905   493798.9\n906   418984.0\n907   442138.9\n908   358405.7\n909   329630.9\n910   406515.4\n911   358690.8\n912   619834.9\n913   326425.9\n914   341801.1\n915   249409.0\n916   652821.1\n917   364777.8\n918   317984.4\n919   520085.2\n920   471454.2\n921   335284.3\n922   423366.6\n923   339923.5\n924   454824.1\n925   349279.7\n926   523399.5\n927   359623.8\n928   340300.5\n929   454383.9\n930   585985.9\n931   537171.0\n932   298344.9\n933   384852.4\n934   409241.5\n935   425662.4\n936   428830.9\n937   343630.0\n938   315026.6\n939   312039.6\n940   450886.2\n941   421153.9\n942   433321.0\n943   366620.9\n944   393532.0\n945   398907.7\n946   355997.6\n947   252852.8\n948   392957.8\n949   492410.0\n950   734672.1\n951   390013.1\n952   571422.7\n953   473024.6\n954   415346.6\n955   345405.4\n956   456030.9\n957   450841.7\n958   447644.9\n959   326507.4\n960   210130.8\n961   515072.5\n962   510531.4\n963   456175.0\n964   546321.5\n965   439206.7\n966   454014.0\n967   331029.5\n968   249489.6\n969   545349.6\n970   591779.4\n971   463649.2\n972   401010.8\n973   623523.1\n974   338672.9\n975   387960.5\n976   341149.5\n977   509742.1\n978   347380.7\n979   501067.4\n980   245461.1\n981   393585.8\n982   466187.6\n983   350698.7\n984   734010.0\n985   527096.3\n986   408655.1\n987   255388.1\n988   538950.7\n989   422343.7\n990   274246.8\n991   426517.9\n992   353928.9\n993   453209.0\n994   352386.4\n995   340993.2\n996   449643.7\n997   468079.4\n998   408213.5\n999   344677.3\n1000  485566.1\n1001  432000.8\n1002  413315.4\n1003  379320.0\n1004  311575.6\n1005  417268.9\n1006  496868.1\n1007  420021.2\n1008  428590.0\n1009  454174.4\n1010  329880.7\n1011  424067.3\n1012  423835.0\n1013  529704.4\n1014  655911.5\n1015  355537.3\n1016  452515.5\n1017  533720.7\n1018  418511.0\n1019  548897.8\n1020  319782.6\n1021  412213.3\n1022  397923.1\n1023  397633.1\n1024  292425.4\n1025  502755.9\n1026  358396.9\n1027  414308.5\n1028  455617.1\n1029  412145.0\n1030  535780.9\n1031  647824.7\n1032  371650.5\n1033  508598.4\n1034  376796.9\n1035  399950.2\n1036  450510.4\n1037  733520.4\n1038  421680.8\n1039  303038.3\n1040  454877.3\n1041  329245.4\n1042  439721.9\n1043  632460.0\n1044  331261.0\n1045  369984.5\n1046  478371.2\n1047  507672.0\n1048  412331.5\n1049  547652.4\n1050  636481.8\n1051  376711.0\n1052  417887.2\n1053  440277.9\n1054  380582.4\n1055  694551.9\n1056  347934.2\n1057  450239.5\n1058  566366.5\n1059  454439.9\n1060  542185.4\n1061  382953.9\n1062  403668.5\n1063  501502.3\n1064  270557.0\n1065  337026.8\n1066  659538.7\n1067  697938.1\n1068  320506.2\n1069  489834.5\n1070  548636.2\n1071  358607.9\n1072  472590.9\n1073  834004.6\n1074  469494.0\n1075  401127.7\n1076  539043.7\n1077  369461.0\n1078  469015.5\n1079  366730.4\n1080  316393.5\n1081  291358.4\n1082  496718.7\n1083  383197.5\n1084  289071.9\n1085  310061.2\n1086  346001.5\n1087  391407.6\n1088  324127.3\n1089  348571.0\n1090  428166.2\n1091  333483.6\n1092  346871.2\n1093  477680.9\n1094  326142.6\n1095  394834.5\n1096  323057.3\n1097  323392.0\n1098  345420.7\n1099  335817.2\n1100  271029.7\n1101  406737.2\n1102  366423.9\n1103  287594.3\n1104  385799.2\n1105  530187.5\n1106  383236.8\n1107  431329.6\n1108  297466.0\n1109  406871.2\n1110  421716.9\n1111  585350.4\n1112  353166.6\n1113  428444.5\n1114  496076.2\n1115  348733.4\n1116  439611.1\n1117  441706.5\n1118  470064.1\n1119  440437.8\n1120  354286.0\n1121  403141.4\n1122  478062.6\n1123  497444.9\n1124  356080.4\n1125  406822.5\n1126  388179.4\n1127  329808.5\n1128  451577.7\n1129  351051.4\n1130  531091.2\n1131  402033.0\n1132  386526.3\n1133  513392.1\n1134  293543.4\n1135  318599.7\n1136  494538.6\n1137  295043.8\n1138  193107.8\n1139  405857.0\n1140  392920.3\n1141  414589.9\n1142  539464.5\n1143  435479.9\n1144  448365.6\n1145  320403.4\n1146  433461.6\n1147  335360.4\n1148  444034.2\n1149  260801.5\n1150  449203.0\n1151  416831.1\n1152  308302.0\n1153  511957.6\n1154  400423.9\n1155  309579.3\n1156  470532.6\n1157  532690.0\n1158  332484.8\n1159  412407.9\n1160  371920.7\n1161  268010.5\n1162  417956.4\n1163  438437.4\n1164  259660.9\n1165  381441.8\n1166  591105.2\n1167  482188.6\n1168  347234.5\n1169  367169.8\n1170  342018.9\n1171  521334.2\n1172  257779.2\n1173  750519.7\n1174  405793.3\n1175  375462.9\n1176  262166.9\n1177  339869.1\n1178  388644.1\n1179  446477.6\n1180  345058.0\n1181  411969.9\n1182  762794.3\n1183  451956.9\n1184  821323.2\n1185  374570.1\n1186  400087.8\n1187  434275.2\n1188  292089.3\n1189  300654.5\n1190  336651.7\n1191  306417.8\n1192  547456.4\n1193  295179.2\n1194  431554.6\n1195  433016.2\n1196  448708.9\n1197  354281.5\n1198  593294.1\n1199  431077.4\n1200  332651.5\n1201  359373.7\n1202  398904.8\n1203  538708.0\n1204  743147.3\n1205  368463.4\n1206  441998.0\n1207  672777.0\n1208  370498.7\n1209  311548.9\n1210  404910.7\n1211  465956.1\n1212  363063.6\n1213  514923.1\n1214  380334.6\n1215  444110.2\n1216  428591.8\n1217  436755.0\n1218  432354.6\n1219  444568.7\n1220  317972.9\n1221  470117.1\n1222  363955.3\n1223  469633.1\n1224  293592.9\n1225  606240.6\n1226  374678.5\n1227  302031.2\n1228  400460.9\n1229  374464.9\n1230  483464.5\n1231  442998.5\n1232  357506.7\n1233  381154.7\n1234  396912.4\n1235  410738.0\n1236  331731.0\n1237  401026.1\n1238  421335.1\n1239  319449.0\n1240  415151.5\n1241  351639.5\n1242  444129.9\n1243  410765.1\n1244  424809.6\n1245  400666.7\n1246  653059.8\n1247  400291.7\n1248  417421.6\n1249  533948.8\n1250  376761.0\n1251  451229.6\n1252  401136.9\n1253  373345.8\n1254  455920.4\n1255  389419.1\n1256  634527.0\n1257  340897.1\n1258  452839.1\n1259  460776.4\n1260  405525.2\n1261  292800.7\n1262  423683.9\n1263  364681.6\n1264  370161.1\n1265  416412.3\n1266  372579.2\n1267  458348.8\n1268  449241.9\n1269  498364.3\n1270  539476.7\n1271  505987.3\n1272  500322.3\n1273  425432.7\n1274  534198.2\n1275  449370.4\n1276  381224.6\n1277  417914.7\n1278  590210.6\n1279  391964.2\n1280  382652.0\n1281  280067.8\n1282  350776.8\n1283  379031.0\n1284  586479.0\n1285  392132.0\n1286  358081.2\n1287  323677.3\n1288  326856.8\n1289  402392.3\n1290  354938.2\n1291  422109.3\n1292  284945.2\n1293  362357.2\n1294  410563.5\n1295  363786.3\n1296  416419.7\n1297  490182.1\n1298  443300.2\n1299  383973.4\n1300  444884.7\n1301  750958.5\n1302  362237.4\n1303  430257.7\n1304  435432.7\n1305  453881.9\n1306  608625.8\n1307  358847.3\n1308  343479.0\n1309  401510.7\n1310  427007.5\n1311  361989.9\n1312  379730.2\n1313  385017.8\n1314  584672.7\n1315  371563.3\n1316  492342.9\n1317  302156.2\n1318  430227.7\n1319  737854.2\n1320  399468.0\n1321  450948.9\n1322  337623.0\n1323  408494.8\n1324  397080.8\n1325  443391.6\n1326  550155.8\n1327  364493.5\n1328  382921.1\n1329  344507.5\n1330  506146.7\n1331  333576.5\n1332  339553.5\n1333  289564.1\n1334  422973.3\n1335  590025.5\n1336  350849.3\n1337  752943.0\n1338  283807.3\n1339  544912.8\n1340  408107.5\n1341  489798.7\n1342  346432.9\n1343  356101.3\n1344  465377.7\n1345  447398.7\n1346  747750.2\n1347  353517.9\n1348  354698.9\n1349  441943.3\n1350  789727.0\n1351  395431.4\n1352  447955.6\n1353  247666.4\n1354  378135.5\n1355  714915.3\n1356  319542.2\n1357  658179.4\n1358  553490.6\n1359  256256.7\n1360  341525.8\n1361  517180.4\n1362  440383.5\n1363  471474.8\n1364  427253.5\n1365  488022.7\n1366  417989.2\n1367  318142.7\n1368  447457.9\n1369  488812.1\n1370  456805.9\n1371  327441.6\n1372  455233.1\n1373  326499.1\n1374  453591.3\n1375  267150.1\n1376  299718.3\n1377  370829.8\n1378  528311.2\n1379  447736.9\n1380  407133.9\n1381  347837.4\n1382  401275.5\n1383  330545.4\n1384  445155.2\n1385  407854.2\n1386  469272.1\n1387  405916.7\n1388  496540.5\n1389  319308.3\n1390  307931.5\n1391  396509.8\n1392  372515.2\n1393  492044.0\n1394  488806.3\n1395  381276.9\n1396  225914.8\n1397  505541.4\n1398  368082.6\n1399  387204.9\n1400  336748.7\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncoords <- st_coordinates(HDB_sample)\ncoords_train <- st_coordinates(train_data)\ncoords_test <- st_coordinates(test_data)\n\ntrain_data_nogeom <- train_data %>%\n  st_drop_geometry()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nrf <- ranger(resale_price ~ floor_area_sqm +\n                            storey_order + remaining_lease_mths +\n                            PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER +\n                            PROX_MRT + PROX_PARK + PROX_MALL +\n                            PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN +\n                            WITHIN_350M_CHILDCARE + WITHIN_350M_BUS + WITHIN_1KM_PRISCH, data=train_data_nogeom)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_data_nogeom <- cbind(\n  test_data, coords_test) %>%\n  st_drop_geometry()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_pred <- predict(rf, data = test_data_nogeom)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_pred_df <- as.data.frame(rf_pred$predictions) %>%\n  rename(rf_pred = \"rf_pred$predictions\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\ngrf_ad <- grf(resale_price ~ floor_area_sqm +\n                            storey_order + remaining_lease_mths +\n                            PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER +\n                            PROX_MRT + PROX_PARK + PROX_MALL +\n                            PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN +\n                            WITHIN_350M_CHILDCARE + WITHIN_350M_BUS + WITHIN_1KM_PRISCH, \n              dframe = train_data_nogeom,\n              bw=20,\n              kernel=\"adaptive\",\n              coords=coords_train)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nNumber of Observations: 100\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNumber of Independent Variables: 14\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nKernel: Adaptive\nNeightbours: 20\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\n--------------- Global ML Model Summary ---------------\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRanger result\n\nCall:\n ranger(resale_price ~ floor_area_sqm + storey_order + remaining_lease_mths +      PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER + PROX_MRT + PROX_PARK +      PROX_MALL + PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN +      WITHIN_350M_CHILDCARE + WITHIN_350M_BUS + WITHIN_1KM_PRISCH,      data = train_data_nogeom, num.trees = 500, mtry = 4, importance = \"impurity\",      num.threads = NULL) \n\nType:                             Regression \nNumber of trees:                  500 \nSample size:                      100 \nNumber of independent variables:  14 \nMtry:                             4 \nTarget node size:                 5 \nVariable importance mode:         impurity \nSplitrule:                        variance \nOOB prediction error (MSE):       5703987554 \nR squared (OOB):                  0.6704437 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nImportance:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          floor_area_sqm             storey_order     remaining_lease_mths \n             53679224312             213723102315             174062858247 \n                PROX_CBD         PROX_ELDERLYCARE              PROX_HAWKER \n            514914396629              75632512631             136039218936 \n                PROX_MRT                PROX_PARK                PROX_MALL \n             99063109679              71539924464              57379956712 \n        PROX_SUPERMARKET WITHIN_350M_KINDERGARTEN    WITHIN_350M_CHILDCARE \n             61687768650               9298686427              51767268338 \n         WITHIN_350M_BUS        WITHIN_1KM_PRISCH \n             33285415499              98948524421 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nMean Square Error (Not OOB): 1132084606.934\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nR-squared (Not OOB) %: 93.393\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAIC (Not OOB): 2114.733\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAICc (Not OOB): 2120.447\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\n--------------- Local Model Summary ---------------\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nResiduals OOB:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n-140249  -39087   -4685    3989   30861  248123 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nResiduals Predicted (Not OOB):\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n-17208.0  -4285.6    132.8    484.2   3981.0  43046.3 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nLocal Variable Importance:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                Min          Max        Mean         StD\nfloor_area_sqm            847412727  16230418149  4146314204  3477653830\nstorey_order              159574329  89107070474  8906294387 16109722478\nremaining_lease_mths     2209425807 179525330554 29593214056 46664043089\nPROX_CBD                  792133750  86976346042 10834793518 16154170160\nPROX_ELDERLYCARE          511990816  79597246645  9044763961 17662174659\nPROX_HAWKER               775856714 137601414487 10353818635 18654078606\nPROX_MRT                  552779485 138141280278 12891312696 29818392109\nPROX_PARK                 404865964  56642611001  7482785738  9999250493\nPROX_MALL                 708722856  88866348531  8640117438 17219984770\nPROX_SUPERMARKET         1528631758  75387961835 15097314457 18041243813\nWITHIN_350M_KINDERGARTEN  118256477   6650568458  1280176878  1117048748\nWITHIN_350M_CHILDCARE     282417540 126526455108 11927719605 25299376293\nWITHIN_350M_BUS           294165001  47178965249  5057055547  9281900773\nWITHIN_1KM_PRISCH         302513821  25236605113  3963930713  5156236614\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nMean squared error (OOB): 4853147846.12\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nR-squared (OOB) %: 71.677\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAIC (OOB): 2260.289\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAICc (OOB): 2266.004\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nMean squared error Predicted (Not OOB): 77847360.588\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nR-squared Predicted (Not OOB) %: 99.546\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAIC Predicted (Not OOB): 1847.026\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAICc Predicted (Not OOB): 1852.74\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nCalculation time (in seconds): 2.1172\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngrf_pred <- predict.grf(grf_ad,\n                        test_data_nogeom,\n                        x.var.name=\"X\",\n                        y.var.name=\"Y\",\n                        local.w=1,\n                        global.w=0)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngrf_pred_df <- as.data.frame(grf_pred)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_data_pred <- test_data %>%\n  select(resale_price) %>%\n  cbind(gwr_pred_df) %>%\n  cbind(rf_pred_df) %>%\n  cbind(grf_pred_df)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_longer <- test_data_pred %>%\n  st_drop_geometry() %>%\n  pivot_longer(cols = ends_with(\"pred\"),\n               names_to = \"model\",\n               values_to = \"predicted\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_labels <- c(\n  gwr_pred = \"gwr\",\n  rf_pred = \"Random Forest\",\n  grf_pred = \"gwRF\"\n)\n\ntest_longer <- test_longer %>%\n  mutate(model = recode(\n    model, !!!model_labels\n  ))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrmse_results <- test_longer %>%\n  group_by(model) %>%\n  rmse(truth = resale_price,\n       estimate = predicted) %>%\n  rename(rmse = .estimate) %>%\n  select(model, rmse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(rmse_results,\n       aes(x = reorder(model, rmse),\n           y = rmse,\n           fill = \"skyblue\")) +\n  geom_bar(stat = \"identity\",\n           fill = \"skyblue\",\n           color = \"black\",\n           width = 0.7) +\n  labs(title = \"RMSE Comparison of Mod\",\n       y = \"RMSE\",\n       x = \"Model\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](In-class_Ex12_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_longer <- test_longer %>%\n  left_join(rmse_results,\n            by = \"model\")\n\nggplot(data = test_longer,\n       aes(x = predicted,\n           y = resale_price)) +\n  facet_wrap(~ model) +\n  geom_point() +\n  geom_text(data = test_longer,\n            aes(x = Inf, y = Inf,\n                label = paste(\"RMSE:\", round(rmse, 2))),\n            hjust = 1.1, vjust = 1.1,\n            color = \"black\", size = 4)\n```\n\n::: {.cell-output-display}\n![](In-class_Ex12_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvar_imp <- data.frame(\n  Variable = names(grf_ad$Global.Model$variable.importance),\n  Importance = grf_ad$Global.Model$variable.importance\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(var_imp, aes(x = reorder(Variable,\n                                Importance),\n                    y = Importance)) +\n  geom_bar(stat = \"identity\",\n           fill = \"skyblue\") +\n  coord_flip() +\n  labs(\n    title = \"Variable Importance from Ranger Model\",\n    x = \"Variables\",\n    y = \"Importance\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](In-class_Ex12_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "In-class_Ex12_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}