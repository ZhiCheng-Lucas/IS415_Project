{
  "hash": "98cda3a03c51b6a2ee5ee0e58a9a1a2a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"In-Class Exercise 04: Spatio-Temporal Point Patterns Analysis\"\nauthor: \"Chong Zhi Cheng\"\ndate: \"September 2, 2024\"\ndate-modified: \"last-modified\"\nexecute:\n  eval: true\n  echo: true\n  freeze: true\n  warning: false\n---\n\n\n### Getting Started\n\nNote that this file will not contain all the code mentioned in class as I felt that it was more beneficial to listen and understand instead of trying to copy everything down.\n\nA spatio-temporal point process (also called space-time or spatial-temporal point process) is a random collection of points, where each point represents the time and location of an event. Examples of events include incidence of disease, sightings or births of a species, or the occurrences of fires, earthquakes, lightning strikes, tsunamis, or volcanic eruptions.\n\nThe analysis of spatio-temporal point patterns is becoming increasingly necessary, given the rapid emergence of geographically and temporally indexed data in a wide range of fields. Several spatio-temporal point patterns analysis methods have been introduced and implemented in R in the last ten years. This chapter shows how various R packages can be combined to run a set of spatio-temporal point pattern analyses in a guided and intuitive way. A real world forest fire events in Kepulauan Bangka Belitung, Indonesia from 1st January 2023 to 31st December 2023 is used to illustrate the methods, procedures and interpretations.\n\n### **The research questions**\n\nThe specific question we would like to answer is:\n\n-   are the locations of forest fire in Kepulauan Bangka Belitung spatial and spatio-temporally independent?\n\n-   if the answer is NO, where and when the observed forest fire locations tend to cluster?\n\n### **The data**\n\nFor the purpose of this exercise, two data sets are used, they are:\n\n-   forestfires, a csv file provides locations of forest fire detected from the Moderate Resolution Imaging Spectroradiometer (MODIS) sensor data. The data are downloaded from [Fire Information for Resource Management System](https://firms.modaps.eosdis.nasa.gov/download/). For the purpose of this exercise, only forest fires within Kepulauan Bangka Belitung will be used.\n\n-   Kepulauan_Bangka_Belitung, an ESRI shapefile showing the sub-district (i.e.Â [kelurahan](https://en.wikipedia.org/wiki/Villages_of_Indonesia)) boundary of Kepulauan Bangka Belitung. The data set was downloaded from [Indonesia Geospatial](https://www.indonesia-geospasial.com/2023/05/download-shapefile-batas-administrasi.html) portal. The original data covers the whole Indonesia. For the purpose of this exercise, only sub-districts within Kepulauan Bangka Belitung are extracted.\n\n## **Installing and Loading the R packages**\n\nFor the purpose of this study, five R packages will be used. They are:\n\n-   rgdal for importing geospatial data in GIS file format such as shapefile into R and save them as Spatial\\*DataFrame,\n\n-   maptools for converting Spatial\\* object into ppp object,\n\n-   raster for handling raster data in R,\n\n-   spatstat for performing Spatial Point Patterns Analysis such as kcross, Lcross, etc., and\n\n-   tmap for producing cartographic quality thematic maps.\n\n#### Install and Launch R Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, raster, spatstat, sparr, tmap, tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(spatstat)\n```\n:::\n\n\nImporting and Preparing Study Area\n\nImporting study area\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkbb <- st_read(dsn = 'data/rawdata', layer = \"Kepulauan_Bangka_Belitung\") %>%\n  st_transform(crs = 32748)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Kepulauan_Bangka_Belitung' from data source \n  `C:\\zcchong\\IS415\\In-Class_Ex\\In-Class_Ex04\\data\\rawdata' using driver `ESRI Shapefile'\nSimple feature collection with 298 features and 27 fields\nGeometry type: POLYGON\nDimension:     XYZ\nBounding box:  xmin: 105.1085 ymin: -3.116593 xmax: 106.8488 ymax: -1.501603\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nkbb_sf <- st_read(dsn = 'data/rawdata', layer = \"Kepulauan_Bangka_Belitung\") %>%\n  st_union() %>%\n  st_zm(drop = TRUE, what = \"ZM\") %>%\n  st_transform(crs = 32748)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Kepulauan_Bangka_Belitung' from data source \n  `C:\\zcchong\\IS415\\In-Class_Ex\\In-Class_Ex04\\data\\rawdata' using driver `ESRI Shapefile'\nSimple feature collection with 298 features and 27 fields\nGeometry type: POLYGON\nDimension:     XYZ\nBounding box:  xmin: 105.1085 ymin: -3.116593 xmax: 106.8488 ymax: -1.501603\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\nConverting OWIN\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkbb_owin <- as.owin(kbb_sf)\nkbb_owin\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nwindow: polygonal boundary\nenclosing rectangle: [512066.8, 705559.4] x [9655398, 9834006] units\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(kbb_owin)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"owin\"\n```\n\n\n:::\n:::\n\n\n## Importing and Preparing Forest Fire data\n\nNext, we will import the for\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_sf <- read.csv(\"data/rawdata/forestfires.csv\") %>%\n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326) %>%\n  st_transform(crs = 32748)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_sf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 741 features and 13 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 521564.1 ymin: 9658137 xmax: 695791 ymax: 9828767\nProjected CRS: WGS 84 / UTM zone 48S\nFirst 10 features:\n   brightness scan track   acq_date acq_time satellite instrument confidence\n1       312.3  1.3   1.1 2023/01/10      629      Aqua      MODIS         67\n2       314.5  1.2   1.1 2023/01/10      629      Aqua      MODIS         70\n3       315.4  1.2   1.1 2023/01/10      629      Aqua      MODIS         71\n4       308.9  1.2   1.1 2023/01/10      629      Aqua      MODIS         54\n5       308.5  1.2   1.1 2023/01/10      629      Aqua      MODIS         33\n6       322.1  1.3   1.1 2023/01/10      629      Aqua      MODIS         72\n7       317.9  1.2   1.1 2023/01/10      629      Aqua      MODIS         71\n8       318.1  1.2   1.1 2023/01/10      629      Aqua      MODIS         75\n9       326.9  2.0   1.4 2023/01/12      616      Aqua      MODIS         73\n10      321.3  2.0   1.4 2023/01/12      616      Aqua      MODIS         75\n   version bright_t31  frp daynight type                 geometry\n1    61.03      281.6 10.8        D    0 POINT (606178.8 9703062)\n2    61.03      286.1 10.2        D    0 POINT (661410.6 9683536)\n3    61.03      288.2 11.4        D    0 POINT (637808.8 9682757)\n4    61.03      284.1  7.1        D    0 POINT (654882.2 9690665)\n5    61.03      285.8  6.2        D    0 POINT (669933.6 9697468)\n6    61.03      276.6 22.7        D    0 POINT (609133.5 9700119)\n7    61.03      284.3 15.6        D    0 POINT (634310.2 9719333)\n8    61.03      286.0 15.9        D    0 POINT (633109.2 9719168)\n9    61.03      284.8 58.3        D    0 POINT (673986.9 9661548)\n10   61.03      282.5 42.1        D    0   POINT (672019 9661275)\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_sf <- fire_sf %>%\n  mutate(DayOfYear = yday(acq_date)) %>%\n  mutate(month_num = month(acq_date)) %>%\n  mutate(Month_fac = month(acq_date, label = TRUE, abbr = FALSE))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(kbb_sf) +   \ntm_polygons() +\ntm_shape(fire_sf) + \ntm_dots()\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex04_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(kbb_sf) +   \ntm_polygons() +   \ntm_shape(fire_sf) +   \ntm_dots(size=0.1) +   \ntm_facets(by=\"Month_fac\",free.coords=FALSE,drop.units=TRUE)\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex04_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_month <- fire_sf |>\n  select(month_num)\n\nfire_month\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 741 features and 1 field\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 521564.1 ymin: 9658137 xmax: 695791 ymax: 9828767\nProjected CRS: WGS 84 / UTM zone 48S\nFirst 10 features:\n   month_num                 geometry\n1          1 POINT (606178.8 9703062)\n2          1 POINT (661410.6 9683536)\n3          1 POINT (637808.8 9682757)\n4          1 POINT (654882.2 9690665)\n5          1 POINT (669933.6 9697468)\n6          1 POINT (609133.5 9700119)\n7          1 POINT (634310.2 9719333)\n8          1 POINT (633109.2 9719168)\n9          1 POINT (673986.9 9661548)\n10         1   POINT (672019 9661275)\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_month_ppp <- as.ppp(fire_month)\nfire_month_ppp\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMarked planar point pattern: 741 points\nmarks are numeric, of storage type  'double'\nwindow: rectangle = [521564.1, 695791] x [9658137, 9828767] units\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_month_owin <- fire_month_ppp[kbb_owin] \nsummary(fire_month_owin)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMarked planar point pattern:  741 points\nAverage intensity 6.424519e-08 points per square unit\n\nCoordinates are given to 10 decimal places\n\nmarks are numeric, of type 'double'\nSummary:\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  1.000   8.000   9.000   8.579  10.000  12.000 \n\nWindow: polygonal boundary\n2 separate polygons (no holes)\n           vertices        area relative.area\npolygon 1     47493 11533600000      1.00e+00\npolygon 2       256      306427      2.66e-05\nenclosing rectangle: [512066.8, 705559.4] x [9655398, 9834006] units\n                     (193500 x 178600 units)\nWindow area = 11533900000 square units\nFraction of frame area: 0.334\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(fire_month_owin)\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex04_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nst_kde <- spattemp.density(fire_month_owin)\nsummary(st_kde)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSpatiotemporal Kernel Density Estimate\n\nBandwidths\n  h = 15102.47 (spatial)\n  lambda = 0.0304 (temporal)\n\nNo. of observations\n  741 \n\nSpatial bound\n  Type: polygonal\n  2D enclosure: [512066.8, 705559.4] x [9655398, 9834006]\n\nTemporal bound\n  [1, 12]\n\nEvaluation\n  128 x 128 x 12 trivariate lattice\n  Density range: [1.233458e-27, 8.202976e-10]\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntims <- c(7, 8, 9, 10, 11, 12)\n\npar(mfcol = c(2, 3))\n\nfor(i in tims) {\n  plot(st_kde, i,\n       override.par = FALSE,\n       fix.range = TRUE,\n       main = paste(\"KDE at month\", i))\n}\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex04_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "In-Class_Ex04_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}